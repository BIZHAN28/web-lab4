{"ast":null,"code":"/*\n    Copyright 2008-2023\n        Matthias Ehmann,\n        Michael Gerhaeuser,\n        Carsten Miller,\n        Bianca Valentin,\n        Alfred Wassermann,\n        Peter Wilfahrt\n\n    This file is part of JSXGraph.\n\n    JSXGraph is free software dual licensed under the GNU LGPL or MIT License.\n\n    You can redistribute it and/or modify it under the terms of the\n\n      * GNU Lesser General Public License as published by\n        the Free Software Foundation, either version 3 of the License, or\n        (at your option) any later version\n      OR\n      * MIT License: https://github.com/jsxgraph/jsxgraph/blob/master/LICENSE.MIT\n\n    JSXGraph is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License and\n    the MIT License along with JSXGraph. If not, see <https://www.gnu.org/licenses/>\n    and <https://opensource.org/licenses/MIT/>.\n */\n\n/*global JXG: true, define: true, AMprocessNode: true, MathJax: true, document: true */\n/*jslint nomen: true, plusplus: true, newcap:true*/\n\nimport JXG from \"../jxg\";\nimport Options from \"../options\";\nimport AbstractRenderer from \"./abstract\";\nimport Const from \"../base/constants\";\nimport Type from \"../utils/type\";\nimport Color from \"../utils/color\";\nimport Base64 from \"../utils/base64\";\nimport Numerics from \"../math/numerics\";\n\n/**\n * Uses SVG to implement the rendering methods defined in {@link JXG.AbstractRenderer}.\n * @class JXG.SVGRenderer\n * @augments JXG.AbstractRenderer\n * @param {Node} container Reference to a DOM node containing the board.\n * @param {Object} dim The dimensions of the board\n * @param {Number} dim.width\n * @param {Number} dim.height\n * @see JXG.AbstractRenderer\n */\nJXG.SVGRenderer = function (container, dim) {\n  var i;\n\n  // docstring in AbstractRenderer\n  this.type = \"svg\";\n  this.isIE = navigator.appVersion.indexOf(\"MSIE\") !== -1 || navigator.userAgent.match(/Trident\\//);\n\n  /**\n   * SVG root node\n   * @type Node\n   */\n  this.svgRoot = null;\n\n  /**\n   * The SVG Namespace used in JSXGraph.\n   * @see http://www.w3.org/TR/SVG2/\n   * @type String\n   * @default http://www.w3.org/2000/svg\n   */\n  this.svgNamespace = \"http://www.w3.org/2000/svg\";\n\n  /**\n   * The xlink namespace. This is used for images.\n   * @see http://www.w3.org/TR/xlink/\n   * @type String\n   * @default http://www.w3.org/1999/xlink\n   */\n  this.xlinkNamespace = \"http://www.w3.org/1999/xlink\";\n\n  // container is documented in AbstractRenderer.\n  // Type node\n  this.container = container;\n\n  // prepare the div container and the svg root node for use with JSXGraph\n  this.container.style.MozUserSelect = \"none\";\n  this.container.style.userSelect = \"none\";\n  this.container.style.overflow = \"hidden\";\n  if (this.container.style.position === \"\") {\n    this.container.style.position = \"relative\";\n  }\n  this.svgRoot = this.container.ownerDocument.createElementNS(this.svgNamespace, \"svg\");\n  this.svgRoot.style.overflow = \"hidden\";\n  this.svgRoot.style.display = \"block\";\n  this.resize(dim.width, dim.height);\n\n  //this.svgRoot.setAttributeNS(null, 'shape-rendering', 'crispEdge'); //'optimizeQuality'); //geometricPrecision');\n\n  this.container.appendChild(this.svgRoot);\n\n  /**\n   * The <tt>defs</tt> element is a container element to reference reusable SVG elements.\n   * @type Node\n   * @see https://www.w3.org/TR/SVG2/struct.html#DefsElement\n   */\n  this.defs = this.container.ownerDocument.createElementNS(this.svgNamespace, \"defs\");\n  this.svgRoot.appendChild(this.defs);\n\n  /**\n   * Filters are used to apply shadows.\n   * @type Node\n   * @see https://www.w3.org/TR/SVG2/struct.html#DefsElement\n   */\n  /**\n   * Create an SVG shadow filter. If the object's RGB color is [r,g,b], it's opacity is op, and\n   * the parameter color is given as [r', g', b'] with opacity op'\n   * the shadow will have RGB color [blend*r + r', blend*g + g', blend*b + b'] and the opacity will be equal to op * op'.\n   * Further, blur and offset can be adjusted.\n   *\n   * The shadow color is [r*ble\n   * @param {String} id Node is of the filter.\n   * @param {Array|String} rgb RGB value for the blend color or the string 'none' for default values. Default 'black'.\n   * @param {Number} opacity Value between 0 and 1, default is 1.\n   * @param {Number} blend  Value between 0 and 1, default is 0.1.\n   * @param {Number} blur  Default: 3\n   * @param {Array} offset [dx, dy]. Default is [5,5].\n   * @returns DOM node to be added to this.defs.\n   * @private\n   */\n  this.createShadowFilter = function (id, rgb, opacity, blend, blur, offset) {\n    var filter = this.container.ownerDocument.createElementNS(this.svgNamespace, 'filter'),\n      feOffset,\n      feColor,\n      feGaussianBlur,\n      feBlend,\n      mat;\n    filter.setAttributeNS(null, 'id', id);\n    filter.setAttributeNS(null, 'width', '300%');\n    filter.setAttributeNS(null, 'height', '300%');\n    filter.setAttributeNS(null, 'filterUnits', 'userSpaceOnUse');\n    feOffset = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feOffset');\n    feOffset.setAttributeNS(null, 'in', 'SourceGraphic'); // b/w: SourceAlpha, Color: SourceGraphic\n    feOffset.setAttributeNS(null, 'result', 'offOut');\n    feOffset.setAttributeNS(null, 'dx', offset[0]);\n    feOffset.setAttributeNS(null, 'dy', offset[1]);\n    filter.appendChild(feOffset);\n    feColor = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feColorMatrix');\n    feColor.setAttributeNS(null, 'in', 'offOut');\n    feColor.setAttributeNS(null, 'result', 'colorOut');\n    feColor.setAttributeNS(null, 'type', 'matrix');\n    // See https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feColorMatrix\n    if (rgb === 'none' || !Type.isArray(rgb) || rgb.length < 3) {\n      feColor.setAttributeNS(null, 'values', '0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 ' + opacity + ' 0');\n    } else {\n      rgb[0] /= 255;\n      rgb[1] /= 255;\n      rgb[2] /= 255;\n      mat = blend + ' 0 0 0 ' + rgb[0] + '  0 ' + blend + ' 0 0 ' + rgb[1] + '  0 0 ' + blend + ' 0 ' + rgb[2] + '  0 0 0 ' + opacity + ' 0';\n      feColor.setAttributeNS(null, 'values', mat);\n    }\n    filter.appendChild(feColor);\n    feGaussianBlur = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feGaussianBlur');\n    feGaussianBlur.setAttributeNS(null, 'in', 'colorOut');\n    feGaussianBlur.setAttributeNS(null, 'result', 'blurOut');\n    feGaussianBlur.setAttributeNS(null, 'stdDeviation', blur);\n    filter.appendChild(feGaussianBlur);\n    feBlend = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feBlend');\n    feBlend.setAttributeNS(null, 'in', 'SourceGraphic');\n    feBlend.setAttributeNS(null, 'in2', 'blurOut');\n    feBlend.setAttributeNS(null, 'mode', 'normal');\n    filter.appendChild(feBlend);\n    return filter;\n  };\n\n  /**\n   * Create a \"unique\" string id from the arguments of the function.\n   * Concatenate all arguments by \"_\".\n   * \"Unique\" is achieved by simply prepending the container id.\n   * Do not escape the string.\n   *\n   * If the id is used in an \"url()\" call it must be eascaped.\n   *\n   * @params {String} one or strings which will be concatenated.\n   * @return {String}\n   * @private\n   */\n  this.uniqName = function () {\n    return this.container.id + '_' + Array.prototype.slice.call(arguments).join('_');\n  };\n\n  /**\n   * Combine arguments to a string, joined by empty string.\n   * Masks the container id with CSS.escape.\n   *\n   * @params {String} str variable number of strings\n   * @returns String\n   * @see JXG.SVGRenderer#toURL\n   * @private\n   * @example\n   * this.toStr('aaa', '_', 'bbb', 'TriangleEnd')\n   * // Output:\n   * // xxx_bbbTriangleEnd\n   */\n  this.toStr = function () {\n    // ES6 would be [...arguments].join()\n    var str = Array.prototype.slice.call(arguments).join('');\n    // Mask special symbols like '/' and '\\' in id\n    if (Type.exists(CSS) && Type.exists(CSS.escape)) {\n      str = CSS.escape(str);\n    }\n    return str;\n  };\n\n  /**\n   * Combine arguments to an URL string of the form\n   * url(#...)\n   * Masks the container id. Calls {@link JXG.SVGRenderer#toStr}.\n   *\n   * @params {String} str variable number of strings\n   * @returns URL string\n   * @see JXG.SVGRenderer#toStr\n   * @private\n   * @example\n   * this.toURL('aaa', '_', 'bbb', 'TriangleEnd')\n   * // Output:\n   * // url(#xxx_bbbTriangleEnd)\n   */\n  this.toURL = function () {\n    return 'url(#' + this.toStr.apply(this, arguments) +\n    // Pass the arguments to toStr\n    ')';\n  };\n\n  /* Default shadow filter */\n  this.defs.appendChild(this.createShadowFilter(this.uniqName('f1'), 'none', 1, 0.1, 3, [5, 5]));\n\n  /**\n   * JSXGraph uses a layer system to sort the elements on the board. This puts certain types of elements in front\n   * of other types of elements. For the order used see {@link JXG.Options.layer}. The number of layers is documented\n   * there, too. The higher the number, the \"more on top\" are the elements on this layer.\n   * @type Array\n   */\n  this.layer = [];\n  for (i = 0; i < Options.layer.numlayers; i++) {\n    this.layer[i] = this.container.ownerDocument.createElementNS(this.svgNamespace, 'g');\n    this.svgRoot.appendChild(this.layer[i]);\n  }\n  try {\n    this.foreignObjLayer = this.container.ownerDocument.createElementNS(this.svgNamespace, \"foreignObject\");\n    this.foreignObjLayer.setAttribute(\"display\", \"none\");\n    this.foreignObjLayer.setAttribute(\"x\", 0);\n    this.foreignObjLayer.setAttribute(\"y\", 0);\n    this.foreignObjLayer.setAttribute(\"width\", \"100%\");\n    this.foreignObjLayer.setAttribute(\"height\", \"100%\");\n    this.foreignObjLayer.setAttribute(\"id\", this.uniqName('foreignObj'));\n    this.svgRoot.appendChild(this.foreignObjLayer);\n    this.supportsForeignObject = true;\n  } catch (e) {\n    this.supportsForeignObject = false;\n  }\n};\nJXG.SVGRenderer.prototype = new AbstractRenderer();\nJXG.extend(JXG.SVGRenderer.prototype, /** @lends JXG.SVGRenderer.prototype */{\n  /**\n   * Creates an arrow DOM node. Arrows are displayed in SVG with a <em>marker</em> tag.\n   * @private\n   * @param {JXG.GeometryElement} el A JSXGraph element, preferably one that can have an arrow attached.\n   * @param {String} [idAppendix=''] A string that is added to the node's id.\n   * @returns {Node} Reference to the node added to the DOM.\n   */\n  _createArrowHead: function (el, idAppendix, type) {\n    var node2,\n      node3,\n      id = el.id + \"Triangle\",\n      //type = null,\n      v,\n      h;\n    if (Type.exists(idAppendix)) {\n      id += idAppendix;\n    }\n    if (Type.exists(type)) {\n      id += type;\n    }\n    node2 = this.createPrim(\"marker\", id);\n    node2.setAttributeNS(null, \"stroke\", Type.evaluate(el.visProp.strokecolor));\n    node2.setAttributeNS(null, \"stroke-opacity\", Type.evaluate(el.visProp.strokeopacity));\n    node2.setAttributeNS(null, \"fill\", Type.evaluate(el.visProp.strokecolor));\n    node2.setAttributeNS(null, \"fill-opacity\", Type.evaluate(el.visProp.strokeopacity));\n    node2.setAttributeNS(null, \"stroke-width\", 0); // this is the stroke-width of the arrow head.\n    // Should be zero to simplify the calculations\n\n    node2.setAttributeNS(null, \"orient\", \"auto\");\n    node2.setAttributeNS(null, \"markerUnits\", \"strokeWidth\"); // 'strokeWidth' 'userSpaceOnUse');\n\n    /*\n       Types 1, 2:\n       The arrow head is an isosceles triangle with base length 10 and height 10.\n        Type 3:\n       A rectangle\n        Types 4, 5, 6:\n       Defined by Bezier curves from mp_arrowheads.html\n        In any case but type 3 the arrow head is 10 units long,\n       type 3 is 10 units high.\n       These 10 units are scaled to strokeWidth * arrowSize pixels, see\n       this._setArrowWidth().\n        See also abstractRenderer.updateLine() where the line path is shortened accordingly.\n        Changes here are also necessary in setArrowWidth().\n        So far, lines with arrow heads are shortenend to avoid overlapping of\n       arrow head and line. This is not the case for curves, yet.\n       Therefore, the offset refX has to be adapted to the path type.\n    */\n    node3 = this.container.ownerDocument.createElementNS(this.svgNamespace, \"path\");\n    h = 5;\n    if (idAppendix === \"Start\") {\n      // First arrow\n      //type = a.typeFirst;\n      // if (JXG.exists(ev_fa.type)) {\n      //     type = Type.evaluate(ev_fa.type);\n      // }\n\n      v = 0;\n      if (type === 2) {\n        node3.setAttributeNS(null, \"d\", \"M 10,0 L 0,5 L 10,10 L 5,5 z\");\n      } else if (type === 3) {\n        node3.setAttributeNS(null, \"d\", \"M 0,0 L 3.33,0 L 3.33,10 L 0,10 z\");\n      } else if (type === 4) {\n        // insetRatio:0.8 tipAngle:45 wingCurve:15 tailCurve:0\n        h = 3.31;\n        node3.setAttributeNS(null, \"d\", \"M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31\");\n      } else if (type === 5) {\n        // insetRatio:0.9 tipAngle:40 wingCurve:5 tailCurve:15\n        h = 3.28;\n        node3.setAttributeNS(null, \"d\", \"M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28\");\n      } else if (type === 6) {\n        // insetRatio:0.9 tipAngle:35 wingCurve:5 tailCurve:0\n        h = 2.84;\n        node3.setAttributeNS(null, \"d\", \"M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84\");\n      } else if (type === 7) {\n        // insetRatio:0.9 tipAngle:60 wingCurve:30 tailCurve:0\n        h = 5.2;\n        node3.setAttributeNS(null, \"d\", \"M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20\");\n      } else {\n        // type == 1 or > 6\n        node3.setAttributeNS(null, \"d\", \"M 10,0 L 0,5 L 10,10 z\");\n      }\n      if (\n      // !Type.exists(el.rendNode.getTotalLength) &&\n      el.elementClass === Const.OBJECT_CLASS_LINE) {\n        if (type === 2) {\n          v = 4.9;\n        } else if (type === 3) {\n          v = 3.3;\n        } else if (type === 4 || type === 5 || type === 6) {\n          v = 6.66;\n        } else if (type === 7) {\n          v = 0.0;\n        } else {\n          v = 10.0;\n        }\n      }\n    } else {\n      // Last arrow\n      // if (JXG.exists(ev_la.type)) {\n      //     type = Type.evaluate(ev_la.type);\n      // }\n      //type = a.typeLast;\n\n      v = 10.0;\n      if (type === 2) {\n        node3.setAttributeNS(null, \"d\", \"M 0,0 L 10,5 L 0,10 L 5,5 z\");\n      } else if (type === 3) {\n        v = 3.3;\n        node3.setAttributeNS(null, \"d\", \"M 0,0 L 3.33,0 L 3.33,10 L 0,10 z\");\n      } else if (type === 4) {\n        // insetRatio:0.8 tipAngle:45 wingCurve:15 tailCurve:0\n        h = 3.31;\n        node3.setAttributeNS(null, \"d\", \"M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31\");\n      } else if (type === 5) {\n        // insetRatio:0.9 tipAngle:40 wingCurve:5 tailCurve:15\n        h = 3.28;\n        node3.setAttributeNS(null, \"d\", \"M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28\");\n      } else if (type === 6) {\n        // insetRatio:0.9 tipAngle:35 wingCurve:5 tailCurve:0\n        h = 2.84;\n        node3.setAttributeNS(null, \"d\", \"M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84\");\n      } else if (type === 7) {\n        // insetRatio:0.9 tipAngle:60 wingCurve:30 tailCurve:0\n        h = 5.2;\n        node3.setAttributeNS(null, \"d\", \"M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20\");\n      } else {\n        // type == 1 or > 6\n        node3.setAttributeNS(null, \"d\", \"M 0,0 L 10,5 L 0,10 z\");\n      }\n      if (\n      // !Type.exists(el.rendNode.getTotalLength) &&\n      el.elementClass === Const.OBJECT_CLASS_LINE) {\n        if (type === 2) {\n          v = 5.1;\n        } else if (type === 3) {\n          v = 0.02;\n        } else if (type === 4 || type === 5 || type === 6) {\n          v = 3.33;\n        } else if (type === 7) {\n          v = 10.0;\n        } else {\n          v = 0.05;\n        }\n      }\n    }\n    if (type === 7) {\n      node2.setAttributeNS(null, \"fill\", \"none\");\n      node2.setAttributeNS(null, \"stroke-width\", 1); // this is the stroke-width of the arrow head.\n    }\n    node2.setAttributeNS(null, \"refY\", h);\n    node2.setAttributeNS(null, \"refX\", v);\n    node2.appendChild(node3);\n    return node2;\n  },\n  /**\n   * Updates color of an arrow DOM node.\n   * @param {Node} node The arrow node.\n   * @param {String} color Color value in a HTML compatible format, e.g. <tt>#00ff00</tt> or <tt>green</tt> for green.\n   * @param {Number} opacity\n   * @param {JXG.GeometryElement} el The element the arrows are to be attached to\n   */\n  _setArrowColor: function (node, color, opacity, el, type) {\n    if (node) {\n      if (Type.isString(color)) {\n        if (type !== 7) {\n          this._setAttribute(function () {\n            node.setAttributeNS(null, \"stroke\", color);\n            node.setAttributeNS(null, \"fill\", color);\n            node.setAttributeNS(null, \"stroke-opacity\", opacity);\n            node.setAttributeNS(null, \"fill-opacity\", opacity);\n          }, el.visPropOld.fillcolor);\n        } else {\n          this._setAttribute(function () {\n            node.setAttributeNS(null, \"fill\", \"none\");\n            node.setAttributeNS(null, \"stroke\", color);\n            node.setAttributeNS(null, \"stroke-opacity\", opacity);\n          }, el.visPropOld.fillcolor);\n        }\n      }\n      if (this.isIE) {\n        el.rendNode.parentNode.insertBefore(el.rendNode, el.rendNode);\n      }\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  _setArrowWidth: function (node, width, parentNode, size) {\n    var s, d;\n    if (node) {\n      // if (width === 0) {\n      //     // display:none does not work well in webkit\n      //     node.setAttributeNS(null, 'display', 'none');\n      // } else {\n      s = width;\n      d = s * size;\n      node.setAttributeNS(null, \"viewBox\", 0 + \" \" + 0 + \" \" + s * 10 + \" \" + s * 10);\n      node.setAttributeNS(null, \"markerHeight\", d);\n      node.setAttributeNS(null, \"markerWidth\", d);\n      node.setAttributeNS(null, \"display\", \"inherit\");\n      // }\n\n      if (this.isIE) {\n        parentNode.parentNode.insertBefore(parentNode, parentNode);\n      }\n    }\n  },\n  /* ******************************** *\n   *  This renderer does not need to\n   *  override draw/update* methods\n   *  since it provides draw/update*Prim\n   *  methods except for some cases like\n   *  internal texts or images.\n   * ******************************** */\n\n  /* **************************\n   *    Lines\n   * **************************/\n\n  // documented in AbstractRenderer\n  updateTicks: function (ticks) {\n    var i,\n      j,\n      c,\n      node,\n      x,\n      y,\n      tickStr = \"\",\n      len = ticks.ticks.length,\n      len2,\n      str,\n      isReal = true;\n    for (i = 0; i < len; i++) {\n      c = ticks.ticks[i];\n      x = c[0];\n      y = c[1];\n      len2 = x.length;\n      str = \" M \" + x[0] + \" \" + y[0];\n      if (!Type.isNumber(x[0])) {\n        isReal = false;\n      }\n      for (j = 1; isReal && j < len2; ++j) {\n        if (Type.isNumber(x[j])) {\n          str += \" L \" + x[j] + \" \" + y[j];\n        } else {\n          isReal = false;\n        }\n      }\n      if (isReal) {\n        tickStr += str;\n      }\n    }\n    node = ticks.rendNode;\n    if (!Type.exists(node)) {\n      node = this.createPrim(\"path\", ticks.id);\n      this.appendChildPrim(node, Type.evaluate(ticks.visProp.layer));\n      ticks.rendNode = node;\n    }\n    node.setAttributeNS(null, \"stroke\", Type.evaluate(ticks.visProp.strokecolor));\n    node.setAttributeNS(null, \"fill\", \"none\");\n    // node.setAttributeNS(null, 'fill', Type.evaluate(ticks.visProp.fillcolor));\n    // node.setAttributeNS(null, 'fill-opacity', Type.evaluate(ticks.visProp.fillopacity));\n    node.setAttributeNS(null, \"stroke-opacity\", Type.evaluate(ticks.visProp.strokeopacity));\n    node.setAttributeNS(null, \"stroke-width\", Type.evaluate(ticks.visProp.strokewidth));\n    this.updatePathPrim(node, tickStr, ticks.board);\n    this.setObjectViewport(ticks);\n  },\n  /* **************************\n   *    Text related stuff\n   * **************************/\n\n  // Already documented in JXG.AbstractRenderer\n  displayCopyright: function (str, fontsize) {\n    var node = this.createPrim(\"text\", 'licenseText'),\n      t;\n    node.setAttributeNS(null, 'x', '20px');\n    node.setAttributeNS(null, 'y', 2 + fontsize + 'px');\n    node.setAttributeNS(null, 'style', 'font-family:Arial,Helvetica,sans-serif; font-size:' + fontsize + 'px; fill:#356AA0;  opacity:0.3;');\n    t = this.container.ownerDocument.createTextNode(str);\n    node.appendChild(t);\n    this.appendChildPrim(node, 0);\n  },\n  // Already documented in JXG.AbstractRenderer\n  drawInternalText: function (el) {\n    var node = this.createPrim(\"text\", el.id);\n\n    //node.setAttributeNS(null, \"style\", \"alignment-baseline:middle\"); // Not yet supported by Firefox\n    // Preserve spaces\n    //node.setAttributeNS(\"http://www.w3.org/XML/1998/namespace\", \"space\", \"preserve\");\n    node.style.whiteSpace = \"nowrap\";\n    el.rendNodeText = this.container.ownerDocument.createTextNode(\"\");\n    node.appendChild(el.rendNodeText);\n    this.appendChildPrim(node, Type.evaluate(el.visProp.layer));\n    return node;\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateInternalText: function (el) {\n    var content = el.plaintext,\n      v,\n      ev_ax = el.getAnchorX(),\n      ev_ay = el.getAnchorY();\n    if (el.rendNode.getAttributeNS(null, \"class\") !== el.visProp.cssclass) {\n      el.rendNode.setAttributeNS(null, \"class\", Type.evaluate(el.visProp.cssclass));\n      el.needsSizeUpdate = true;\n    }\n    if (!isNaN(el.coords.scrCoords[1] + el.coords.scrCoords[2])) {\n      // Horizontal\n      v = el.coords.scrCoords[1];\n      if (el.visPropOld.left !== ev_ax + v) {\n        el.rendNode.setAttributeNS(null, \"x\", v + \"px\");\n        if (ev_ax === \"left\") {\n          el.rendNode.setAttributeNS(null, \"text-anchor\", \"start\");\n        } else if (ev_ax === \"right\") {\n          el.rendNode.setAttributeNS(null, \"text-anchor\", \"end\");\n        } else if (ev_ax === \"middle\") {\n          el.rendNode.setAttributeNS(null, \"text-anchor\", \"middle\");\n        }\n        el.visPropOld.left = ev_ax + v;\n      }\n\n      // Vertical\n      v = el.coords.scrCoords[2];\n      if (el.visPropOld.top !== ev_ay + v) {\n        el.rendNode.setAttributeNS(null, \"y\", v + this.vOffsetText * 0.5 + \"px\");\n        if (ev_ay === \"bottom\") {\n          el.rendNode.setAttributeNS(null, \"dominant-baseline\", \"text-after-edge\");\n        } else if (ev_ay === \"top\") {\n          el.rendNode.setAttributeNS(null, \"dy\", \"1.6ex\");\n          //el.rendNode.setAttributeNS(null, 'dominant-baseline', 'text-before-edge'); // Not supported by IE, edge\n        } else if (ev_ay === \"middle\") {\n          //el.rendNode.setAttributeNS(null, 'dominant-baseline', 'middle');\n          el.rendNode.setAttributeNS(null, \"dy\", \"0.6ex\");\n        }\n        el.visPropOld.top = ev_ay + v;\n      }\n    }\n    if (el.htmlStr !== content) {\n      el.rendNodeText.data = content;\n      el.htmlStr = content;\n    }\n    this.transformImage(el, el.transformations);\n  },\n  /**\n   * Set color and opacity of internal texts.\n   * @private\n   * @see JXG.AbstractRenderer#updateTextStyle\n   * @see JXG.AbstractRenderer#updateInternalTextStyle\n   */\n  updateInternalTextStyle: function (el, strokeColor, strokeOpacity, duration) {\n    this.setObjectViewport(el);\n    this.setObjectFillColor(el, strokeColor, strokeOpacity);\n  },\n  /* **************************\n   *    Image related stuff\n   * **************************/\n\n  // Already documented in JXG.AbstractRenderer\n  drawImage: function (el) {\n    var node = this.createPrim(\"image\", el.id);\n    node.setAttributeNS(null, \"preserveAspectRatio\", \"none\");\n    this.appendChildPrim(node, Type.evaluate(el.visProp.layer));\n    el.rendNode = node;\n    this.updateImage(el);\n  },\n  // Already documented in JXG.AbstractRenderer\n  transformImage: function (el, t) {\n    var s,\n      m,\n      node = el.rendNode,\n      str = \"\",\n      cx,\n      cy,\n      len = t.length;\n    if (len > 0) {\n      m = this.joinTransforms(el, t);\n      s = [m[1][1], m[2][1], m[1][2], m[2][2], m[1][0], m[2][0]].join(\",\");\n      if (s.indexOf('NaN') === -1) {\n        str += \" matrix(\" + s + \") \";\n        if (el.elementClass === Const.OBJECT_CLASS_TEXT && el.visProp.display === 'html') {\n          node.style.transform = str;\n          cx = -el.coords.scrCoords[1];\n          cy = -el.coords.scrCoords[2];\n          switch (Type.evaluate(el.visProp.anchorx)) {\n            case 'right':\n              cx += el.size[0];\n              break;\n            case 'middle':\n              cx += el.size[0] * 0.5;\n              break;\n          }\n          switch (Type.evaluate(el.visProp.anchory)) {\n            case 'bottom':\n              cy += el.size[1];\n              break;\n            case 'middle':\n              cy += el.size[1] * 0.5;\n              break;\n          }\n          node.style['transform-origin'] = cx + 'px ' + cy + 'px';\n        } else {\n          // Images and texts with display:'internal'\n          node.setAttributeNS(null, \"transform\", str);\n        }\n      }\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateImageURL: function (el) {\n    var url = Type.evaluate(el.url);\n    if (el._src !== url) {\n      el.imgIsLoaded = false;\n      el.rendNode.setAttributeNS(this.xlinkNamespace, \"xlink:href\", url);\n      el._src = url;\n      return true;\n    }\n    return false;\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateImageStyle: function (el, doHighlight) {\n    var css = Type.evaluate(doHighlight ? el.visProp.highlightcssclass : el.visProp.cssclass);\n    el.rendNode.setAttributeNS(null, \"class\", css);\n  },\n  // Already documented in JXG.AbstractRenderer\n  drawForeignObject: function (el) {\n    el.rendNode = this.appendChildPrim(this.createPrim(\"foreignObject\", el.id), Type.evaluate(el.visProp.layer));\n    this.appendNodesToElement(el, \"foreignObject\");\n    this.updateForeignObject(el);\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateForeignObject: function (el) {\n    if (el._useUserSize) {\n      el.rendNode.style.overflow = \"hidden\";\n    } else {\n      el.rendNode.style.overflow = \"visible\";\n    }\n    this.updateRectPrim(el.rendNode, el.coords.scrCoords[1], el.coords.scrCoords[2] - el.size[1], el.size[0], el.size[1]);\n    el.rendNode.innerHTML = el.content;\n    this._updateVisual(el, {\n      stroke: true,\n      dash: true\n    }, true);\n  },\n  /* **************************\n   * Render primitive objects\n   * **************************/\n\n  // Already documented in JXG.AbstractRenderer\n  appendChildPrim: function (node, level) {\n    if (!Type.exists(level)) {\n      // trace nodes have level not set\n      level = 0;\n    } else if (level >= Options.layer.numlayers) {\n      level = Options.layer.numlayers - 1;\n    }\n    this.layer[level].appendChild(node);\n    return node;\n  },\n  // Already documented in JXG.AbstractRenderer\n  createPrim: function (type, id) {\n    var node = this.container.ownerDocument.createElementNS(this.svgNamespace, type);\n    node.setAttributeNS(null, \"id\", this.uniqName(id));\n    node.style.position = \"absolute\";\n    if (type === \"path\") {\n      node.setAttributeNS(null, \"stroke-linecap\", \"round\");\n      node.setAttributeNS(null, \"stroke-linejoin\", \"round\");\n      node.setAttributeNS(null, \"fill-rule\", \"evenodd\");\n    }\n    return node;\n  },\n  // Already documented in JXG.AbstractRenderer\n  remove: function (shape) {\n    if (Type.exists(shape) && Type.exists(shape.parentNode)) {\n      shape.parentNode.removeChild(shape);\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  setLayer: function (el, level) {\n    if (!Type.exists(level)) {\n      level = 0;\n    } else if (level >= Options.layer.numlayers) {\n      level = Options.layer.numlayers - 1;\n    }\n    this.layer[level].appendChild(el.rendNode);\n  },\n  // Already documented in JXG.AbstractRenderer\n  makeArrows: function (el, a) {\n    var node2,\n      str,\n      ev_fa = a.evFirst,\n      ev_la = a.evLast;\n    if (this.isIE && el.visPropCalc.visible && (ev_fa || ev_la)) {\n      el.rendNode.parentNode.insertBefore(el.rendNode, el.rendNode);\n      return;\n    }\n\n    // We can not compare against visPropOld if there is need for a new arrow head,\n    // since here visPropOld and ev_fa / ev_la already have the same value.\n    // This has been set in _updateVisual.\n    //\n    node2 = el.rendNodeTriangleStart;\n    if (ev_fa) {\n      str = this.toStr(this.container.id, '_', el.id, 'TriangleStart', a.typeFirst);\n      if (!Type.exists(node2) || node2.id !== str) {\n        node2 = this.container.ownerDocument.getElementById(str);\n        // Check if the marker already exists.\n        // If not, create a new marker\n        if (node2 === null) {\n          node2 = this._createArrowHead(el, \"Start\", a.typeFirst);\n          this.defs.appendChild(node2);\n        }\n        el.rendNodeTriangleStart = node2;\n        el.rendNode.setAttributeNS(null, \"marker-start\", this.toURL(str));\n      }\n    } else if (Type.exists(node2)) {\n      this.remove(node2);\n    }\n    node2 = el.rendNodeTriangleEnd;\n    if (ev_la) {\n      str = this.toStr(this.container.id, '_', el.id, 'TriangleEnd', a.typeLast);\n      if (!Type.exists(node2) || node2.id !== str) {\n        node2 = this.container.ownerDocument.getElementById(str);\n        // Check if the marker already exists.\n        // If not, create a new marker\n        if (node2 === null) {\n          node2 = this._createArrowHead(el, \"End\", a.typeLast);\n          this.defs.appendChild(node2);\n        }\n        el.rendNodeTriangleEnd = node2;\n        el.rendNode.setAttributeNS(null, \"marker-end\", this.toURL(str));\n      }\n    } else if (Type.exists(node2)) {\n      this.remove(node2);\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateEllipsePrim: function (node, x, y, rx, ry) {\n    var huge = 1000000;\n    huge = 200000; // IE\n    // webkit does not like huge values if the object is dashed\n    // iE doesn't like huge values above 216000\n    x = Math.abs(x) < huge ? x : huge * x / Math.abs(x);\n    y = Math.abs(y) < huge ? y : huge * y / Math.abs(y);\n    rx = Math.abs(rx) < huge ? rx : huge * rx / Math.abs(rx);\n    ry = Math.abs(ry) < huge ? ry : huge * ry / Math.abs(ry);\n    node.setAttributeNS(null, \"cx\", x);\n    node.setAttributeNS(null, \"cy\", y);\n    node.setAttributeNS(null, \"rx\", Math.abs(rx));\n    node.setAttributeNS(null, \"ry\", Math.abs(ry));\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateLinePrim: function (node, p1x, p1y, p2x, p2y) {\n    var huge = 1000000;\n    huge = 200000; //IE\n    if (!isNaN(p1x + p1y + p2x + p2y)) {\n      // webkit does not like huge values if the object is dashed\n      // IE doesn't like huge values above 216000\n      p1x = Math.abs(p1x) < huge ? p1x : huge * p1x / Math.abs(p1x);\n      p1y = Math.abs(p1y) < huge ? p1y : huge * p1y / Math.abs(p1y);\n      p2x = Math.abs(p2x) < huge ? p2x : huge * p2x / Math.abs(p2x);\n      p2y = Math.abs(p2y) < huge ? p2y : huge * p2y / Math.abs(p2y);\n      node.setAttributeNS(null, \"x1\", p1x);\n      node.setAttributeNS(null, \"y1\", p1y);\n      node.setAttributeNS(null, \"x2\", p2x);\n      node.setAttributeNS(null, \"y2\", p2y);\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  updatePathPrim: function (node, pointString) {\n    if (pointString === \"\") {\n      pointString = \"M 0 0\";\n    }\n    node.setAttributeNS(null, \"d\", pointString);\n  },\n  // Already documented in JXG.AbstractRenderer\n  updatePathStringPoint: function (el, size, type) {\n    var s = \"\",\n      scr = el.coords.scrCoords,\n      sqrt32 = size * Math.sqrt(3) * 0.5,\n      s05 = size * 0.5;\n    if (type === \"x\") {\n      s = \" M \" + (scr[1] - size) + \" \" + (scr[2] - size) + \" L \" + (scr[1] + size) + \" \" + (scr[2] + size) + \" M \" + (scr[1] + size) + \" \" + (scr[2] - size) + \" L \" + (scr[1] - size) + \" \" + (scr[2] + size);\n    } else if (type === \"+\") {\n      s = \" M \" + (scr[1] - size) + \" \" + scr[2] + \" L \" + (scr[1] + size) + \" \" + scr[2] + \" M \" + scr[1] + \" \" + (scr[2] - size) + \" L \" + scr[1] + \" \" + (scr[2] + size);\n    } else if (type === \"|\") {\n      s = \" M \" + scr[1] + \" \" + (scr[2] - size) + \" L \" + scr[1] + \" \" + (scr[2] + size);\n    } else if (type === \"-\") {\n      s = \" M \" + (scr[1] - size) + \" \" + scr[2] + \" L \" + (scr[1] + size) + \" \" + scr[2];\n    } else if (type === \"<>\" || type === \"<<>>\") {\n      if (type === \"<<>>\") {\n        size *= 1.41;\n      }\n      s = \" M \" + (scr[1] - size) + \" \" + scr[2] + \" L \" + scr[1] + \" \" + (scr[2] + size) + \" L \" + (scr[1] + size) + \" \" + scr[2] + \" L \" + scr[1] + \" \" + (scr[2] - size) + \" Z \";\n    } else if (type === \"^\") {\n      s = \" M \" + scr[1] + \" \" + (scr[2] - size) + \" L \" + (scr[1] - sqrt32) + \" \" + (scr[2] + s05) + \" L \" + (scr[1] + sqrt32) + \" \" + (scr[2] + s05) + \" Z \"; // close path\n    } else if (type === \"v\") {\n      s = \" M \" + scr[1] + \" \" + (scr[2] + size) + \" L \" + (scr[1] - sqrt32) + \" \" + (scr[2] - s05) + \" L \" + (scr[1] + sqrt32) + \" \" + (scr[2] - s05) + \" Z \";\n    } else if (type === \">\") {\n      s = \" M \" + (scr[1] + size) + \" \" + scr[2] + \" L \" + (scr[1] - s05) + \" \" + (scr[2] - sqrt32) + \" L \" + (scr[1] - s05) + \" \" + (scr[2] + sqrt32) + \" Z \";\n    } else if (type === \"<\") {\n      s = \" M \" + (scr[1] - size) + \" \" + scr[2] + \" L \" + (scr[1] + s05) + \" \" + (scr[2] - sqrt32) + \" L \" + (scr[1] + s05) + \" \" + (scr[2] + sqrt32) + \" Z \";\n    }\n    return s;\n  },\n  // Already documented in JXG.AbstractRenderer\n  updatePathStringPrim: function (el) {\n    var i,\n      scr,\n      len,\n      symbm = \" M \",\n      symbl = \" L \",\n      symbc = \" C \",\n      nextSymb = symbm,\n      maxSize = 5000.0,\n      pStr = \"\";\n    if (el.numberPoints <= 0) {\n      return \"\";\n    }\n    len = Math.min(el.points.length, el.numberPoints);\n    if (el.bezierDegree === 1) {\n      for (i = 0; i < len; i++) {\n        scr = el.points[i].scrCoords;\n        if (isNaN(scr[1]) || isNaN(scr[2])) {\n          // PenUp\n          nextSymb = symbm;\n        } else {\n          // Chrome has problems with values being too far away.\n          scr[1] = Math.max(Math.min(scr[1], maxSize), -maxSize);\n          scr[2] = Math.max(Math.min(scr[2], maxSize), -maxSize);\n\n          // Attention: first coordinate may be inaccurate if far way\n          //pStr += [nextSymb, scr[1], ' ', scr[2]].join('');\n          pStr += nextSymb + scr[1] + \" \" + scr[2]; // Seems to be faster now (webkit and firefox)\n          nextSymb = symbl;\n        }\n      }\n    } else if (el.bezierDegree === 3) {\n      i = 0;\n      while (i < len) {\n        scr = el.points[i].scrCoords;\n        if (isNaN(scr[1]) || isNaN(scr[2])) {\n          // PenUp\n          nextSymb = symbm;\n        } else {\n          pStr += nextSymb + scr[1] + \" \" + scr[2];\n          if (nextSymb === symbc) {\n            i += 1;\n            scr = el.points[i].scrCoords;\n            pStr += \" \" + scr[1] + \" \" + scr[2];\n            i += 1;\n            scr = el.points[i].scrCoords;\n            pStr += \" \" + scr[1] + \" \" + scr[2];\n          }\n          nextSymb = symbc;\n        }\n        i += 1;\n      }\n    }\n    return pStr;\n  },\n  // Already documented in JXG.AbstractRenderer\n  updatePathStringBezierPrim: function (el) {\n    var i,\n      j,\n      k,\n      scr,\n      lx,\n      ly,\n      len,\n      symbm = \" M \",\n      symbl = \" C \",\n      nextSymb = symbm,\n      maxSize = 5000.0,\n      pStr = \"\",\n      f = Type.evaluate(el.visProp.strokewidth),\n      isNoPlot = Type.evaluate(el.visProp.curvetype) !== \"plot\";\n    if (el.numberPoints <= 0) {\n      return \"\";\n    }\n    if (isNoPlot && el.board.options.curve.RDPsmoothing) {\n      el.points = Numerics.RamerDouglasPeucker(el.points, 0.5);\n    }\n    len = Math.min(el.points.length, el.numberPoints);\n    for (j = 1; j < 3; j++) {\n      nextSymb = symbm;\n      for (i = 0; i < len; i++) {\n        scr = el.points[i].scrCoords;\n        if (isNaN(scr[1]) || isNaN(scr[2])) {\n          // PenUp\n          nextSymb = symbm;\n        } else {\n          // Chrome has problems with values being too far away.\n          scr[1] = Math.max(Math.min(scr[1], maxSize), -maxSize);\n          scr[2] = Math.max(Math.min(scr[2], maxSize), -maxSize);\n\n          // Attention: first coordinate may be inaccurate if far way\n          if (nextSymb === symbm) {\n            //pStr += [nextSymb, scr[1], ' ', scr[2]].join('');\n            pStr += nextSymb + scr[1] + \" \" + scr[2]; // Seems to be faster now (webkit and firefox)\n          } else {\n            k = 2 * j;\n            pStr += [nextSymb, lx + (scr[1] - lx) * 0.333 + f * (k * Math.random() - j), \" \", ly + (scr[2] - ly) * 0.333 + f * (k * Math.random() - j), \" \", lx + (scr[1] - lx) * 0.666 + f * (k * Math.random() - j), \" \", ly + (scr[2] - ly) * 0.666 + f * (k * Math.random() - j), \" \", scr[1], \" \", scr[2]].join(\"\");\n          }\n          nextSymb = symbl;\n          lx = scr[1];\n          ly = scr[2];\n        }\n      }\n    }\n    return pStr;\n  },\n  // Already documented in JXG.AbstractRenderer\n  updatePolygonPrim: function (node, el) {\n    var i,\n      pStr = \"\",\n      scrCoords,\n      len = el.vertices.length;\n    node.setAttributeNS(null, \"stroke\", \"none\");\n    node.setAttributeNS(null, \"fill-rule\", \"evenodd\");\n    if (el.elType === \"polygonalchain\") {\n      len++;\n    }\n    for (i = 0; i < len - 1; i++) {\n      if (el.vertices[i].isReal) {\n        scrCoords = el.vertices[i].coords.scrCoords;\n        pStr = pStr + scrCoords[1] + \",\" + scrCoords[2];\n      } else {\n        node.setAttributeNS(null, \"points\", \"\");\n        return;\n      }\n      if (i < len - 2) {\n        pStr += \" \";\n      }\n    }\n    if (pStr.indexOf(\"NaN\") === -1) {\n      node.setAttributeNS(null, \"points\", pStr);\n    }\n  },\n  // Already documented in JXG.AbstractRenderer\n  updateRectPrim: function (node, x, y, w, h) {\n    node.setAttributeNS(null, \"x\", x);\n    node.setAttributeNS(null, \"y\", y);\n    node.setAttributeNS(null, \"width\", w);\n    node.setAttributeNS(null, \"height\", h);\n  },\n  /* **************************\n   *  Set Attributes\n   * **************************/\n\n  // documented in JXG.AbstractRenderer\n  setPropertyPrim: function (node, key, val) {\n    if (key === \"stroked\") {\n      return;\n    }\n    node.setAttributeNS(null, key, val);\n  },\n  display: function (el, val) {\n    var node;\n    if (el && el.rendNode) {\n      el.visPropOld.visible = val;\n      node = el.rendNode;\n      if (val) {\n        node.setAttributeNS(null, \"display\", \"inline\");\n        node.style.visibility = \"inherit\";\n      } else {\n        node.setAttributeNS(null, \"display\", \"none\");\n        node.style.visibility = \"hidden\";\n      }\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  show: function (el) {\n    JXG.deprecated(\"Board.renderer.show()\", \"Board.renderer.display()\");\n    this.display(el, true);\n    // var node;\n    //\n    // if (el && el.rendNode) {\n    //     node = el.rendNode;\n    //     node.setAttributeNS(null, 'display', 'inline');\n    //     node.style.visibility = \"inherit\";\n    // }\n  },\n  // documented in JXG.AbstractRenderer\n  hide: function (el) {\n    JXG.deprecated(\"Board.renderer.hide()\", \"Board.renderer.display()\");\n    this.display(el, false);\n    // var node;\n    //\n    // if (el && el.rendNode) {\n    //     node = el.rendNode;\n    //     node.setAttributeNS(null, 'display', 'none');\n    //     node.style.visibility = \"hidden\";\n    // }\n  },\n  // documented in JXG.AbstractRenderer\n  setBuffering: function (el, type) {\n    el.rendNode.setAttribute(\"buffered-rendering\", type);\n  },\n  // documented in JXG.AbstractRenderer\n  setDashStyle: function (el) {\n    var dashStyle = Type.evaluate(el.visProp.dash),\n      ds = Type.evaluate(el.visProp.dashscale),\n      sw = ds ? 0.5 * Type.evaluate(el.visProp.strokewidth) : 1,\n      node = el.rendNode;\n    if (dashStyle > 0) {\n      node.setAttributeNS(null, \"stroke-dasharray\",\n      // sw could distinguish highlighting or not.\n      // But it seems to preferable to ignore this.\n      this.dashArray[dashStyle - 1].map(function (x) {\n        return x * sw;\n      }).join(','));\n    } else {\n      if (node.hasAttributeNS(null, \"stroke-dasharray\")) {\n        node.removeAttributeNS(null, \"stroke-dasharray\");\n      }\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  setGradient: function (el) {\n    var fillNode = el.rendNode,\n      node,\n      node2,\n      node3,\n      ev_g = Type.evaluate(el.visProp.gradient);\n    if (ev_g === \"linear\" || ev_g === \"radial\") {\n      node = this.createPrim(ev_g + \"Gradient\", el.id + \"_gradient\");\n      node2 = this.createPrim(\"stop\", el.id + \"_gradient1\");\n      node3 = this.createPrim(\"stop\", el.id + \"_gradient2\");\n      node.appendChild(node2);\n      node.appendChild(node3);\n      this.defs.appendChild(node);\n      fillNode.setAttributeNS(null, 'style',\n      // \"fill:url(#\" + this.container.id + \"_\" + el.id + \"_gradient)\"\n      'fill:' + this.toURL(this.container.id + '_' + el.id + '_gradient'));\n      el.gradNode1 = node2;\n      el.gradNode2 = node3;\n      el.gradNode = node;\n    } else {\n      fillNode.removeAttributeNS(null, \"style\");\n    }\n  },\n  /**\n   * Set the gradient angle for linear color gradients.\n   *\n   * @private\n   * @param {SVGnode} node SVG gradient node of an arbitrary JSXGraph element.\n   * @param {Number} radians angle value in radians. 0 is horizontal from left to right, Pi/4 is vertical from top to bottom.\n   */\n  updateGradientAngle: function (node, radians) {\n    // Angles:\n    // 0: ->\n    // 90: down\n    // 180: <-\n    // 90: up\n    var f = 1.0,\n      co = Math.cos(radians),\n      si = Math.sin(radians);\n    if (Math.abs(co) > Math.abs(si)) {\n      f /= Math.abs(co);\n    } else {\n      f /= Math.abs(si);\n    }\n    if (co >= 0) {\n      node.setAttributeNS(null, \"x1\", 0);\n      node.setAttributeNS(null, \"x2\", co * f);\n    } else {\n      node.setAttributeNS(null, \"x1\", -co * f);\n      node.setAttributeNS(null, \"x2\", 0);\n    }\n    if (si >= 0) {\n      node.setAttributeNS(null, \"y1\", 0);\n      node.setAttributeNS(null, \"y2\", si * f);\n    } else {\n      node.setAttributeNS(null, \"y1\", -si * f);\n      node.setAttributeNS(null, \"y2\", 0);\n    }\n  },\n  /**\n   * Set circles for radial color gradients.\n   *\n   * @private\n   * @param {SVGnode} node SVG gradient node\n   * @param {Number} cx SVG value cx (value between 0 and 1)\n   * @param {Number} cy  SVG value cy (value between 0 and 1)\n   * @param {Number} r  SVG value r (value between 0 and 1)\n   * @param {Number} fx  SVG value fx (value between 0 and 1)\n   * @param {Number} fy  SVG value fy (value between 0 and 1)\n   * @param {Number} fr  SVG value fr (value between 0 and 1)\n   */\n  updateGradientCircle: function (node, cx, cy, r, fx, fy, fr) {\n    node.setAttributeNS(null, \"cx\", cx * 100 + \"%\"); // Center first color\n    node.setAttributeNS(null, \"cy\", cy * 100 + \"%\");\n    node.setAttributeNS(null, \"r\", r * 100 + \"%\");\n    node.setAttributeNS(null, \"fx\", fx * 100 + \"%\"); // Center second color / focal point\n    node.setAttributeNS(null, \"fy\", fy * 100 + \"%\");\n    node.setAttributeNS(null, \"fr\", fr * 100 + \"%\");\n  },\n  // documented in JXG.AbstractRenderer\n  updateGradient: function (el) {\n    var col,\n      op,\n      node2 = el.gradNode1,\n      node3 = el.gradNode2,\n      ev_g = Type.evaluate(el.visProp.gradient);\n    if (!Type.exists(node2) || !Type.exists(node3)) {\n      return;\n    }\n    op = Type.evaluate(el.visProp.fillopacity);\n    op = op > 0 ? op : 0;\n    col = Type.evaluate(el.visProp.fillcolor);\n    node2.setAttributeNS(null, \"style\", \"stop-color:\" + col + \";stop-opacity:\" + op);\n    node3.setAttributeNS(null, \"style\", \"stop-color:\" + Type.evaluate(el.visProp.gradientsecondcolor) + \";stop-opacity:\" + Type.evaluate(el.visProp.gradientsecondopacity));\n    node2.setAttributeNS(null, \"offset\", Type.evaluate(el.visProp.gradientstartoffset) * 100 + \"%\");\n    node3.setAttributeNS(null, \"offset\", Type.evaluate(el.visProp.gradientendoffset) * 100 + \"%\");\n    if (ev_g === \"linear\") {\n      this.updateGradientAngle(el.gradNode, Type.evaluate(el.visProp.gradientangle));\n    } else if (ev_g === \"radial\") {\n      this.updateGradientCircle(el.gradNode, Type.evaluate(el.visProp.gradientcx), Type.evaluate(el.visProp.gradientcy), Type.evaluate(el.visProp.gradientr), Type.evaluate(el.visProp.gradientfx), Type.evaluate(el.visProp.gradientfy), Type.evaluate(el.visProp.gradientfr));\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  setObjectTransition: function (el, duration) {\n    var node,\n      props,\n      transitionArr = [],\n      transitionStr,\n      i,\n      len = 0,\n      nodes = [\"rendNode\", \"rendNodeTriangleStart\", \"rendNodeTriangleEnd\"];\n    if (duration === undefined) {\n      duration = Type.evaluate(el.visProp.transitionduration);\n    }\n    props = Type.evaluate(el.visProp.transitionproperties);\n    if (duration === el.visPropOld.transitionduration && props === el.visPropOld.transitionproperties) {\n      return;\n    }\n\n    // if (\n    //     el.elementClass === Const.OBJECT_CLASS_TEXT &&\n    //     Type.evaluate(el.visProp.display) === \"html\"\n    // ) {\n    //     // transitionStr = \" color \" + duration + \"ms,\" +\n    //     //     \" opacity \" + duration + \"ms\";\n    //     transitionStr = \" all \" + duration + \"ms ease\";\n    // } else {\n    //     transitionStr =\n    //         \" fill \" + duration + \"ms,\" +\n    //         \" fill-opacity \" + duration + \"ms,\" +\n    //         \" stroke \" + duration + \"ms,\" +\n    //         \" stroke-opacity \" + duration + \"ms,\" +\n    //         \" stroke-width \" + duration + \"ms,\" +\n    //         \" width \" + duration + \"ms,\" +\n    //         \" height \" + duration + \"ms,\" +\n    //         \" rx \" + duration + \"ms,\" +\n    //         \" ry \" + duration + \"ms\";\n    // }\n\n    if (Type.exists(props)) {\n      len = props.length;\n    }\n    for (i = 0; i < len; i++) {\n      transitionArr.push(props[i] + ' ' + duration + 'ms');\n    }\n    transitionStr = transitionArr.join(', ');\n    len = nodes.length;\n    for (i = 0; i < len; ++i) {\n      if (el[nodes[i]]) {\n        node = el[nodes[i]];\n        node.style.transition = transitionStr;\n      }\n    }\n    el.visPropOld.transitionduration = duration;\n    el.visPropOld.transitionproperties = props;\n  },\n  // documented in JXG.AbstractRenderer\n  setObjectViewport: function (el, isHtml) {\n    var val = Type.evaluate(el.visProp.viewport),\n      vp,\n      i,\n      len = 0,\n      bb,\n      bbc,\n      l,\n      t,\n      r,\n      b,\n      nodes = ['rendNode']; //, \"rendNodeTriangleStart\", \"rendNodeTriangleEnd\"];\n\n    // Check viewport attribute of the board\n    if (val === 'inherit') {\n      val = Type.evaluate(el.board.attr.viewport);\n    }\n\n    // Required order: top, right, bottom, left\n    if (isHtml) {\n      bb = el.rendNode.getBoundingClientRect();\n      bbc = this.container.getBoundingClientRect();\n      t = parseFloat(val[1]);\n      r = parseFloat(val[2]);\n      b = parseFloat(val[3]);\n      l = parseFloat(val[0]);\n      if (Type.isString(val[1]) && val[1].indexOf('%') > 0) {\n        t = bbc.height * t / 100;\n      }\n      if (Type.isString(val[2]) && val[2].indexOf('%') > 0) {\n        r = bbc.width * r / 100;\n      }\n      if (Type.isString(val[3]) && val[3].indexOf('%') > 0) {\n        b = bbc.height * b / 100;\n      }\n      if (Type.isString(val[0]) && val[0].indexOf('%') > 0) {\n        l = bbc.width * l / 100;\n      }\n      t = parseFloat(bbc.top) - parseFloat(bb.top) + t;\n      r = parseFloat(bb.right) - parseFloat(bbc.right) + r;\n      b = parseFloat(bb.bottom) - parseFloat(bbc.bottom) + b;\n      l = parseFloat(bbc.left) - parseFloat(bb.left) + l;\n      val = [l, t, r, b];\n    }\n    vp = [typeof val[1] === 'number' ? val[1] + 'px' : val[1], typeof val[2] === 'number' ? val[2] + 'px' : val[2], typeof val[3] === 'number' ? val[3] + 'px' : val[3], typeof val[0] === 'number' ? val[0] + 'px' : val[0]].join(' ');\n    len = nodes.length;\n    for (i = 0; i < len; ++i) {\n      if (el[nodes[i]]) {\n        if (isHtml) {\n          el[nodes[i]].style.clipPath = 'inset(' + vp + ')';\n        } else {\n          el[nodes[i]].setAttributeNS(null, \"clip-path\", 'view-box inset(' + vp + ')');\n        }\n      }\n    }\n  },\n  /**\n   * Call user-defined function to set visual attributes.\n   * If \"testAttribute\" is the empty string, the function\n   * is called immediately, otherwise it is called in a timeOut.\n   *\n   * This is necessary to realize smooth transitions but avoid transitions\n   * when first creating the objects.\n   *\n   * Usually, the string in testAttribute is the visPropOld attribute\n   * of the values which are set.\n   *\n   * @param {Function} setFunc       Some function which usually sets some attributes\n   * @param {String} testAttribute If this string is the empty string  the function is called immediately,\n   *                               otherwise it is called in a setImeout.\n   * @see JXG.SVGRenderer#setObjectFillColor\n   * @see JXG.SVGRenderer#setObjectStrokeColor\n   * @see JXG.SVGRenderer#_setArrowColor\n   * @private\n   */\n  _setAttribute: function (setFunc, testAttribute) {\n    if (testAttribute === \"\") {\n      setFunc();\n    } else {\n      window.setTimeout(setFunc, 1);\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  setObjectFillColor: function (el, color, opacity, rendNode) {\n    var node,\n      c,\n      rgbo,\n      oo,\n      rgba = Type.evaluate(color),\n      o = Type.evaluate(opacity),\n      grad = Type.evaluate(el.visProp.gradient);\n    o = o > 0 ? o : 0;\n\n    // TODO  save gradient and gradientangle\n    if (el.visPropOld.fillcolor === rgba && el.visPropOld.fillopacity === o && grad === null) {\n      return;\n    }\n    if (Type.exists(rgba) && rgba !== false) {\n      if (rgba.length !== 9) {\n        // RGB, not RGBA\n        c = rgba;\n        oo = o;\n      } else {\n        // True RGBA, not RGB\n        rgbo = Color.rgba2rgbo(rgba);\n        c = rgbo[0];\n        oo = o * rgbo[1];\n      }\n      if (rendNode === undefined) {\n        node = el.rendNode;\n      } else {\n        node = rendNode;\n      }\n      if (c !== \"none\") {\n        this._setAttribute(function () {\n          node.setAttributeNS(null, \"fill\", c);\n        }, el.visPropOld.fillcolor);\n      }\n      if (el.type === JXG.OBJECT_TYPE_IMAGE) {\n        this._setAttribute(function () {\n          node.setAttributeNS(null, \"opacity\", oo);\n        }, el.visPropOld.fillopacity);\n        //node.style['opacity'] = oo;  // This would overwrite values set by CSS class.\n      } else {\n        if (c === \"none\") {\n          // This is done only for non-images\n          // because images have no fill color.\n          oo = 0;\n          // This is necessary if there is a foreignObject below.\n          node.setAttributeNS(null, \"pointer-events\", \"visibleStroke\");\n        } else {\n          // This is the default\n          node.setAttributeNS(null, \"pointer-events\", \"visiblePainted\");\n        }\n        this._setAttribute(function () {\n          node.setAttributeNS(null, \"fill-opacity\", oo);\n        }, el.visPropOld.fillopacity);\n      }\n      if (grad === \"linear\" || grad === \"radial\") {\n        this.updateGradient(el);\n      }\n    }\n    el.visPropOld.fillcolor = rgba;\n    el.visPropOld.fillopacity = o;\n  },\n  // documented in JXG.AbstractRenderer\n  setObjectStrokeColor: function (el, color, opacity) {\n    var rgba = Type.evaluate(color),\n      c,\n      rgbo,\n      o = Type.evaluate(opacity),\n      oo,\n      node;\n    o = o > 0 ? o : 0;\n    if (el.visPropOld.strokecolor === rgba && el.visPropOld.strokeopacity === o) {\n      return;\n    }\n    if (Type.exists(rgba) && rgba !== false) {\n      if (rgba.length !== 9) {\n        // RGB, not RGBA\n        c = rgba;\n        oo = o;\n      } else {\n        // True RGBA, not RGB\n        rgbo = Color.rgba2rgbo(rgba);\n        c = rgbo[0];\n        oo = o * rgbo[1];\n      }\n      node = el.rendNode;\n      if (el.elementClass === Const.OBJECT_CLASS_TEXT) {\n        if (Type.evaluate(el.visProp.display) === \"html\") {\n          this._setAttribute(function () {\n            node.style.color = c;\n            node.style.opacity = oo;\n          }, el.visPropOld.strokecolor);\n        } else {\n          this._setAttribute(function () {\n            node.setAttributeNS(null, \"style\", \"fill:\" + c);\n            node.setAttributeNS(null, \"style\", \"fill-opacity:\" + oo);\n          }, el.visPropOld.strokecolor);\n        }\n      } else {\n        this._setAttribute(function () {\n          node.setAttributeNS(null, \"stroke\", c);\n          node.setAttributeNS(null, \"stroke-opacity\", oo);\n        }, el.visPropOld.strokecolor);\n      }\n      if (el.elementClass === Const.OBJECT_CLASS_CURVE || el.elementClass === Const.OBJECT_CLASS_LINE) {\n        if (Type.evaluate(el.visProp.firstarrow)) {\n          this._setArrowColor(el.rendNodeTriangleStart, c, oo, el, el.visPropCalc.typeFirst);\n        }\n        if (Type.evaluate(el.visProp.lastarrow)) {\n          this._setArrowColor(el.rendNodeTriangleEnd, c, oo, el, el.visPropCalc.typeLast);\n        }\n      }\n    }\n    el.visPropOld.strokecolor = rgba;\n    el.visPropOld.strokeopacity = o;\n  },\n  // documented in JXG.AbstractRenderer\n  setObjectStrokeWidth: function (el, width) {\n    var node,\n      w = Type.evaluate(width);\n    if (isNaN(w) || el.visPropOld.strokewidth === w) {\n      return;\n    }\n    node = el.rendNode;\n    this.setPropertyPrim(node, \"stroked\", \"true\");\n    if (Type.exists(w)) {\n      this.setPropertyPrim(node, \"stroke-width\", w + \"px\");\n\n      // if (el.elementClass === Const.OBJECT_CLASS_CURVE ||\n      // el.elementClass === Const.OBJECT_CLASS_LINE) {\n      //     if (Type.evaluate(el.visProp.firstarrow)) {\n      //         this._setArrowWidth(el.rendNodeTriangleStart, w, el.rendNode);\n      //     }\n      //\n      //     if (Type.evaluate(el.visProp.lastarrow)) {\n      //         this._setArrowWidth(el.rendNodeTriangleEnd, w, el.rendNode);\n      //     }\n      // }\n    }\n    el.visPropOld.strokewidth = w;\n  },\n  // documented in JXG.AbstractRenderer\n  setLineCap: function (el) {\n    var capStyle = Type.evaluate(el.visProp.linecap);\n    if (capStyle === undefined || capStyle === \"\" || el.visPropOld.linecap === capStyle || !Type.exists(el.rendNode)) {\n      return;\n    }\n    this.setPropertyPrim(el.rendNode, \"stroke-linecap\", capStyle);\n    el.visPropOld.linecap = capStyle;\n  },\n  // documented in JXG.AbstractRenderer\n  setShadow: function (el) {\n    var ev_s = Type.evaluate(el.visProp.shadow),\n      ev_s_json,\n      c,\n      b,\n      bl,\n      o,\n      op,\n      id,\n      node,\n      use_board_filter = true,\n      show = false;\n    ev_s_json = JSON.stringify(ev_s);\n    if (ev_s_json === el.visPropOld.shadow) {\n      return;\n    }\n    if (typeof ev_s === 'boolean') {\n      use_board_filter = true;\n      show = ev_s;\n      c = 'none';\n      b = 3;\n      bl = 0.1;\n      o = [5, 5];\n      op = 1;\n    } else {\n      if (Type.evaluate(ev_s.enabled)) {\n        use_board_filter = false;\n        show = true;\n        c = JXG.rgbParser(Type.evaluate(ev_s.color));\n        b = Type.evaluate(ev_s.blur);\n        bl = Type.evaluate(ev_s.blend);\n        o = Type.evaluate(ev_s.offset);\n        op = Type.evaluate(ev_s.opacity);\n      } else {\n        show = false;\n      }\n    }\n    if (Type.exists(el.rendNode)) {\n      if (show) {\n        if (use_board_filter) {\n          el.rendNode.setAttributeNS(null, 'filter', this.toURL(this.container.id + '_' + 'f1'));\n          // 'url(#' + this.container.id + '_' + 'f1)');\n        } else {\n          node = this.container.ownerDocument.getElementById(id);\n          if (node) {\n            this.defs.removeChild(node);\n          }\n          id = el.rendNode.id + '_' + 'f1';\n          this.defs.appendChild(this.createShadowFilter(id, c, op, bl, b, o));\n          el.rendNode.setAttributeNS(null, 'filter', this.toURL(id));\n          // 'url(#' + id + ')');\n        }\n      } else {\n        el.rendNode.removeAttributeNS(null, 'filter');\n      }\n    }\n    el.visPropOld.shadow = ev_s_json;\n  },\n  /* **************************\n   * renderer control\n   * **************************/\n\n  // documented in JXG.AbstractRenderer\n  suspendRedraw: function () {\n    // It seems to be important for the Linux version of firefox\n    this.suspendHandle = this.svgRoot.suspendRedraw(10000);\n  },\n  // documented in JXG.AbstractRenderer\n  unsuspendRedraw: function () {\n    this.svgRoot.unsuspendRedraw(this.suspendHandle);\n    // this.svgRoot.unsuspendRedrawAll();\n    //this.svgRoot.forceRedraw();\n  },\n  // documented in AbstractRenderer\n  resize: function (w, h) {\n    this.svgRoot.setAttribute(\"width\", parseFloat(w));\n    this.svgRoot.setAttribute(\"height\", parseFloat(h));\n  },\n  // documented in JXG.AbstractRenderer\n  createTouchpoints: function (n) {\n    var i, na1, na2, node;\n    this.touchpoints = [];\n    for (i = 0; i < n; i++) {\n      na1 = \"touchpoint1_\" + i;\n      node = this.createPrim(\"path\", na1);\n      this.appendChildPrim(node, 19);\n      node.setAttributeNS(null, \"d\", \"M 0 0\");\n      this.touchpoints.push(node);\n      this.setPropertyPrim(node, \"stroked\", \"true\");\n      this.setPropertyPrim(node, \"stroke-width\", \"1px\");\n      node.setAttributeNS(null, \"stroke\", \"#000000\");\n      node.setAttributeNS(null, \"stroke-opacity\", 1.0);\n      node.setAttributeNS(null, \"display\", \"none\");\n      na2 = \"touchpoint2_\" + i;\n      node = this.createPrim(\"ellipse\", na2);\n      this.appendChildPrim(node, 19);\n      this.updateEllipsePrim(node, 0, 0, 0, 0);\n      this.touchpoints.push(node);\n      this.setPropertyPrim(node, \"stroked\", \"true\");\n      this.setPropertyPrim(node, \"stroke-width\", \"1px\");\n      node.setAttributeNS(null, \"stroke\", \"#000000\");\n      node.setAttributeNS(null, \"stroke-opacity\", 1.0);\n      node.setAttributeNS(null, \"fill\", \"#ffffff\");\n      node.setAttributeNS(null, \"fill-opacity\", 0.0);\n      node.setAttributeNS(null, \"display\", \"none\");\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  showTouchpoint: function (i) {\n    if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n      this.touchpoints[2 * i].setAttributeNS(null, \"display\", \"inline\");\n      this.touchpoints[2 * i + 1].setAttributeNS(null, \"display\", \"inline\");\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  hideTouchpoint: function (i) {\n    if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n      this.touchpoints[2 * i].setAttributeNS(null, \"display\", \"none\");\n      this.touchpoints[2 * i + 1].setAttributeNS(null, \"display\", \"none\");\n    }\n  },\n  // documented in JXG.AbstractRenderer\n  updateTouchpoint: function (i, pos) {\n    var x,\n      y,\n      d = 37;\n    if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n      x = pos[0];\n      y = pos[1];\n      this.touchpoints[2 * i].setAttributeNS(null, \"d\", \"M \" + (x - d) + \" \" + y + \" \" + \"L \" + (x + d) + \" \" + y + \" \" + \"M \" + x + \" \" + (y - d) + \" \" + \"L \" + x + \" \" + (y + d));\n      this.updateEllipsePrim(this.touchpoints[2 * i + 1], pos[0], pos[1], 25, 25);\n    }\n  },\n  /**\n   * Walk recursively through the DOM subtree of a node and collect all\n   * value attributes together with the id of that node.\n   * <b>Attention:</b> Only values of nodes having a valid id are taken.\n   * @param  {Node} node   root node of DOM subtree that will be searched recursively.\n   * @return {Array}      Array with entries of the form [id, value]\n   * @private\n   */\n  _getValuesOfDOMElements: function (node) {\n    var values = [];\n    if (node.nodeType === 1) {\n      node = node.firstChild;\n      while (node) {\n        if (node.id !== undefined && node.value !== undefined) {\n          values.push([node.id, node.value]);\n        }\n        values = values.concat(this._getValuesOfDOMElements(node));\n        node = node.nextSibling;\n      }\n    }\n    return values;\n  },\n  _getDataUri: function (url, callback) {\n    var image = new Image();\n    image.onload = function () {\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = this.naturalWidth; // or 'width' if you want a special/scaled size\n      canvas.height = this.naturalHeight; // or 'height' if you want a special/scaled size\n\n      canvas.getContext(\"2d\").drawImage(this, 0, 0);\n      callback(canvas.toDataURL(\"image/png\"));\n      canvas.remove();\n    };\n    image.src = url;\n  },\n  _getImgDataURL: function (svgRoot) {\n    var images, len, canvas, ctx, ur, i;\n    images = svgRoot.getElementsByTagName(\"image\");\n    len = images.length;\n    if (len > 0) {\n      canvas = document.createElement(\"canvas\");\n      //img = new Image();\n      for (i = 0; i < len; i++) {\n        images[i].setAttribute(\"crossorigin\", \"anonymous\");\n        //img.src = images[i].href;\n        //img.onload = function() {\n        // img.crossOrigin = \"anonymous\";\n        ctx = canvas.getContext(\"2d\");\n        canvas.width = images[i].getAttribute(\"width\");\n        canvas.height = images[i].getAttribute(\"height\");\n        try {\n          ctx.drawImage(images[i], 0, 0, canvas.width, canvas.height);\n\n          // If the image is not png, the format must be specified here\n          ur = canvas.toDataURL();\n          images[i].setAttribute(\"xlink:href\", ur);\n        } catch (err) {\n          console.log(\"CORS problem! Image can not be used\", err);\n        }\n      }\n      //canvas.remove();\n    }\n    return true;\n  },\n  /**\n   * Return a data URI of the SVG code representing the construction.\n   * The SVG code of the construction is base64 encoded. The return string starts\n   * with \"data:image/svg+xml;base64,...\".\n   *\n   * @param {Boolean} ignoreTexts If true, the foreignObject tag is set to display=none.\n   * This is necessary for older versions of Safari. Default: false\n   * @returns {String}  data URI string\n   *\n   * @example\n   * var A = board.create('point', [2, 2]);\n   *\n   * var txt = board.renderer.dumpToDataURI(false);\n   * // txt consists of a string of the form\n   * // data:image/svg+xml;base64,PHN2Zy. base64 encoded SVG..+PC9zdmc+\n   * // Behind the comma, there is the base64 encoded SVG code\n   * // which is decoded with atob().\n   * // The call of decodeURIComponent(escape(...)) is necessary\n   * // to handle unicode strings correctly.\n   * var ar = txt.split(',');\n   * document.getElementById('output').value = decodeURIComponent(escape(atob(ar[1])));\n   *\n   * </pre><div id=\"JXG1bad4bec-6d08-4ce0-9b7f-d817e8dd762d\" class=\"jxgbox\" style=\"width: 300px; height: 300px;\"></div>\n   * <textarea id=\"output2023\" rows=\"5\" cols=\"50\"></textarea>\n   * <script type=\"text/javascript\">\n   *     (function() {\n   *         var board = JXG.JSXGraph.initBoard('JXG1bad4bec-6d08-4ce0-9b7f-d817e8dd762d',\n   *             {boundingbox: [-8, 8, 8,-8], axis: true, showcopyright: false, shownavigation: false});\n   *     var A = board.create('point', [2, 2]);\n   *\n   *     var txt = board.renderer.dumpToDataURI(false);\n   *     // txt consists of a string of the form\n   *     // data:image/svg+xml;base64,PHN2Zy. base64 encoded SVG..+PC9zdmc+\n   *     // Behind the comma, there is the base64 encoded SVG code\n   *     // which is decoded with atob().\n   *     // The call of decodeURIComponent(escape(...)) is necessary\n   *     // to handle unicode strings correctly.\n   *     var ar = txt.split(',');\n   *     document.getElementById('output2023').value = decodeURIComponent(escape(atob(ar[1])));\n   *\n   *     })();\n   *\n   * </script><pre>\n   *\n   */\n  dumpToDataURI: function (ignoreTexts) {\n    var svgRoot = this.svgRoot,\n      btoa = window.btoa || Base64.encode,\n      svg,\n      i,\n      len,\n      values = [];\n\n    // Move all HTML tags (beside the SVG root) of the container\n    // to the foreignObject element inside of the svgRoot node\n    // Problem:\n    // input values are not copied. This can be verified by looking at an innerHTML output\n    // of an input element. Therefore, we do it \"by hand\".\n    if (this.container.hasChildNodes() && Type.exists(this.foreignObjLayer)) {\n      if (!ignoreTexts) {\n        this.foreignObjLayer.setAttribute(\"display\", \"inline\");\n        while (svgRoot.nextSibling) {\n          // Copy all value attributes\n          values = values.concat(this._getValuesOfDOMElements(svgRoot.nextSibling));\n          this.foreignObjLayer.appendChild(svgRoot.nextSibling);\n        }\n      }\n    }\n    this._getImgDataURL(svgRoot);\n\n    // Convert the SVG graphic into a string containing SVG code\n    svgRoot.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg = new XMLSerializer().serializeToString(svgRoot);\n    if (ignoreTexts !== true) {\n      // Handle SVG texts\n      // Insert all value attributes back into the svg string\n      len = values.length;\n      for (i = 0; i < len; i++) {\n        svg = svg.replace('id=\"' + values[i][0] + '\"', 'id=\"' + values[i][0] + '\" value=\"' + values[i][1] + '\"');\n      }\n    }\n\n    // if (false) {\n    //     // Debug: use example svg image\n    //     svg = '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" width=\"220\" height=\"220\"><rect width=\"66\" height=\"30\" x=\"21\" y=\"32\" stroke=\"#204a87\" stroke-width=\"2\" fill=\"none\" /></svg>';\n    // }\n\n    // In IE we have to remove the namespace again.\n    if ((svg.match(/xmlns=\"http:\\/\\/www.w3.org\\/2000\\/svg\"/g) || []).length > 1) {\n      svg = svg.replace(/xmlns=\"http:\\/\\/www.w3.org\\/2000\\/svg\"/g, \"\");\n    }\n\n    // Safari fails if the svg string contains a \"&nbsp;\"\n    // Obsolete with Safari 12+\n    svg = svg.replace(/&nbsp;/g, \" \");\n    svg = svg.replace(/url\\(&quot;(.*)&quot;\\)/g, \"url($1)\");\n\n    // Move all HTML tags back from\n    // the foreignObject element to the container\n    if (Type.exists(this.foreignObjLayer) && this.foreignObjLayer.hasChildNodes()) {\n      // Restore all HTML elements\n      while (this.foreignObjLayer.firstChild) {\n        this.container.appendChild(this.foreignObjLayer.firstChild);\n      }\n      this.foreignObjLayer.setAttribute(\"display\", \"none\");\n    }\n    return \"data:image/svg+xml;base64,\" + btoa(unescape(encodeURIComponent(svg)));\n  },\n  /**\n   * Convert the SVG construction into an HTML canvas image.\n   * This works for all SVG supporting browsers. Implemented as Promise.\n   * <p>\n   * Might fail if any text element or foreign object element contains SVG. This\n   * is the case e.g. for the default fullscreen symbol.\n   * <p>\n   * For IE, it is realized as function.\n   * It works from version 9, with the exception that HTML texts\n   * are ignored on IE. The drawing is done with a delay of\n   * 200 ms. Otherwise there would be problems with IE.\n   *\n   * @param {String} canvasId Id of an HTML canvas element\n   * @param {Number} w Width in pixel of the dumped image, i.e. of the canvas tag.\n   * @param {Number} h Height in pixel of the dumped image, i.e. of the canvas tag.\n   * @param {Boolean} ignoreTexts If true, the foreignObject tag is taken out from the SVG root.\n   * This is necessary for older versions of Safari. Default: false\n   * @returns {Promise}  Promise object\n   *\n   * @example\n   * \tboard.renderer.dumpToCanvas('canvas').then(function() { console.log('done'); });\n   *\n   * @example\n   *  // IE 11 example:\n   * \tboard.renderer.dumpToCanvas('canvas');\n   * \tsetTimeout(function() { console.log('done'); }, 400);\n   */\n  dumpToCanvas: function (canvasId, w, h, ignoreTexts) {\n    var svg,\n      tmpImg,\n      cv,\n      ctx,\n      doc = this.container.ownerDocument;\n\n    // Prepare the canvas element\n    cv = doc.getElementById(canvasId);\n\n    // Clear the canvas\n    /* eslint-disable no-self-assign */\n    cv.width = cv.width;\n    /* eslint-enable no-self-assign */\n\n    ctx = cv.getContext(\"2d\");\n    if (w !== undefined && h !== undefined) {\n      cv.style.width = parseFloat(w) + \"px\";\n      cv.style.height = parseFloat(h) + \"px\";\n      // Scale twice the CSS size to make the image crisp\n      // cv.setAttribute('width', 2 * parseFloat(wOrg));\n      // cv.setAttribute('height', 2 * parseFloat(hOrg));\n      // ctx.scale(2 * wOrg / w, 2 * hOrg / h);\n      cv.setAttribute(\"width\", parseFloat(w));\n      cv.setAttribute(\"height\", parseFloat(h));\n    }\n\n    // Display the SVG string as data-uri in an HTML img.\n    /**\n     * @type {Image}\n     * @ignore\n     * {ignore}\n     */\n    tmpImg = new Image();\n    svg = this.dumpToDataURI(ignoreTexts);\n    tmpImg.src = svg;\n\n    // Finally, draw the HTML img in the canvas.\n    if (!(\"Promise\" in window)) {\n      /**\n       * @function\n       * @ignore\n       */\n      tmpImg.onload = function () {\n        // IE needs a pause...\n        // Seems to be broken\n        window.setTimeout(function () {\n          try {\n            ctx.drawImage(tmpImg, 0, 0, w, h);\n          } catch (err) {\n            console.log(\"screenshots not longer supported on IE\");\n          }\n        }, 200);\n      };\n      return this;\n    }\n    return new Promise(function (resolve, reject) {\n      try {\n        tmpImg.onload = function () {\n          ctx.drawImage(tmpImg, 0, 0, w, h);\n          resolve();\n        };\n      } catch (e) {\n        reject(e);\n      }\n    });\n  },\n  /**\n   * Display SVG image in html img-tag which enables\n   * easy download for the user.\n   *\n   * Support:\n   * <ul>\n   * <li> IE: No\n   * <li> Edge: full\n   * <li> Firefox: full\n   * <li> Chrome: full\n   * <li> Safari: full (No text support in versions prior to 12).\n   * </ul>\n   *\n   * @param {JXG.Board} board Link to the board.\n   * @param {String} imgId Optional id of an img object. If given and different from the empty string,\n   * the screenshot is copied to this img object. The width and height will be set to the values of the\n   * JSXGraph container.\n   * @param {Boolean} ignoreTexts If set to true, the foreignObject is taken out of the\n   *  SVGRoot and texts are not displayed. This is mandatory for Safari. Default: false\n   * @return {Object}       the svg renderer object\n   */\n  screenshot: function (board, imgId, ignoreTexts) {\n    var node,\n      doc = this.container.ownerDocument,\n      parent = this.container.parentNode,\n      // cPos,\n      // cssTxt,\n      canvas,\n      id,\n      img,\n      button,\n      buttonText,\n      w,\n      h,\n      bas = board.attr.screenshot,\n      navbar,\n      navbarDisplay,\n      insert,\n      newImg = false,\n      _copyCanvasToImg,\n      isDebug = false;\n    if (this.type === \"no\") {\n      return this;\n    }\n    w = bas.scale * this.container.getBoundingClientRect().width;\n    h = bas.scale * this.container.getBoundingClientRect().height;\n    if (imgId === undefined || imgId === \"\") {\n      newImg = true;\n      img = new Image(); //doc.createElement('img');\n      img.style.width = w + \"px\";\n      img.style.height = h + \"px\";\n    } else {\n      newImg = false;\n      img = doc.getElementById(imgId);\n    }\n    // img.crossOrigin = 'anonymous';\n\n    // Create div which contains canvas element and close button\n    if (newImg) {\n      node = doc.createElement(\"div\");\n      node.style.cssText = bas.css;\n      node.style.width = w + \"px\";\n      node.style.height = h + \"px\";\n      node.style.zIndex = this.container.style.zIndex + 120;\n\n      // Try to position the div exactly over the JSXGraph board\n      node.style.position = \"absolute\";\n      node.style.top = this.container.offsetTop + \"px\";\n      node.style.left = this.container.offsetLeft + \"px\";\n    }\n    if (!isDebug) {\n      // Create canvas element and add it to the DOM\n      // It will be removed after the image has been stored.\n      canvas = doc.createElement(\"canvas\");\n      id = Math.random().toString(36).slice(2, 7);\n      canvas.setAttribute(\"id\", id);\n      canvas.setAttribute(\"width\", w);\n      canvas.setAttribute(\"height\", h);\n      canvas.style.width = w + \"px\";\n      canvas.style.height = w + \"px\";\n      canvas.style.display = \"none\";\n      parent.appendChild(canvas);\n    } else {\n      // Debug: use canvas element 'jxgbox_canvas' from jsxdev/dump.html\n      id = \"jxgbox_canvas\";\n      // canvas = document.getElementById(id);\n      canvas = doc.getElementById(id);\n    }\n    if (newImg) {\n      // Create close button\n      button = doc.createElement(\"span\");\n      buttonText = doc.createTextNode(\"\\u2716\");\n      button.style.cssText = bas.cssButton;\n      button.appendChild(buttonText);\n      button.onclick = function () {\n        node.parentNode.removeChild(node);\n      };\n\n      // Add all nodes\n      node.appendChild(img);\n      node.appendChild(button);\n      parent.insertBefore(node, this.container.nextSibling);\n    }\n\n    // Hide navigation bar in board\n    navbar = doc.getElementById(this.uniqName('navigationbar'));\n    if (Type.exists(navbar)) {\n      navbarDisplay = navbar.style.display;\n      navbar.style.display = \"none\";\n      insert = this.removeToInsertLater(navbar);\n    }\n    _copyCanvasToImg = function () {\n      // Show image in img tag\n      img.src = canvas.toDataURL(\"image/png\");\n\n      // Remove canvas node\n      if (!isDebug) {\n        parent.removeChild(canvas);\n      }\n    };\n\n    // Create screenshot in image element\n    if (\"Promise\" in window) {\n      this.dumpToCanvas(id, w, h, ignoreTexts).then(_copyCanvasToImg);\n    } else {\n      // IE\n      this.dumpToCanvas(id, w, h, ignoreTexts);\n      window.setTimeout(_copyCanvasToImg, 200);\n    }\n\n    // Reinsert navigation bar in board\n    if (Type.exists(navbar)) {\n      navbar.style.display = navbarDisplay;\n      insert();\n    }\n    return this;\n  }\n});\nexport default JXG.SVGRenderer;","map":{"version":3,"names":["JXG","Options","AbstractRenderer","Const","Type","Color","Base64","Numerics","SVGRenderer","container","dim","i","type","isIE","navigator","appVersion","indexOf","userAgent","match","svgRoot","svgNamespace","xlinkNamespace","style","MozUserSelect","userSelect","overflow","position","ownerDocument","createElementNS","display","resize","width","height","appendChild","defs","createShadowFilter","id","rgb","opacity","blend","blur","offset","filter","feOffset","feColor","feGaussianBlur","feBlend","mat","setAttributeNS","isArray","length","uniqName","Array","prototype","slice","call","arguments","join","toStr","str","exists","CSS","escape","toURL","apply","layer","numlayers","foreignObjLayer","setAttribute","supportsForeignObject","e","extend","_createArrowHead","el","idAppendix","node2","node3","v","h","createPrim","evaluate","visProp","strokecolor","strokeopacity","elementClass","OBJECT_CLASS_LINE","_setArrowColor","node","color","isString","_setAttribute","visPropOld","fillcolor","rendNode","parentNode","insertBefore","_setArrowWidth","size","s","d","updateTicks","ticks","j","c","x","y","tickStr","len","len2","isReal","isNumber","appendChildPrim","strokewidth","updatePathPrim","board","setObjectViewport","displayCopyright","fontsize","t","createTextNode","drawInternalText","whiteSpace","rendNodeText","updateInternalText","content","plaintext","ev_ax","getAnchorX","ev_ay","getAnchorY","getAttributeNS","cssclass","needsSizeUpdate","isNaN","coords","scrCoords","left","top","vOffsetText","htmlStr","data","transformImage","transformations","updateInternalTextStyle","strokeColor","strokeOpacity","duration","setObjectFillColor","drawImage","updateImage","m","cx","cy","joinTransforms","OBJECT_CLASS_TEXT","transform","anchorx","anchory","updateImageURL","url","_src","imgIsLoaded","updateImageStyle","doHighlight","css","highlightcssclass","drawForeignObject","appendNodesToElement","updateForeignObject","_useUserSize","updateRectPrim","innerHTML","_updateVisual","stroke","dash","level","remove","shape","removeChild","setLayer","makeArrows","a","ev_fa","evFirst","ev_la","evLast","visPropCalc","visible","rendNodeTriangleStart","typeFirst","getElementById","rendNodeTriangleEnd","typeLast","updateEllipsePrim","rx","ry","huge","Math","abs","updateLinePrim","p1x","p1y","p2x","p2y","pointString","updatePathStringPoint","scr","sqrt32","sqrt","s05","updatePathStringPrim","symbm","symbl","symbc","nextSymb","maxSize","pStr","numberPoints","min","points","bezierDegree","max","updatePathStringBezierPrim","k","lx","ly","f","isNoPlot","curvetype","options","curve","RDPsmoothing","RamerDouglasPeucker","random","updatePolygonPrim","vertices","elType","w","setPropertyPrim","key","val","visibility","show","deprecated","hide","setBuffering","setDashStyle","dashStyle","ds","dashscale","sw","dashArray","map","hasAttributeNS","removeAttributeNS","setGradient","fillNode","ev_g","gradient","gradNode1","gradNode2","gradNode","updateGradientAngle","radians","co","cos","si","sin","updateGradientCircle","r","fx","fy","fr","updateGradient","col","op","fillopacity","gradientsecondcolor","gradientsecondopacity","gradientstartoffset","gradientendoffset","gradientangle","gradientcx","gradientcy","gradientr","gradientfx","gradientfy","gradientfr","setObjectTransition","props","transitionArr","transitionStr","nodes","undefined","transitionduration","transitionproperties","push","transition","isHtml","viewport","vp","bb","bbc","l","b","attr","getBoundingClientRect","parseFloat","right","bottom","clipPath","setFunc","testAttribute","window","setTimeout","rgbo","oo","rgba","o","grad","rgba2rgbo","OBJECT_TYPE_IMAGE","setObjectStrokeColor","OBJECT_CLASS_CURVE","firstarrow","lastarrow","setObjectStrokeWidth","setLineCap","capStyle","linecap","setShadow","ev_s","shadow","ev_s_json","bl","use_board_filter","JSON","stringify","enabled","rgbParser","suspendRedraw","suspendHandle","unsuspendRedraw","createTouchpoints","n","na1","na2","touchpoints","showTouchpoint","hideTouchpoint","updateTouchpoint","pos","_getValuesOfDOMElements","values","nodeType","firstChild","value","concat","nextSibling","_getDataUri","callback","image","Image","onload","canvas","document","createElement","naturalWidth","naturalHeight","getContext","toDataURL","src","_getImgDataURL","images","ctx","ur","getElementsByTagName","getAttribute","err","console","log","dumpToDataURI","ignoreTexts","btoa","encode","svg","hasChildNodes","XMLSerializer","serializeToString","replace","unescape","encodeURIComponent","dumpToCanvas","canvasId","tmpImg","cv","doc","Promise","resolve","reject","screenshot","imgId","parent","img","button","buttonText","bas","navbar","navbarDisplay","insert","newImg","_copyCanvasToImg","isDebug","scale","cssText","zIndex","offsetTop","offsetLeft","toString","cssButton","onclick","removeToInsertLater","then"],"sources":["D:/study things/web/weblab4-main/node_modules/jsxgraph/src/renderer/svg.js"],"sourcesContent":["/*\n    Copyright 2008-2023\n        Matthias Ehmann,\n        Michael Gerhaeuser,\n        Carsten Miller,\n        Bianca Valentin,\n        Alfred Wassermann,\n        Peter Wilfahrt\n\n    This file is part of JSXGraph.\n\n    JSXGraph is free software dual licensed under the GNU LGPL or MIT License.\n\n    You can redistribute it and/or modify it under the terms of the\n\n      * GNU Lesser General Public License as published by\n        the Free Software Foundation, either version 3 of the License, or\n        (at your option) any later version\n      OR\n      * MIT License: https://github.com/jsxgraph/jsxgraph/blob/master/LICENSE.MIT\n\n    JSXGraph is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License and\n    the MIT License along with JSXGraph. If not, see <https://www.gnu.org/licenses/>\n    and <https://opensource.org/licenses/MIT/>.\n */\n\n/*global JXG: true, define: true, AMprocessNode: true, MathJax: true, document: true */\n/*jslint nomen: true, plusplus: true, newcap:true*/\n\nimport JXG from \"../jxg\";\nimport Options from \"../options\";\nimport AbstractRenderer from \"./abstract\";\nimport Const from \"../base/constants\";\nimport Type from \"../utils/type\";\nimport Color from \"../utils/color\";\nimport Base64 from \"../utils/base64\";\nimport Numerics from \"../math/numerics\";\n\n/**\n * Uses SVG to implement the rendering methods defined in {@link JXG.AbstractRenderer}.\n * @class JXG.SVGRenderer\n * @augments JXG.AbstractRenderer\n * @param {Node} container Reference to a DOM node containing the board.\n * @param {Object} dim The dimensions of the board\n * @param {Number} dim.width\n * @param {Number} dim.height\n * @see JXG.AbstractRenderer\n */\nJXG.SVGRenderer = function (container, dim) {\n    var i;\n\n    // docstring in AbstractRenderer\n    this.type = \"svg\";\n\n    this.isIE =\n        navigator.appVersion.indexOf(\"MSIE\") !== -1 || navigator.userAgent.match(/Trident\\//);\n\n    /**\n     * SVG root node\n     * @type Node\n     */\n    this.svgRoot = null;\n\n    /**\n     * The SVG Namespace used in JSXGraph.\n     * @see http://www.w3.org/TR/SVG2/\n     * @type String\n     * @default http://www.w3.org/2000/svg\n     */\n    this.svgNamespace = \"http://www.w3.org/2000/svg\";\n\n    /**\n     * The xlink namespace. This is used for images.\n     * @see http://www.w3.org/TR/xlink/\n     * @type String\n     * @default http://www.w3.org/1999/xlink\n     */\n    this.xlinkNamespace = \"http://www.w3.org/1999/xlink\";\n\n    // container is documented in AbstractRenderer.\n    // Type node\n    this.container = container;\n\n    // prepare the div container and the svg root node for use with JSXGraph\n    this.container.style.MozUserSelect = \"none\";\n    this.container.style.userSelect = \"none\";\n\n    this.container.style.overflow = \"hidden\";\n    if (this.container.style.position === \"\") {\n        this.container.style.position = \"relative\";\n    }\n\n    this.svgRoot = this.container.ownerDocument.createElementNS(this.svgNamespace, \"svg\");\n    this.svgRoot.style.overflow = \"hidden\";\n    this.svgRoot.style.display = \"block\";\n\n    this.resize(dim.width, dim.height);\n\n    //this.svgRoot.setAttributeNS(null, 'shape-rendering', 'crispEdge'); //'optimizeQuality'); //geometricPrecision');\n\n    this.container.appendChild(this.svgRoot);\n\n    /**\n     * The <tt>defs</tt> element is a container element to reference reusable SVG elements.\n     * @type Node\n     * @see https://www.w3.org/TR/SVG2/struct.html#DefsElement\n     */\n    this.defs = this.container.ownerDocument.createElementNS(this.svgNamespace, \"defs\");\n    this.svgRoot.appendChild(this.defs);\n\n    /**\n     * Filters are used to apply shadows.\n     * @type Node\n     * @see https://www.w3.org/TR/SVG2/struct.html#DefsElement\n     */\n    /**\n     * Create an SVG shadow filter. If the object's RGB color is [r,g,b], it's opacity is op, and\n     * the parameter color is given as [r', g', b'] with opacity op'\n     * the shadow will have RGB color [blend*r + r', blend*g + g', blend*b + b'] and the opacity will be equal to op * op'.\n     * Further, blur and offset can be adjusted.\n     *\n     * The shadow color is [r*ble\n     * @param {String} id Node is of the filter.\n     * @param {Array|String} rgb RGB value for the blend color or the string 'none' for default values. Default 'black'.\n     * @param {Number} opacity Value between 0 and 1, default is 1.\n     * @param {Number} blend  Value between 0 and 1, default is 0.1.\n     * @param {Number} blur  Default: 3\n     * @param {Array} offset [dx, dy]. Default is [5,5].\n     * @returns DOM node to be added to this.defs.\n     * @private\n     */\n    this.createShadowFilter = function (id, rgb, opacity, blend, blur, offset) {\n        var filter = this.container.ownerDocument.createElementNS(this.svgNamespace, 'filter'),\n            feOffset, feColor, feGaussianBlur, feBlend,\n            mat;\n\n        filter.setAttributeNS(null, 'id', id);\n        filter.setAttributeNS(null, 'width', '300%');\n        filter.setAttributeNS(null, 'height', '300%');\n        filter.setAttributeNS(null, 'filterUnits', 'userSpaceOnUse');\n\n        feOffset = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feOffset');\n        feOffset.setAttributeNS(null, 'in', 'SourceGraphic'); // b/w: SourceAlpha, Color: SourceGraphic\n        feOffset.setAttributeNS(null, 'result', 'offOut');\n        feOffset.setAttributeNS(null, 'dx', offset[0]);\n        feOffset.setAttributeNS(null, 'dy', offset[1]);\n        filter.appendChild(feOffset);\n\n        feColor = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feColorMatrix');\n        feColor.setAttributeNS(null, 'in', 'offOut');\n        feColor.setAttributeNS(null, 'result', 'colorOut');\n        feColor.setAttributeNS(null, 'type', 'matrix');\n        // See https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feColorMatrix\n        if (rgb === 'none' || !Type.isArray(rgb) || rgb.length < 3) {\n            feColor.setAttributeNS(null, 'values', '0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 ' + opacity + ' 0');\n        } else {\n            rgb[0] /= 255;\n            rgb[1] /= 255;\n            rgb[2] /= 255;\n            mat = blend + ' 0 0 0 ' + rgb[0] +\n                '  0 ' + blend + ' 0 0 ' + rgb[1] +\n                '  0 0 ' + blend + ' 0 ' + rgb[2] +\n                '  0 0 0 ' + opacity + ' 0';\n            feColor.setAttributeNS(null, 'values', mat);\n        }\n        filter.appendChild(feColor);\n\n        feGaussianBlur = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feGaussianBlur');\n        feGaussianBlur.setAttributeNS(null, 'in', 'colorOut');\n        feGaussianBlur.setAttributeNS(null, 'result', 'blurOut');\n        feGaussianBlur.setAttributeNS(null, 'stdDeviation', blur);\n        filter.appendChild(feGaussianBlur);\n\n        feBlend = this.container.ownerDocument.createElementNS(this.svgNamespace, 'feBlend');\n        feBlend.setAttributeNS(null, 'in', 'SourceGraphic');\n        feBlend.setAttributeNS(null, 'in2', 'blurOut');\n        feBlend.setAttributeNS(null, 'mode', 'normal');\n        filter.appendChild(feBlend);\n\n        return filter;\n    };\n\n    /**\n     * Create a \"unique\" string id from the arguments of the function.\n     * Concatenate all arguments by \"_\".\n     * \"Unique\" is achieved by simply prepending the container id.\n     * Do not escape the string.\n     *\n     * If the id is used in an \"url()\" call it must be eascaped.\n     *\n     * @params {String} one or strings which will be concatenated.\n     * @return {String}\n     * @private\n     */\n    this.uniqName = function () {\n        return this.container.id + '_' +\n            Array.prototype.slice.call(arguments).join('_');\n    };\n\n    /**\n     * Combine arguments to a string, joined by empty string.\n     * Masks the container id with CSS.escape.\n     *\n     * @params {String} str variable number of strings\n     * @returns String\n     * @see JXG.SVGRenderer#toURL\n     * @private\n     * @example\n     * this.toStr('aaa', '_', 'bbb', 'TriangleEnd')\n     * // Output:\n     * // xxx_bbbTriangleEnd\n     */\n    this.toStr = function() {\n        // ES6 would be [...arguments].join()\n        var str = Array.prototype.slice.call(arguments).join('');\n        // Mask special symbols like '/' and '\\' in id\n        if (Type.exists(CSS) && Type.exists(CSS.escape)) {\n            str = CSS.escape(str);\n        }\n        return str;\n    };\n\n    /**\n     * Combine arguments to an URL string of the form\n     * url(#...)\n     * Masks the container id. Calls {@link JXG.SVGRenderer#toStr}.\n     *\n     * @params {String} str variable number of strings\n     * @returns URL string\n     * @see JXG.SVGRenderer#toStr\n     * @private\n     * @example\n     * this.toURL('aaa', '_', 'bbb', 'TriangleEnd')\n     * // Output:\n     * // url(#xxx_bbbTriangleEnd)\n     */\n    this.toURL = function () {\n        return 'url(#' +\n            this.toStr.apply(this, arguments) + // Pass the arguments to toStr\n            ')';\n    };\n\n    /* Default shadow filter */\n    this.defs.appendChild(this.createShadowFilter(this.uniqName('f1'), 'none', 1, 0.1, 3, [5, 5]));\n\n    /**\n     * JSXGraph uses a layer system to sort the elements on the board. This puts certain types of elements in front\n     * of other types of elements. For the order used see {@link JXG.Options.layer}. The number of layers is documented\n     * there, too. The higher the number, the \"more on top\" are the elements on this layer.\n     * @type Array\n     */\n    this.layer = [];\n    for (i = 0; i < Options.layer.numlayers; i++) {\n        this.layer[i] = this.container.ownerDocument.createElementNS(this.svgNamespace, 'g');\n        this.svgRoot.appendChild(this.layer[i]);\n    }\n\n    try {\n        this.foreignObjLayer = this.container.ownerDocument.createElementNS(\n            this.svgNamespace,\n            \"foreignObject\"\n        );\n        this.foreignObjLayer.setAttribute(\"display\", \"none\");\n        this.foreignObjLayer.setAttribute(\"x\", 0);\n        this.foreignObjLayer.setAttribute(\"y\", 0);\n        this.foreignObjLayer.setAttribute(\"width\", \"100%\");\n        this.foreignObjLayer.setAttribute(\"height\", \"100%\");\n        this.foreignObjLayer.setAttribute(\"id\", this.uniqName('foreignObj'));\n        this.svgRoot.appendChild(this.foreignObjLayer);\n        this.supportsForeignObject = true;\n    } catch (e) {\n        this.supportsForeignObject = false;\n    }\n};\n\nJXG.SVGRenderer.prototype = new AbstractRenderer();\n\nJXG.extend(\n    JXG.SVGRenderer.prototype,\n    /** @lends JXG.SVGRenderer.prototype */ {\n        /**\n         * Creates an arrow DOM node. Arrows are displayed in SVG with a <em>marker</em> tag.\n         * @private\n         * @param {JXG.GeometryElement} el A JSXGraph element, preferably one that can have an arrow attached.\n         * @param {String} [idAppendix=''] A string that is added to the node's id.\n         * @returns {Node} Reference to the node added to the DOM.\n         */\n        _createArrowHead: function (el, idAppendix, type) {\n            var node2,\n                node3,\n                id = el.id + \"Triangle\",\n                //type = null,\n                v,\n                h;\n\n            if (Type.exists(idAppendix)) {\n                id += idAppendix;\n            }\n            if (Type.exists(type)) {\n                id += type;\n            }\n            node2 = this.createPrim(\"marker\", id);\n\n            node2.setAttributeNS(null, \"stroke\", Type.evaluate(el.visProp.strokecolor));\n            node2.setAttributeNS(\n                null,\n                \"stroke-opacity\",\n                Type.evaluate(el.visProp.strokeopacity)\n            );\n            node2.setAttributeNS(null, \"fill\", Type.evaluate(el.visProp.strokecolor));\n            node2.setAttributeNS(null, \"fill-opacity\", Type.evaluate(el.visProp.strokeopacity));\n            node2.setAttributeNS(null, \"stroke-width\", 0); // this is the stroke-width of the arrow head.\n            // Should be zero to simplify the calculations\n\n            node2.setAttributeNS(null, \"orient\", \"auto\");\n            node2.setAttributeNS(null, \"markerUnits\", \"strokeWidth\"); // 'strokeWidth' 'userSpaceOnUse');\n\n            /*\n               Types 1, 2:\n               The arrow head is an isosceles triangle with base length 10 and height 10.\n\n               Type 3:\n               A rectangle\n\n               Types 4, 5, 6:\n               Defined by Bezier curves from mp_arrowheads.html\n\n               In any case but type 3 the arrow head is 10 units long,\n               type 3 is 10 units high.\n               These 10 units are scaled to strokeWidth * arrowSize pixels, see\n               this._setArrowWidth().\n\n               See also abstractRenderer.updateLine() where the line path is shortened accordingly.\n\n               Changes here are also necessary in setArrowWidth().\n\n               So far, lines with arrow heads are shortenend to avoid overlapping of\n               arrow head and line. This is not the case for curves, yet.\n               Therefore, the offset refX has to be adapted to the path type.\n            */\n            node3 = this.container.ownerDocument.createElementNS(this.svgNamespace, \"path\");\n            h = 5;\n            if (idAppendix === \"Start\") {\n                // First arrow\n                //type = a.typeFirst;\n                // if (JXG.exists(ev_fa.type)) {\n                //     type = Type.evaluate(ev_fa.type);\n                // }\n\n                v = 0;\n                if (type === 2) {\n                    node3.setAttributeNS(null, \"d\", \"M 10,0 L 0,5 L 10,10 L 5,5 z\");\n                } else if (type === 3) {\n                    node3.setAttributeNS(null, \"d\", \"M 0,0 L 3.33,0 L 3.33,10 L 0,10 z\");\n                } else if (type === 4) {\n                    // insetRatio:0.8 tipAngle:45 wingCurve:15 tailCurve:0\n                    h = 3.31;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31\"\n                    );\n                } else if (type === 5) {\n                    // insetRatio:0.9 tipAngle:40 wingCurve:5 tailCurve:15\n                    h = 3.28;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28\"\n                    );\n                } else if (type === 6) {\n                    // insetRatio:0.9 tipAngle:35 wingCurve:5 tailCurve:0\n                    h = 2.84;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84\"\n                    );\n                } else if (type === 7) {\n                    // insetRatio:0.9 tipAngle:60 wingCurve:30 tailCurve:0\n                    h = 5.2;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20\"\n                    );\n                } else {\n                    // type == 1 or > 6\n                    node3.setAttributeNS(null, \"d\", \"M 10,0 L 0,5 L 10,10 z\");\n                }\n                if (\n                    // !Type.exists(el.rendNode.getTotalLength) &&\n                    el.elementClass === Const.OBJECT_CLASS_LINE\n                ) {\n                    if (type === 2) {\n                        v = 4.9;\n                    } else if (type === 3) {\n                        v = 3.3;\n                    } else if (type === 4 || type === 5 || type === 6) {\n                        v = 6.66;\n                    } else if (type === 7) {\n                        v = 0.0;\n                    } else {\n                        v = 10.0;\n                    }\n                }\n            } else {\n                // Last arrow\n                // if (JXG.exists(ev_la.type)) {\n                //     type = Type.evaluate(ev_la.type);\n                // }\n                //type = a.typeLast;\n\n                v = 10.0;\n                if (type === 2) {\n                    node3.setAttributeNS(null, \"d\", \"M 0,0 L 10,5 L 0,10 L 5,5 z\");\n                } else if (type === 3) {\n                    v = 3.3;\n                    node3.setAttributeNS(null, \"d\", \"M 0,0 L 3.33,0 L 3.33,10 L 0,10 z\");\n                } else if (type === 4) {\n                    // insetRatio:0.8 tipAngle:45 wingCurve:15 tailCurve:0\n                    h = 3.31;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31\"\n                    );\n                } else if (type === 5) {\n                    // insetRatio:0.9 tipAngle:40 wingCurve:5 tailCurve:15\n                    h = 3.28;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28\"\n                    );\n                } else if (type === 6) {\n                    // insetRatio:0.9 tipAngle:35 wingCurve:5 tailCurve:0\n                    h = 2.84;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84\"\n                    );\n                } else if (type === 7) {\n                    // insetRatio:0.9 tipAngle:60 wingCurve:30 tailCurve:0\n                    h = 5.2;\n                    node3.setAttributeNS(\n                        null,\n                        \"d\",\n                        \"M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20\"\n                    );\n                } else {\n                    // type == 1 or > 6\n                    node3.setAttributeNS(null, \"d\", \"M 0,0 L 10,5 L 0,10 z\");\n                }\n                if (\n                    // !Type.exists(el.rendNode.getTotalLength) &&\n                    el.elementClass === Const.OBJECT_CLASS_LINE\n                ) {\n                    if (type === 2) {\n                        v = 5.1;\n                    } else if (type === 3) {\n                        v = 0.02;\n                    } else if (type === 4 || type === 5 || type === 6) {\n                        v = 3.33;\n                    } else if (type === 7) {\n                        v = 10.0;\n                    } else {\n                        v = 0.05;\n                    }\n                }\n            }\n            if (type === 7) {\n                node2.setAttributeNS(null, \"fill\", \"none\");\n                node2.setAttributeNS(null, \"stroke-width\", 1); // this is the stroke-width of the arrow head.\n            }\n            node2.setAttributeNS(null, \"refY\", h);\n            node2.setAttributeNS(null, \"refX\", v);\n\n            node2.appendChild(node3);\n            return node2;\n        },\n\n        /**\n         * Updates color of an arrow DOM node.\n         * @param {Node} node The arrow node.\n         * @param {String} color Color value in a HTML compatible format, e.g. <tt>#00ff00</tt> or <tt>green</tt> for green.\n         * @param {Number} opacity\n         * @param {JXG.GeometryElement} el The element the arrows are to be attached to\n         */\n        _setArrowColor: function (node, color, opacity, el, type) {\n            if (node) {\n                if (Type.isString(color)) {\n                    if (type !== 7) {\n                        this._setAttribute(function () {\n                            node.setAttributeNS(null, \"stroke\", color);\n                            node.setAttributeNS(null, \"fill\", color);\n                            node.setAttributeNS(null, \"stroke-opacity\", opacity);\n                            node.setAttributeNS(null, \"fill-opacity\", opacity);\n                        }, el.visPropOld.fillcolor);\n                    } else {\n                        this._setAttribute(function () {\n                            node.setAttributeNS(null, \"fill\", \"none\");\n                            node.setAttributeNS(null, \"stroke\", color);\n                            node.setAttributeNS(null, \"stroke-opacity\", opacity);\n                        }, el.visPropOld.fillcolor);\n                    }\n                }\n\n                if (this.isIE) {\n                    el.rendNode.parentNode.insertBefore(el.rendNode, el.rendNode);\n                }\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        _setArrowWidth: function (node, width, parentNode, size) {\n            var s, d;\n\n            if (node) {\n                // if (width === 0) {\n                //     // display:none does not work well in webkit\n                //     node.setAttributeNS(null, 'display', 'none');\n                // } else {\n                s = width;\n                d = s * size;\n                node.setAttributeNS(null, \"viewBox\", 0 + \" \" + 0 + \" \" + s * 10 + \" \" + s * 10);\n                node.setAttributeNS(null, \"markerHeight\", d);\n                node.setAttributeNS(null, \"markerWidth\", d);\n                node.setAttributeNS(null, \"display\", \"inherit\");\n                // }\n\n                if (this.isIE) {\n                    parentNode.parentNode.insertBefore(parentNode, parentNode);\n                }\n            }\n        },\n\n        /* ******************************** *\n         *  This renderer does not need to\n         *  override draw/update* methods\n         *  since it provides draw/update*Prim\n         *  methods except for some cases like\n         *  internal texts or images.\n         * ******************************** */\n\n        /* **************************\n         *    Lines\n         * **************************/\n\n        // documented in AbstractRenderer\n        updateTicks: function (ticks) {\n            var i,\n                j,\n                c,\n                node,\n                x,\n                y,\n                tickStr = \"\",\n                len = ticks.ticks.length,\n                len2,\n                str,\n                isReal = true;\n\n            for (i = 0; i < len; i++) {\n                c = ticks.ticks[i];\n                x = c[0];\n                y = c[1];\n\n                len2 = x.length;\n                str = \" M \" + x[0] + \" \" + y[0];\n                if (!Type.isNumber(x[0])) {\n                    isReal = false;\n                }\n                for (j = 1; isReal && j < len2; ++j) {\n                    if (Type.isNumber(x[j])) {\n                        str += \" L \" + x[j] + \" \" + y[j];\n                    } else {\n                        isReal = false;\n                    }\n                }\n                if (isReal) {\n                    tickStr += str;\n                }\n            }\n\n            node = ticks.rendNode;\n\n            if (!Type.exists(node)) {\n                node = this.createPrim(\"path\", ticks.id);\n                this.appendChildPrim(node, Type.evaluate(ticks.visProp.layer));\n                ticks.rendNode = node;\n            }\n\n            node.setAttributeNS(null, \"stroke\", Type.evaluate(ticks.visProp.strokecolor));\n            node.setAttributeNS(null, \"fill\", \"none\");\n            // node.setAttributeNS(null, 'fill', Type.evaluate(ticks.visProp.fillcolor));\n            // node.setAttributeNS(null, 'fill-opacity', Type.evaluate(ticks.visProp.fillopacity));\n            node.setAttributeNS(\n                null,\n                \"stroke-opacity\",\n                Type.evaluate(ticks.visProp.strokeopacity)\n            );\n            node.setAttributeNS(null, \"stroke-width\", Type.evaluate(ticks.visProp.strokewidth));\n            this.updatePathPrim(node, tickStr, ticks.board);\n            this.setObjectViewport(ticks);\n        },\n\n        /* **************************\n         *    Text related stuff\n         * **************************/\n\n        // Already documented in JXG.AbstractRenderer\n        displayCopyright: function (str, fontsize) {\n            var node = this.createPrim(\"text\", 'licenseText'),\n                t;\n            node.setAttributeNS(null, 'x', '20px');\n            node.setAttributeNS(null, 'y', 2 + fontsize + 'px');\n            node.setAttributeNS(null, 'style', 'font-family:Arial,Helvetica,sans-serif; font-size:' +\n                fontsize + 'px; fill:#356AA0;  opacity:0.3;');\n            t = this.container.ownerDocument.createTextNode(str);\n            node.appendChild(t);\n            this.appendChildPrim(node, 0);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        drawInternalText: function (el) {\n            var node = this.createPrim(\"text\", el.id);\n\n            //node.setAttributeNS(null, \"style\", \"alignment-baseline:middle\"); // Not yet supported by Firefox\n            // Preserve spaces\n            //node.setAttributeNS(\"http://www.w3.org/XML/1998/namespace\", \"space\", \"preserve\");\n            node.style.whiteSpace = \"nowrap\";\n\n            el.rendNodeText = this.container.ownerDocument.createTextNode(\"\");\n            node.appendChild(el.rendNodeText);\n            this.appendChildPrim(node, Type.evaluate(el.visProp.layer));\n\n            return node;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateInternalText: function (el) {\n            var content = el.plaintext,\n                v,\n                ev_ax = el.getAnchorX(),\n                ev_ay = el.getAnchorY();\n\n            if (el.rendNode.getAttributeNS(null, \"class\") !== el.visProp.cssclass) {\n                el.rendNode.setAttributeNS(null, \"class\", Type.evaluate(el.visProp.cssclass));\n                el.needsSizeUpdate = true;\n            }\n\n            if (!isNaN(el.coords.scrCoords[1] + el.coords.scrCoords[2])) {\n                // Horizontal\n                v = el.coords.scrCoords[1];\n                if (el.visPropOld.left !== ev_ax + v) {\n                    el.rendNode.setAttributeNS(null, \"x\", v + \"px\");\n\n                    if (ev_ax === \"left\") {\n                        el.rendNode.setAttributeNS(null, \"text-anchor\", \"start\");\n                    } else if (ev_ax === \"right\") {\n                        el.rendNode.setAttributeNS(null, \"text-anchor\", \"end\");\n                    } else if (ev_ax === \"middle\") {\n                        el.rendNode.setAttributeNS(null, \"text-anchor\", \"middle\");\n                    }\n                    el.visPropOld.left = ev_ax + v;\n                }\n\n                // Vertical\n                v = el.coords.scrCoords[2];\n                if (el.visPropOld.top !== ev_ay + v) {\n                    el.rendNode.setAttributeNS(null, \"y\", v + this.vOffsetText * 0.5 + \"px\");\n\n                    if (ev_ay === \"bottom\") {\n                        el.rendNode.setAttributeNS(\n                            null,\n                            \"dominant-baseline\",\n                            \"text-after-edge\"\n                        );\n                    } else if (ev_ay === \"top\") {\n                        el.rendNode.setAttributeNS(null, \"dy\", \"1.6ex\");\n                        //el.rendNode.setAttributeNS(null, 'dominant-baseline', 'text-before-edge'); // Not supported by IE, edge\n                    } else if (ev_ay === \"middle\") {\n                        //el.rendNode.setAttributeNS(null, 'dominant-baseline', 'middle');\n                        el.rendNode.setAttributeNS(null, \"dy\", \"0.6ex\");\n                    }\n                    el.visPropOld.top = ev_ay + v;\n                }\n            }\n            if (el.htmlStr !== content) {\n                el.rendNodeText.data = content;\n                el.htmlStr = content;\n            }\n            this.transformImage(el, el.transformations);\n        },\n\n        /**\n         * Set color and opacity of internal texts.\n         * @private\n         * @see JXG.AbstractRenderer#updateTextStyle\n         * @see JXG.AbstractRenderer#updateInternalTextStyle\n         */\n        updateInternalTextStyle: function (el, strokeColor, strokeOpacity, duration) {\n            this.setObjectViewport(el);\n            this.setObjectFillColor(el, strokeColor, strokeOpacity);\n        },\n\n        /* **************************\n         *    Image related stuff\n         * **************************/\n\n        // Already documented in JXG.AbstractRenderer\n        drawImage: function (el) {\n            var node = this.createPrim(\"image\", el.id);\n\n            node.setAttributeNS(null, \"preserveAspectRatio\", \"none\");\n            this.appendChildPrim(node, Type.evaluate(el.visProp.layer));\n            el.rendNode = node;\n\n            this.updateImage(el);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        transformImage: function (el, t) {\n            var s, m,\n                node = el.rendNode,\n                str = \"\",\n                cx, cy,\n                len = t.length;\n\n            if (len > 0) {\n                m = this.joinTransforms(el, t);\n                s = [m[1][1], m[2][1], m[1][2], m[2][2], m[1][0], m[2][0]].join(\",\");\n                if (s.indexOf('NaN') === -1) {\n                    str += \" matrix(\" + s + \") \";\n                    if (el.elementClass === Const.OBJECT_CLASS_TEXT && el.visProp.display === 'html') {\n                        node.style.transform = str;\n                        cx = -el.coords.scrCoords[1];\n                        cy = -el.coords.scrCoords[2];\n                        switch (Type.evaluate(el.visProp.anchorx)) {\n                            case 'right': cx += el.size[0]; break;\n                            case 'middle': cx += el.size[0] * 0.5; break;\n                        }\n                        switch (Type.evaluate(el.visProp.anchory)) {\n                            case 'bottom': cy += el.size[1]; break;\n                            case 'middle': cy += el.size[1] * 0.5; break;\n                        }\n                        node.style['transform-origin'] = (cx) + 'px ' + (cy) + 'px';\n                    } else {\n                        // Images and texts with display:'internal'\n                        node.setAttributeNS(null, \"transform\", str);\n                    }\n                }\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateImageURL: function (el) {\n            var url = Type.evaluate(el.url);\n\n            if (el._src !== url) {\n                el.imgIsLoaded = false;\n                el.rendNode.setAttributeNS(this.xlinkNamespace, \"xlink:href\", url);\n                el._src = url;\n\n                return true;\n            }\n\n            return false;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateImageStyle: function (el, doHighlight) {\n            var css = Type.evaluate(\n                doHighlight ? el.visProp.highlightcssclass : el.visProp.cssclass\n            );\n\n            el.rendNode.setAttributeNS(null, \"class\", css);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        drawForeignObject: function (el) {\n            el.rendNode = this.appendChildPrim(\n                this.createPrim(\"foreignObject\", el.id),\n                Type.evaluate(el.visProp.layer)\n            );\n\n            this.appendNodesToElement(el, \"foreignObject\");\n            this.updateForeignObject(el);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateForeignObject: function (el) {\n            if (el._useUserSize) {\n                el.rendNode.style.overflow = \"hidden\";\n            } else {\n                el.rendNode.style.overflow = \"visible\";\n            }\n\n            this.updateRectPrim(\n                el.rendNode,\n                el.coords.scrCoords[1],\n                el.coords.scrCoords[2] - el.size[1],\n                el.size[0],\n                el.size[1]\n            );\n\n            el.rendNode.innerHTML = el.content;\n            this._updateVisual(el, { stroke: true, dash: true }, true);\n        },\n\n        /* **************************\n         * Render primitive objects\n         * **************************/\n\n        // Already documented in JXG.AbstractRenderer\n        appendChildPrim: function (node, level) {\n            if (!Type.exists(level)) {\n                // trace nodes have level not set\n                level = 0;\n            } else if (level >= Options.layer.numlayers) {\n                level = Options.layer.numlayers - 1;\n            }\n\n            this.layer[level].appendChild(node);\n\n            return node;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        createPrim: function (type, id) {\n            var node = this.container.ownerDocument.createElementNS(this.svgNamespace, type);\n            node.setAttributeNS(null, \"id\", this.uniqName(id));\n            node.style.position = \"absolute\";\n            if (type === \"path\") {\n                node.setAttributeNS(null, \"stroke-linecap\", \"round\");\n                node.setAttributeNS(null, \"stroke-linejoin\", \"round\");\n                node.setAttributeNS(null, \"fill-rule\", \"evenodd\");\n            }\n            return node;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        remove: function (shape) {\n            if (Type.exists(shape) && Type.exists(shape.parentNode)) {\n                shape.parentNode.removeChild(shape);\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        setLayer: function (el, level) {\n            if (!Type.exists(level)) {\n                level = 0;\n            } else if (level >= Options.layer.numlayers) {\n                level = Options.layer.numlayers - 1;\n            }\n\n            this.layer[level].appendChild(el.rendNode);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        makeArrows: function (el, a) {\n            var node2, str,\n                ev_fa = a.evFirst,\n                ev_la = a.evLast;\n\n            if (this.isIE && el.visPropCalc.visible && (ev_fa || ev_la)) {\n                el.rendNode.parentNode.insertBefore(el.rendNode, el.rendNode);\n                return;\n            }\n\n            // We can not compare against visPropOld if there is need for a new arrow head,\n            // since here visPropOld and ev_fa / ev_la already have the same value.\n            // This has been set in _updateVisual.\n            //\n            node2 = el.rendNodeTriangleStart;\n            if (ev_fa) {\n                str = this.toStr(this.container.id, '_', el.id, 'TriangleStart', a.typeFirst);\n                if (!Type.exists(node2) || node2.id !== str) {\n                    node2 = this.container.ownerDocument.getElementById(str);\n                    // Check if the marker already exists.\n                    // If not, create a new marker\n                    if (node2 === null) {\n                        node2 = this._createArrowHead(el, \"Start\", a.typeFirst);\n                        this.defs.appendChild(node2);\n                    }\n                    el.rendNodeTriangleStart = node2;\n                    el.rendNode.setAttributeNS(null, \"marker-start\", this.toURL(str));\n                }\n            } else if (Type.exists(node2)) {\n                this.remove(node2);\n            }\n\n            node2 = el.rendNodeTriangleEnd;\n            if (ev_la) {\n                str = this.toStr(this.container.id, '_', el.id, 'TriangleEnd', a.typeLast);\n                if (!Type.exists(node2) || node2.id !== str) {\n                    node2 = this.container.ownerDocument.getElementById(str);\n                    // Check if the marker already exists.\n                    // If not, create a new marker\n                    if (node2 === null) {\n                        node2 = this._createArrowHead(el, \"End\", a.typeLast);\n                        this.defs.appendChild(node2);\n                    }\n                    el.rendNodeTriangleEnd = node2;\n                    el.rendNode.setAttributeNS(null, \"marker-end\", this.toURL(str));\n                }\n            } else if (Type.exists(node2)) {\n                this.remove(node2);\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateEllipsePrim: function (node, x, y, rx, ry) {\n            var huge = 1000000;\n\n            huge = 200000; // IE\n            // webkit does not like huge values if the object is dashed\n            // iE doesn't like huge values above 216000\n            x = Math.abs(x) < huge ? x : (huge * x) / Math.abs(x);\n            y = Math.abs(y) < huge ? y : (huge * y) / Math.abs(y);\n            rx = Math.abs(rx) < huge ? rx : (huge * rx) / Math.abs(rx);\n            ry = Math.abs(ry) < huge ? ry : (huge * ry) / Math.abs(ry);\n\n            node.setAttributeNS(null, \"cx\", x);\n            node.setAttributeNS(null, \"cy\", y);\n            node.setAttributeNS(null, \"rx\", Math.abs(rx));\n            node.setAttributeNS(null, \"ry\", Math.abs(ry));\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateLinePrim: function (node, p1x, p1y, p2x, p2y) {\n            var huge = 1000000;\n\n            huge = 200000; //IE\n            if (!isNaN(p1x + p1y + p2x + p2y)) {\n                // webkit does not like huge values if the object is dashed\n                // IE doesn't like huge values above 216000\n                p1x = Math.abs(p1x) < huge ? p1x : (huge * p1x) / Math.abs(p1x);\n                p1y = Math.abs(p1y) < huge ? p1y : (huge * p1y) / Math.abs(p1y);\n                p2x = Math.abs(p2x) < huge ? p2x : (huge * p2x) / Math.abs(p2x);\n                p2y = Math.abs(p2y) < huge ? p2y : (huge * p2y) / Math.abs(p2y);\n\n                node.setAttributeNS(null, \"x1\", p1x);\n                node.setAttributeNS(null, \"y1\", p1y);\n                node.setAttributeNS(null, \"x2\", p2x);\n                node.setAttributeNS(null, \"y2\", p2y);\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updatePathPrim: function (node, pointString) {\n            if (pointString === \"\") {\n                pointString = \"M 0 0\";\n            }\n            node.setAttributeNS(null, \"d\", pointString);\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updatePathStringPoint: function (el, size, type) {\n            var s = \"\",\n                scr = el.coords.scrCoords,\n                sqrt32 = size * Math.sqrt(3) * 0.5,\n                s05 = size * 0.5;\n\n            if (type === \"x\") {\n                s =\n                    \" M \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" L \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    (scr[2] + size) +\n                    \" M \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" L \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    (scr[2] + size);\n            } else if (type === \"+\") {\n                s =\n                    \" M \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    scr[2] +\n                    \" M \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" L \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] + size);\n            } else if (type === \"|\") {\n                s =\n                    \" M \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" L \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] + size);\n            } else if (type === \"-\") {\n                s =\n                    \" M \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    scr[2];\n            } else if (type === \"<>\" || type === \"<<>>\") {\n                if (type === \"<<>>\") {\n                    size *= 1.41;\n                }\n                s =\n                    \" M \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] + size) +\n                    \" L \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" Z \";\n                } else if (type === \"^\") {\n                    s =\n                    \" M \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] - size) +\n                    \" L \" +\n                    (scr[1] - sqrt32) +\n                    \" \" +\n                    (scr[2] + s05) +\n                    \" L \" +\n                    (scr[1] + sqrt32) +\n                    \" \" +\n                    (scr[2] + s05) +\n                    \" Z \"; // close path\n            } else if (type === \"v\") {\n                s =\n                    \" M \" +\n                    scr[1] +\n                    \" \" +\n                    (scr[2] + size) +\n                    \" L \" +\n                    (scr[1] - sqrt32) +\n                    \" \" +\n                    (scr[2] - s05) +\n                    \" L \" +\n                    (scr[1] + sqrt32) +\n                    \" \" +\n                    (scr[2] - s05) +\n                    \" Z \";\n            } else if (type === \">\") {\n                s =\n                    \" M \" +\n                    (scr[1] + size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    (scr[1] - s05) +\n                    \" \" +\n                    (scr[2] - sqrt32) +\n                    \" L \" +\n                    (scr[1] - s05) +\n                    \" \" +\n                    (scr[2] + sqrt32) +\n                    \" Z \";\n            } else if (type === \"<\") {\n                s =\n                    \" M \" +\n                    (scr[1] - size) +\n                    \" \" +\n                    scr[2] +\n                    \" L \" +\n                    (scr[1] + s05) +\n                    \" \" +\n                    (scr[2] - sqrt32) +\n                    \" L \" +\n                    (scr[1] + s05) +\n                    \" \" +\n                    (scr[2] + sqrt32) +\n                    \" Z \";\n            }\n            return s;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updatePathStringPrim: function (el) {\n            var i,\n                scr,\n                len,\n                symbm = \" M \",\n                symbl = \" L \",\n                symbc = \" C \",\n                nextSymb = symbm,\n                maxSize = 5000.0,\n                pStr = \"\";\n\n            if (el.numberPoints <= 0) {\n                return \"\";\n            }\n\n            len = Math.min(el.points.length, el.numberPoints);\n\n            if (el.bezierDegree === 1) {\n                for (i = 0; i < len; i++) {\n                    scr = el.points[i].scrCoords;\n                    if (isNaN(scr[1]) || isNaN(scr[2])) {\n                        // PenUp\n                        nextSymb = symbm;\n                    } else {\n                        // Chrome has problems with values being too far away.\n                        scr[1] = Math.max(Math.min(scr[1], maxSize), -maxSize);\n                        scr[2] = Math.max(Math.min(scr[2], maxSize), -maxSize);\n\n                        // Attention: first coordinate may be inaccurate if far way\n                        //pStr += [nextSymb, scr[1], ' ', scr[2]].join('');\n                        pStr += nextSymb + scr[1] + \" \" + scr[2]; // Seems to be faster now (webkit and firefox)\n                        nextSymb = symbl;\n                    }\n                }\n            } else if (el.bezierDegree === 3) {\n                i = 0;\n                while (i < len) {\n                    scr = el.points[i].scrCoords;\n                    if (isNaN(scr[1]) || isNaN(scr[2])) {\n                        // PenUp\n                        nextSymb = symbm;\n                    } else {\n                        pStr += nextSymb + scr[1] + \" \" + scr[2];\n                        if (nextSymb === symbc) {\n                            i += 1;\n                            scr = el.points[i].scrCoords;\n                            pStr += \" \" + scr[1] + \" \" + scr[2];\n                            i += 1;\n                            scr = el.points[i].scrCoords;\n                            pStr += \" \" + scr[1] + \" \" + scr[2];\n                        }\n                        nextSymb = symbc;\n                    }\n                    i += 1;\n                }\n            }\n            return pStr;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updatePathStringBezierPrim: function (el) {\n            var i,\n                j,\n                k,\n                scr,\n                lx,\n                ly,\n                len,\n                symbm = \" M \",\n                symbl = \" C \",\n                nextSymb = symbm,\n                maxSize = 5000.0,\n                pStr = \"\",\n                f = Type.evaluate(el.visProp.strokewidth),\n                isNoPlot = Type.evaluate(el.visProp.curvetype) !== \"plot\";\n\n            if (el.numberPoints <= 0) {\n                return \"\";\n            }\n\n            if (isNoPlot && el.board.options.curve.RDPsmoothing) {\n                el.points = Numerics.RamerDouglasPeucker(el.points, 0.5);\n            }\n\n            len = Math.min(el.points.length, el.numberPoints);\n            for (j = 1; j < 3; j++) {\n                nextSymb = symbm;\n                for (i = 0; i < len; i++) {\n                    scr = el.points[i].scrCoords;\n\n                    if (isNaN(scr[1]) || isNaN(scr[2])) {\n                        // PenUp\n                        nextSymb = symbm;\n                    } else {\n                        // Chrome has problems with values being too far away.\n                        scr[1] = Math.max(Math.min(scr[1], maxSize), -maxSize);\n                        scr[2] = Math.max(Math.min(scr[2], maxSize), -maxSize);\n\n                        // Attention: first coordinate may be inaccurate if far way\n                        if (nextSymb === symbm) {\n                            //pStr += [nextSymb, scr[1], ' ', scr[2]].join('');\n                            pStr += nextSymb + scr[1] + \" \" + scr[2]; // Seems to be faster now (webkit and firefox)\n                        } else {\n                            k = 2 * j;\n                            pStr += [\n                                nextSymb,\n                                lx + (scr[1] - lx) * 0.333 + f * (k * Math.random() - j),\n                                \" \",\n                                ly + (scr[2] - ly) * 0.333 + f * (k * Math.random() - j),\n                                \" \",\n                                lx + (scr[1] - lx) * 0.666 + f * (k * Math.random() - j),\n                                \" \",\n                                ly + (scr[2] - ly) * 0.666 + f * (k * Math.random() - j),\n                                \" \",\n                                scr[1],\n                                \" \",\n                                scr[2]\n                            ].join(\"\");\n                        }\n\n                        nextSymb = symbl;\n                        lx = scr[1];\n                        ly = scr[2];\n                    }\n                }\n            }\n            return pStr;\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updatePolygonPrim: function (node, el) {\n            var i,\n                pStr = \"\",\n                scrCoords,\n                len = el.vertices.length;\n\n            node.setAttributeNS(null, \"stroke\", \"none\");\n            node.setAttributeNS(null, \"fill-rule\", \"evenodd\");\n            if (el.elType === \"polygonalchain\") {\n                len++;\n            }\n\n            for (i = 0; i < len - 1; i++) {\n                if (el.vertices[i].isReal) {\n                    scrCoords = el.vertices[i].coords.scrCoords;\n                    pStr = pStr + scrCoords[1] + \",\" + scrCoords[2];\n                } else {\n                    node.setAttributeNS(null, \"points\", \"\");\n                    return;\n                }\n\n                if (i < len - 2) {\n                    pStr += \" \";\n                }\n            }\n            if (pStr.indexOf(\"NaN\") === -1) {\n                node.setAttributeNS(null, \"points\", pStr);\n            }\n        },\n\n        // Already documented in JXG.AbstractRenderer\n        updateRectPrim: function (node, x, y, w, h) {\n            node.setAttributeNS(null, \"x\", x);\n            node.setAttributeNS(null, \"y\", y);\n            node.setAttributeNS(null, \"width\", w);\n            node.setAttributeNS(null, \"height\", h);\n        },\n\n        /* **************************\n         *  Set Attributes\n         * **************************/\n\n        // documented in JXG.AbstractRenderer\n        setPropertyPrim: function (node, key, val) {\n            if (key === \"stroked\") {\n                return;\n            }\n            node.setAttributeNS(null, key, val);\n        },\n\n        display: function (el, val) {\n            var node;\n\n            if (el && el.rendNode) {\n                el.visPropOld.visible = val;\n                node = el.rendNode;\n                if (val) {\n                    node.setAttributeNS(null, \"display\", \"inline\");\n                    node.style.visibility = \"inherit\";\n                } else {\n                    node.setAttributeNS(null, \"display\", \"none\");\n                    node.style.visibility = \"hidden\";\n                }\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        show: function (el) {\n            JXG.deprecated(\"Board.renderer.show()\", \"Board.renderer.display()\");\n            this.display(el, true);\n            // var node;\n            //\n            // if (el && el.rendNode) {\n            //     node = el.rendNode;\n            //     node.setAttributeNS(null, 'display', 'inline');\n            //     node.style.visibility = \"inherit\";\n            // }\n        },\n\n        // documented in JXG.AbstractRenderer\n        hide: function (el) {\n            JXG.deprecated(\"Board.renderer.hide()\", \"Board.renderer.display()\");\n            this.display(el, false);\n            // var node;\n            //\n            // if (el && el.rendNode) {\n            //     node = el.rendNode;\n            //     node.setAttributeNS(null, 'display', 'none');\n            //     node.style.visibility = \"hidden\";\n            // }\n        },\n\n        // documented in JXG.AbstractRenderer\n        setBuffering: function (el, type) {\n            el.rendNode.setAttribute(\"buffered-rendering\", type);\n        },\n\n        // documented in JXG.AbstractRenderer\n        setDashStyle: function (el) {\n            var dashStyle = Type.evaluate(el.visProp.dash),\n                ds = Type.evaluate(el.visProp.dashscale),\n                sw = ds ? 0.5 * Type.evaluate(el.visProp.strokewidth) : 1,\n                node = el.rendNode;\n\n            if (dashStyle > 0) {\n                node.setAttributeNS(null, \"stroke-dasharray\",\n                    // sw could distinguish highlighting or not.\n                    // But it seems to preferable to ignore this.\n                    this.dashArray[dashStyle - 1].map(function (x) { return x * sw; }).join(',')\n                );\n            } else {\n                if (node.hasAttributeNS(null, \"stroke-dasharray\")) {\n                    node.removeAttributeNS(null, \"stroke-dasharray\");\n                }\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        setGradient: function (el) {\n            var fillNode = el.rendNode,\n                node, node2, node3,\n                ev_g = Type.evaluate(el.visProp.gradient);\n\n            if (ev_g === \"linear\" || ev_g === \"radial\") {\n                node = this.createPrim(ev_g + \"Gradient\", el.id + \"_gradient\");\n                node2 = this.createPrim(\"stop\", el.id + \"_gradient1\");\n                node3 = this.createPrim(\"stop\", el.id + \"_gradient2\");\n                node.appendChild(node2);\n                node.appendChild(node3);\n                this.defs.appendChild(node);\n                fillNode.setAttributeNS(\n                    null,\n                    'style',\n                    // \"fill:url(#\" + this.container.id + \"_\" + el.id + \"_gradient)\"\n                    'fill:' + this.toURL(this.container.id + '_' + el.id + '_gradient')\n                );\n                el.gradNode1 = node2;\n                el.gradNode2 = node3;\n                el.gradNode = node;\n            } else {\n                fillNode.removeAttributeNS(null, \"style\");\n            }\n        },\n\n        /**\n         * Set the gradient angle for linear color gradients.\n         *\n         * @private\n         * @param {SVGnode} node SVG gradient node of an arbitrary JSXGraph element.\n         * @param {Number} radians angle value in radians. 0 is horizontal from left to right, Pi/4 is vertical from top to bottom.\n         */\n        updateGradientAngle: function (node, radians) {\n            // Angles:\n            // 0: ->\n            // 90: down\n            // 180: <-\n            // 90: up\n            var f = 1.0,\n                co = Math.cos(radians),\n                si = Math.sin(radians);\n\n            if (Math.abs(co) > Math.abs(si)) {\n                f /= Math.abs(co);\n            } else {\n                f /= Math.abs(si);\n            }\n\n            if (co >= 0) {\n                node.setAttributeNS(null, \"x1\", 0);\n                node.setAttributeNS(null, \"x2\", co * f);\n            } else {\n                node.setAttributeNS(null, \"x1\", -co * f);\n                node.setAttributeNS(null, \"x2\", 0);\n            }\n            if (si >= 0) {\n                node.setAttributeNS(null, \"y1\", 0);\n                node.setAttributeNS(null, \"y2\", si * f);\n            } else {\n                node.setAttributeNS(null, \"y1\", -si * f);\n                node.setAttributeNS(null, \"y2\", 0);\n            }\n        },\n\n        /**\n         * Set circles for radial color gradients.\n         *\n         * @private\n         * @param {SVGnode} node SVG gradient node\n         * @param {Number} cx SVG value cx (value between 0 and 1)\n         * @param {Number} cy  SVG value cy (value between 0 and 1)\n         * @param {Number} r  SVG value r (value between 0 and 1)\n         * @param {Number} fx  SVG value fx (value between 0 and 1)\n         * @param {Number} fy  SVG value fy (value between 0 and 1)\n         * @param {Number} fr  SVG value fr (value between 0 and 1)\n         */\n        updateGradientCircle: function (node, cx, cy, r, fx, fy, fr) {\n            node.setAttributeNS(null, \"cx\", cx * 100 + \"%\"); // Center first color\n            node.setAttributeNS(null, \"cy\", cy * 100 + \"%\");\n            node.setAttributeNS(null, \"r\", r * 100 + \"%\");\n            node.setAttributeNS(null, \"fx\", fx * 100 + \"%\"); // Center second color / focal point\n            node.setAttributeNS(null, \"fy\", fy * 100 + \"%\");\n            node.setAttributeNS(null, \"fr\", fr * 100 + \"%\");\n        },\n\n        // documented in JXG.AbstractRenderer\n        updateGradient: function (el) {\n            var col,\n                op,\n                node2 = el.gradNode1,\n                node3 = el.gradNode2,\n                ev_g = Type.evaluate(el.visProp.gradient);\n\n            if (!Type.exists(node2) || !Type.exists(node3)) {\n                return;\n            }\n\n            op = Type.evaluate(el.visProp.fillopacity);\n            op = op > 0 ? op : 0;\n            col = Type.evaluate(el.visProp.fillcolor);\n\n            node2.setAttributeNS(null, \"style\", \"stop-color:\" + col + \";stop-opacity:\" + op);\n            node3.setAttributeNS(\n                null,\n                \"style\",\n                \"stop-color:\" +\n                Type.evaluate(el.visProp.gradientsecondcolor) +\n                \";stop-opacity:\" +\n                Type.evaluate(el.visProp.gradientsecondopacity)\n            );\n            node2.setAttributeNS(\n                null,\n                \"offset\",\n                Type.evaluate(el.visProp.gradientstartoffset) * 100 + \"%\"\n            );\n            node3.setAttributeNS(\n                null,\n                \"offset\",\n                Type.evaluate(el.visProp.gradientendoffset) * 100 + \"%\"\n            );\n            if (ev_g === \"linear\") {\n                this.updateGradientAngle(el.gradNode, Type.evaluate(el.visProp.gradientangle));\n            } else if (ev_g === \"radial\") {\n                this.updateGradientCircle(\n                    el.gradNode,\n                    Type.evaluate(el.visProp.gradientcx),\n                    Type.evaluate(el.visProp.gradientcy),\n                    Type.evaluate(el.visProp.gradientr),\n                    Type.evaluate(el.visProp.gradientfx),\n                    Type.evaluate(el.visProp.gradientfy),\n                    Type.evaluate(el.visProp.gradientfr)\n                );\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        setObjectTransition: function (el, duration) {\n            var node, props,\n                transitionArr = [],\n                transitionStr,\n                i,\n                len = 0,\n                nodes = [\"rendNode\", \"rendNodeTriangleStart\", \"rendNodeTriangleEnd\"];\n\n            if (duration === undefined) {\n                duration = Type.evaluate(el.visProp.transitionduration);\n            }\n\n            props = Type.evaluate(el.visProp.transitionproperties);\n            if (duration === el.visPropOld.transitionduration &&\n                props === el.visPropOld.transitionproperties) {\n                return;\n            }\n\n            // if (\n            //     el.elementClass === Const.OBJECT_CLASS_TEXT &&\n            //     Type.evaluate(el.visProp.display) === \"html\"\n            // ) {\n            //     // transitionStr = \" color \" + duration + \"ms,\" +\n            //     //     \" opacity \" + duration + \"ms\";\n            //     transitionStr = \" all \" + duration + \"ms ease\";\n            // } else {\n            //     transitionStr =\n            //         \" fill \" + duration + \"ms,\" +\n            //         \" fill-opacity \" + duration + \"ms,\" +\n            //         \" stroke \" + duration + \"ms,\" +\n            //         \" stroke-opacity \" + duration + \"ms,\" +\n            //         \" stroke-width \" + duration + \"ms,\" +\n            //         \" width \" + duration + \"ms,\" +\n            //         \" height \" + duration + \"ms,\" +\n            //         \" rx \" + duration + \"ms,\" +\n            //         \" ry \" + duration + \"ms\";\n            // }\n\n            if (Type.exists(props)) {\n                len = props.length;\n            }\n            for (i = 0; i < len; i++) {\n                transitionArr.push(props[i] + ' ' + duration + 'ms');\n            }\n            transitionStr = transitionArr.join(', ');\n\n            len = nodes.length;\n            for (i = 0; i < len; ++i) {\n                if (el[nodes[i]]) {\n                    node = el[nodes[i]];\n                    node.style.transition = transitionStr;\n                }\n            }\n\n            el.visPropOld.transitionduration = duration;\n            el.visPropOld.transitionproperties = props;\n        },\n\n        // documented in JXG.AbstractRenderer\n        setObjectViewport: function(el, isHtml) {\n            var val = Type.evaluate(el.visProp.viewport),\n                vp, i,\n                len = 0,\n                bb, bbc, l, t, r, b,\n                nodes = ['rendNode']; //, \"rendNodeTriangleStart\", \"rendNodeTriangleEnd\"];\n\n            // Check viewport attribute of the board\n            if (val === 'inherit') {\n                val = Type.evaluate(el.board.attr.viewport);\n            }\n\n            // Required order: top, right, bottom, left\n            if (isHtml) {\n                bb = el.rendNode.getBoundingClientRect();\n                bbc = this.container.getBoundingClientRect();\n                t = parseFloat(val[1]);\n                r = parseFloat(val[2]);\n                b = parseFloat(val[3]);\n                l = parseFloat(val[0]);\n\n                if (Type.isString(val[1]) && val[1].indexOf('%') > 0) {\n                    t = (bbc.height) * t / 100;\n                }\n                if (Type.isString(val[2]) && val[2].indexOf('%') > 0) {\n                    r = (bbc.width) * r / 100;\n                }\n                if (Type.isString(val[3]) && val[3].indexOf('%') > 0) {\n                    b = (bbc.height) * b / 100;\n                }\n                if (Type.isString(val[0]) && val[0].indexOf('%') > 0) {\n                    l = (bbc.width) * l / 100;\n                }\n\n                t = parseFloat(bbc.top) - parseFloat(bb.top) + t;\n                r = parseFloat(bb.right) - parseFloat(bbc.right) + r;\n                b = parseFloat(bb.bottom) - parseFloat(bbc.bottom) + b;\n                l = parseFloat(bbc.left) - parseFloat(bb.left) + l;\n                val = [l, t, r, b];\n            }\n\n            vp = [\n                (typeof val[1] === 'number') ? val[1] + 'px' : val[1],\n                (typeof val[2] === 'number') ? val[2] + 'px' : val[2],\n                (typeof val[3] === 'number') ? val[3] + 'px' : val[3],\n                (typeof val[0] === 'number') ? val[0] + 'px' : val[0]\n            ].join(' ');\n\n            len = nodes.length;\n            for (i = 0; i < len; ++i) {\n                if (el[nodes[i]]) {\n                    if (isHtml) {\n                        el[nodes[i]].style.clipPath = 'inset(' + vp + ')';\n                    } else {\n                        el[nodes[i]].setAttributeNS(null, \"clip-path\", 'view-box inset(' + vp + ')');\n                    }\n                }\n            }\n        },\n\n        /**\n         * Call user-defined function to set visual attributes.\n         * If \"testAttribute\" is the empty string, the function\n         * is called immediately, otherwise it is called in a timeOut.\n         *\n         * This is necessary to realize smooth transitions but avoid transitions\n         * when first creating the objects.\n         *\n         * Usually, the string in testAttribute is the visPropOld attribute\n         * of the values which are set.\n         *\n         * @param {Function} setFunc       Some function which usually sets some attributes\n         * @param {String} testAttribute If this string is the empty string  the function is called immediately,\n         *                               otherwise it is called in a setImeout.\n         * @see JXG.SVGRenderer#setObjectFillColor\n         * @see JXG.SVGRenderer#setObjectStrokeColor\n         * @see JXG.SVGRenderer#_setArrowColor\n         * @private\n         */\n        _setAttribute: function (setFunc, testAttribute) {\n            if (testAttribute === \"\") {\n                setFunc();\n            } else {\n                window.setTimeout(setFunc, 1);\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        setObjectFillColor: function (el, color, opacity, rendNode) {\n            var node, c, rgbo, oo,\n                rgba = Type.evaluate(color),\n                o = Type.evaluate(opacity),\n                grad = Type.evaluate(el.visProp.gradient);\n\n            o = o > 0 ? o : 0;\n\n            // TODO  save gradient and gradientangle\n            if (\n                el.visPropOld.fillcolor === rgba &&\n                el.visPropOld.fillopacity === o &&\n                grad === null\n            ) {\n                return;\n            }\n\n            if (Type.exists(rgba) && rgba !== false) {\n                if (rgba.length !== 9) {\n                    // RGB, not RGBA\n                    c = rgba;\n                    oo = o;\n                } else {\n                    // True RGBA, not RGB\n                    rgbo = Color.rgba2rgbo(rgba);\n                    c = rgbo[0];\n                    oo = o * rgbo[1];\n                }\n\n                if (rendNode === undefined) {\n                    node = el.rendNode;\n                } else {\n                    node = rendNode;\n                }\n\n                if (c !== \"none\") {\n                    this._setAttribute(function () {\n                        node.setAttributeNS(null, \"fill\", c);\n                    }, el.visPropOld.fillcolor);\n                }\n\n                if (el.type === JXG.OBJECT_TYPE_IMAGE) {\n                    this._setAttribute(function () {\n                        node.setAttributeNS(null, \"opacity\", oo);\n                    }, el.visPropOld.fillopacity);\n                    //node.style['opacity'] = oo;  // This would overwrite values set by CSS class.\n                } else {\n                    if (c === \"none\") {\n                        // This is done only for non-images\n                        // because images have no fill color.\n                        oo = 0;\n                        // This is necessary if there is a foreignObject below.\n                        node.setAttributeNS(null, \"pointer-events\", \"visibleStroke\");\n                    } else {\n                        // This is the default\n                        node.setAttributeNS(null, \"pointer-events\", \"visiblePainted\");\n                    }\n                    this._setAttribute(function () {\n                        node.setAttributeNS(null, \"fill-opacity\", oo);\n                    }, el.visPropOld.fillopacity);\n                }\n\n                if (grad === \"linear\" || grad === \"radial\") {\n                    this.updateGradient(el);\n                }\n            }\n            el.visPropOld.fillcolor = rgba;\n            el.visPropOld.fillopacity = o;\n        },\n\n        // documented in JXG.AbstractRenderer\n        setObjectStrokeColor: function (el, color, opacity) {\n            var rgba = Type.evaluate(color),\n                c, rgbo,\n                o = Type.evaluate(opacity),\n                oo, node;\n\n            o = o > 0 ? o : 0;\n\n            if (el.visPropOld.strokecolor === rgba && el.visPropOld.strokeopacity === o) {\n                return;\n            }\n\n            if (Type.exists(rgba) && rgba !== false) {\n                if (rgba.length !== 9) {\n                    // RGB, not RGBA\n                    c = rgba;\n                    oo = o;\n                } else {\n                    // True RGBA, not RGB\n                    rgbo = Color.rgba2rgbo(rgba);\n                    c = rgbo[0];\n                    oo = o * rgbo[1];\n                }\n\n                node = el.rendNode;\n\n                if (el.elementClass === Const.OBJECT_CLASS_TEXT) {\n                    if (Type.evaluate(el.visProp.display) === \"html\") {\n                        this._setAttribute(function () {\n                            node.style.color = c;\n                            node.style.opacity = oo;\n                        }, el.visPropOld.strokecolor);\n                    } else {\n                        this._setAttribute(function () {\n                            node.setAttributeNS(null, \"style\", \"fill:\" + c);\n                            node.setAttributeNS(null, \"style\", \"fill-opacity:\" + oo);\n                        }, el.visPropOld.strokecolor);\n                    }\n                } else {\n                    this._setAttribute(function () {\n                        node.setAttributeNS(null, \"stroke\", c);\n                        node.setAttributeNS(null, \"stroke-opacity\", oo);\n                    }, el.visPropOld.strokecolor);\n                }\n\n                if (\n                    el.elementClass === Const.OBJECT_CLASS_CURVE ||\n                    el.elementClass === Const.OBJECT_CLASS_LINE\n                ) {\n                    if (Type.evaluate(el.visProp.firstarrow)) {\n                        this._setArrowColor(\n                            el.rendNodeTriangleStart,\n                            c, oo, el,\n                            el.visPropCalc.typeFirst\n                        );\n                    }\n\n                    if (Type.evaluate(el.visProp.lastarrow)) {\n                        this._setArrowColor(\n                            el.rendNodeTriangleEnd,\n                            c, oo, el,\n                            el.visPropCalc.typeLast\n                        );\n                    }\n                }\n            }\n\n            el.visPropOld.strokecolor = rgba;\n            el.visPropOld.strokeopacity = o;\n        },\n\n        // documented in JXG.AbstractRenderer\n        setObjectStrokeWidth: function (el, width) {\n            var node,\n                w = Type.evaluate(width);\n\n            if (isNaN(w) || el.visPropOld.strokewidth === w) {\n                return;\n            }\n\n            node = el.rendNode;\n            this.setPropertyPrim(node, \"stroked\", \"true\");\n            if (Type.exists(w)) {\n                this.setPropertyPrim(node, \"stroke-width\", w + \"px\");\n\n                // if (el.elementClass === Const.OBJECT_CLASS_CURVE ||\n                // el.elementClass === Const.OBJECT_CLASS_LINE) {\n                //     if (Type.evaluate(el.visProp.firstarrow)) {\n                //         this._setArrowWidth(el.rendNodeTriangleStart, w, el.rendNode);\n                //     }\n                //\n                //     if (Type.evaluate(el.visProp.lastarrow)) {\n                //         this._setArrowWidth(el.rendNodeTriangleEnd, w, el.rendNode);\n                //     }\n                // }\n            }\n            el.visPropOld.strokewidth = w;\n        },\n\n        // documented in JXG.AbstractRenderer\n        setLineCap: function (el) {\n            var capStyle = Type.evaluate(el.visProp.linecap);\n\n            if (\n                capStyle === undefined ||\n                capStyle === \"\" ||\n                el.visPropOld.linecap === capStyle ||\n                !Type.exists(el.rendNode)\n            ) {\n                return;\n            }\n\n            this.setPropertyPrim(el.rendNode, \"stroke-linecap\", capStyle);\n            el.visPropOld.linecap = capStyle;\n        },\n\n        // documented in JXG.AbstractRenderer\n        setShadow: function (el) {\n            var ev_s = Type.evaluate(el.visProp.shadow),\n                ev_s_json, c, b, bl, o, op, id, node,\n                use_board_filter = true,\n                show = false;\n\n            ev_s_json = JSON.stringify(ev_s);\n            if (ev_s_json === el.visPropOld.shadow) {\n                return;\n            }\n\n            if (typeof ev_s === 'boolean') {\n                use_board_filter = true;\n                show = ev_s;\n                c = 'none';\n                b = 3;\n                bl = 0.1;\n                o = [5, 5];\n                op = 1;\n            } else {\n                if (Type.evaluate(ev_s.enabled)) {\n                    use_board_filter = false;\n                    show = true;\n                    c = JXG.rgbParser(Type.evaluate(ev_s.color));\n                    b = Type.evaluate(ev_s.blur);\n                    bl = Type.evaluate(ev_s.blend);\n                    o = Type.evaluate(ev_s.offset);\n                    op = Type.evaluate(ev_s.opacity);\n                } else {\n                    show = false;\n                }\n            }\n\n            if (Type.exists(el.rendNode)) {\n                if (show) {\n                    if (use_board_filter) {\n                        el.rendNode.setAttributeNS(null, 'filter', this.toURL(this.container.id + '_' + 'f1'));\n                        // 'url(#' + this.container.id + '_' + 'f1)');\n                    } else {\n                        node = this.container.ownerDocument.getElementById(id);\n                        if (node) {\n                            this.defs.removeChild(node);\n                        }\n                        id = el.rendNode.id + '_' + 'f1';\n                        this.defs.appendChild(this.createShadowFilter(id, c, op, bl, b, o));\n                        el.rendNode.setAttributeNS(null, 'filter', this.toURL(id));\n                        // 'url(#' + id + ')');\n                    }\n                } else {\n                    el.rendNode.removeAttributeNS(null, 'filter');\n                }\n            }\n\n            el.visPropOld.shadow = ev_s_json;\n        },\n\n        /* **************************\n         * renderer control\n         * **************************/\n\n        // documented in JXG.AbstractRenderer\n        suspendRedraw: function () {\n            // It seems to be important for the Linux version of firefox\n            this.suspendHandle = this.svgRoot.suspendRedraw(10000);\n        },\n\n        // documented in JXG.AbstractRenderer\n        unsuspendRedraw: function () {\n            this.svgRoot.unsuspendRedraw(this.suspendHandle);\n            // this.svgRoot.unsuspendRedrawAll();\n            //this.svgRoot.forceRedraw();\n        },\n\n        // documented in AbstractRenderer\n        resize: function (w, h) {\n            this.svgRoot.setAttribute(\"width\", parseFloat(w));\n            this.svgRoot.setAttribute(\"height\", parseFloat(h));\n        },\n\n        // documented in JXG.AbstractRenderer\n        createTouchpoints: function (n) {\n            var i, na1, na2, node;\n            this.touchpoints = [];\n            for (i = 0; i < n; i++) {\n                na1 = \"touchpoint1_\" + i;\n                node = this.createPrim(\"path\", na1);\n                this.appendChildPrim(node, 19);\n                node.setAttributeNS(null, \"d\", \"M 0 0\");\n                this.touchpoints.push(node);\n\n                this.setPropertyPrim(node, \"stroked\", \"true\");\n                this.setPropertyPrim(node, \"stroke-width\", \"1px\");\n                node.setAttributeNS(null, \"stroke\", \"#000000\");\n                node.setAttributeNS(null, \"stroke-opacity\", 1.0);\n                node.setAttributeNS(null, \"display\", \"none\");\n\n                na2 = \"touchpoint2_\" + i;\n                node = this.createPrim(\"ellipse\", na2);\n                this.appendChildPrim(node, 19);\n                this.updateEllipsePrim(node, 0, 0, 0, 0);\n                this.touchpoints.push(node);\n\n                this.setPropertyPrim(node, \"stroked\", \"true\");\n                this.setPropertyPrim(node, \"stroke-width\", \"1px\");\n                node.setAttributeNS(null, \"stroke\", \"#000000\");\n                node.setAttributeNS(null, \"stroke-opacity\", 1.0);\n                node.setAttributeNS(null, \"fill\", \"#ffffff\");\n                node.setAttributeNS(null, \"fill-opacity\", 0.0);\n\n                node.setAttributeNS(null, \"display\", \"none\");\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        showTouchpoint: function (i) {\n            if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n                this.touchpoints[2 * i].setAttributeNS(null, \"display\", \"inline\");\n                this.touchpoints[2 * i + 1].setAttributeNS(null, \"display\", \"inline\");\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        hideTouchpoint: function (i) {\n            if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n                this.touchpoints[2 * i].setAttributeNS(null, \"display\", \"none\");\n                this.touchpoints[2 * i + 1].setAttributeNS(null, \"display\", \"none\");\n            }\n        },\n\n        // documented in JXG.AbstractRenderer\n        updateTouchpoint: function (i, pos) {\n            var x,\n                y,\n                d = 37;\n\n            if (this.touchpoints && i >= 0 && 2 * i < this.touchpoints.length) {\n                x = pos[0];\n                y = pos[1];\n\n                this.touchpoints[2 * i].setAttributeNS(\n                    null,\n                    \"d\",\n                    \"M \" +\n                    (x - d) +\n                    \" \" +\n                    y +\n                    \" \" +\n                    \"L \" +\n                    (x + d) +\n                    \" \" +\n                    y +\n                    \" \" +\n                    \"M \" +\n                    x +\n                    \" \" +\n                    (y - d) +\n                    \" \" +\n                    \"L \" +\n                    x +\n                    \" \" +\n                    (y + d)\n                );\n                this.updateEllipsePrim(this.touchpoints[2 * i + 1], pos[0], pos[1], 25, 25);\n            }\n        },\n\n        /**\n         * Walk recursively through the DOM subtree of a node and collect all\n         * value attributes together with the id of that node.\n         * <b>Attention:</b> Only values of nodes having a valid id are taken.\n         * @param  {Node} node   root node of DOM subtree that will be searched recursively.\n         * @return {Array}      Array with entries of the form [id, value]\n         * @private\n         */\n        _getValuesOfDOMElements: function (node) {\n            var values = [];\n            if (node.nodeType === 1) {\n                node = node.firstChild;\n                while (node) {\n                    if (node.id !== undefined && node.value !== undefined) {\n                        values.push([node.id, node.value]);\n                    }\n                    values = values.concat(this._getValuesOfDOMElements(node));\n                    node = node.nextSibling;\n                }\n            }\n            return values;\n        },\n\n        _getDataUri: function (url, callback) {\n            var image = new Image();\n\n            image.onload = function () {\n                var canvas = document.createElement(\"canvas\");\n                canvas.width = this.naturalWidth; // or 'width' if you want a special/scaled size\n                canvas.height = this.naturalHeight; // or 'height' if you want a special/scaled size\n\n                canvas.getContext(\"2d\").drawImage(this, 0, 0);\n\n                callback(canvas.toDataURL(\"image/png\"));\n                canvas.remove();\n            };\n\n            image.src = url;\n        },\n\n        _getImgDataURL: function (svgRoot) {\n            var images, len, canvas, ctx, ur, i;\n\n            images = svgRoot.getElementsByTagName(\"image\");\n            len = images.length;\n            if (len > 0) {\n                canvas = document.createElement(\"canvas\");\n                //img = new Image();\n                for (i = 0; i < len; i++) {\n                    images[i].setAttribute(\"crossorigin\", \"anonymous\");\n                    //img.src = images[i].href;\n                    //img.onload = function() {\n                    // img.crossOrigin = \"anonymous\";\n                    ctx = canvas.getContext(\"2d\");\n                    canvas.width = images[i].getAttribute(\"width\");\n                    canvas.height = images[i].getAttribute(\"height\");\n                    try {\n                        ctx.drawImage(images[i], 0, 0, canvas.width, canvas.height);\n\n                        // If the image is not png, the format must be specified here\n                        ur = canvas.toDataURL();\n                        images[i].setAttribute(\"xlink:href\", ur);\n                    } catch (err) {\n                        console.log(\"CORS problem! Image can not be used\", err);\n                    }\n                }\n                //canvas.remove();\n            }\n            return true;\n        },\n\n        /**\n         * Return a data URI of the SVG code representing the construction.\n         * The SVG code of the construction is base64 encoded. The return string starts\n         * with \"data:image/svg+xml;base64,...\".\n         *\n         * @param {Boolean} ignoreTexts If true, the foreignObject tag is set to display=none.\n         * This is necessary for older versions of Safari. Default: false\n         * @returns {String}  data URI string\n         *\n         * @example\n         * var A = board.create('point', [2, 2]);\n         *\n         * var txt = board.renderer.dumpToDataURI(false);\n         * // txt consists of a string of the form\n         * // data:image/svg+xml;base64,PHN2Zy. base64 encoded SVG..+PC9zdmc+\n         * // Behind the comma, there is the base64 encoded SVG code\n         * // which is decoded with atob().\n         * // The call of decodeURIComponent(escape(...)) is necessary\n         * // to handle unicode strings correctly.\n         * var ar = txt.split(',');\n         * document.getElementById('output').value = decodeURIComponent(escape(atob(ar[1])));\n         *\n         * </pre><div id=\"JXG1bad4bec-6d08-4ce0-9b7f-d817e8dd762d\" class=\"jxgbox\" style=\"width: 300px; height: 300px;\"></div>\n         * <textarea id=\"output2023\" rows=\"5\" cols=\"50\"></textarea>\n         * <script type=\"text/javascript\">\n         *     (function() {\n         *         var board = JXG.JSXGraph.initBoard('JXG1bad4bec-6d08-4ce0-9b7f-d817e8dd762d',\n         *             {boundingbox: [-8, 8, 8,-8], axis: true, showcopyright: false, shownavigation: false});\n         *     var A = board.create('point', [2, 2]);\n         *\n         *     var txt = board.renderer.dumpToDataURI(false);\n         *     // txt consists of a string of the form\n         *     // data:image/svg+xml;base64,PHN2Zy. base64 encoded SVG..+PC9zdmc+\n         *     // Behind the comma, there is the base64 encoded SVG code\n         *     // which is decoded with atob().\n         *     // The call of decodeURIComponent(escape(...)) is necessary\n         *     // to handle unicode strings correctly.\n         *     var ar = txt.split(',');\n         *     document.getElementById('output2023').value = decodeURIComponent(escape(atob(ar[1])));\n         *\n         *     })();\n         *\n         * </script><pre>\n         *\n         */\n        dumpToDataURI: function (ignoreTexts) {\n            var svgRoot = this.svgRoot,\n                btoa = window.btoa || Base64.encode,\n                svg, i, len,\n                values = [];\n\n            // Move all HTML tags (beside the SVG root) of the container\n            // to the foreignObject element inside of the svgRoot node\n            // Problem:\n            // input values are not copied. This can be verified by looking at an innerHTML output\n            // of an input element. Therefore, we do it \"by hand\".\n            if (this.container.hasChildNodes() && Type.exists(this.foreignObjLayer)) {\n                if (!ignoreTexts) {\n                    this.foreignObjLayer.setAttribute(\"display\", \"inline\");\n                    while (svgRoot.nextSibling) {\n                        // Copy all value attributes\n                        values = values.concat(this._getValuesOfDOMElements(svgRoot.nextSibling));\n                        this.foreignObjLayer.appendChild(svgRoot.nextSibling);\n                    }\n                }\n            }\n\n            this._getImgDataURL(svgRoot);\n\n            // Convert the SVG graphic into a string containing SVG code\n            svgRoot.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n            svg = new XMLSerializer().serializeToString(svgRoot);\n\n            if (ignoreTexts !== true) {\n                // Handle SVG texts\n                // Insert all value attributes back into the svg string\n                len = values.length;\n                for (i = 0; i < len; i++) {\n                    svg = svg.replace(\n                        'id=\"' + values[i][0] + '\"',\n                        'id=\"' + values[i][0] + '\" value=\"' + values[i][1] + '\"'\n                    );\n                }\n            }\n\n            // if (false) {\n            //     // Debug: use example svg image\n            //     svg = '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" width=\"220\" height=\"220\"><rect width=\"66\" height=\"30\" x=\"21\" y=\"32\" stroke=\"#204a87\" stroke-width=\"2\" fill=\"none\" /></svg>';\n            // }\n\n            // In IE we have to remove the namespace again.\n            if ((svg.match(/xmlns=\"http:\\/\\/www.w3.org\\/2000\\/svg\"/g) || []).length > 1) {\n                svg = svg.replace(/xmlns=\"http:\\/\\/www.w3.org\\/2000\\/svg\"/g, \"\");\n            }\n\n            // Safari fails if the svg string contains a \"&nbsp;\"\n            // Obsolete with Safari 12+\n            svg = svg.replace(/&nbsp;/g, \" \");\n            svg = svg.replace(/url\\(&quot;(.*)&quot;\\)/g, \"url($1)\");\n\n            // Move all HTML tags back from\n            // the foreignObject element to the container\n            if (Type.exists(this.foreignObjLayer) && this.foreignObjLayer.hasChildNodes()) {\n                // Restore all HTML elements\n                while (this.foreignObjLayer.firstChild) {\n                    this.container.appendChild(this.foreignObjLayer.firstChild);\n                }\n                this.foreignObjLayer.setAttribute(\"display\", \"none\");\n            }\n\n            return \"data:image/svg+xml;base64,\" + btoa(unescape(encodeURIComponent(svg)));\n        },\n\n        /**\n         * Convert the SVG construction into an HTML canvas image.\n         * This works for all SVG supporting browsers. Implemented as Promise.\n         * <p>\n         * Might fail if any text element or foreign object element contains SVG. This\n         * is the case e.g. for the default fullscreen symbol.\n         * <p>\n         * For IE, it is realized as function.\n         * It works from version 9, with the exception that HTML texts\n         * are ignored on IE. The drawing is done with a delay of\n         * 200 ms. Otherwise there would be problems with IE.\n         *\n         * @param {String} canvasId Id of an HTML canvas element\n         * @param {Number} w Width in pixel of the dumped image, i.e. of the canvas tag.\n         * @param {Number} h Height in pixel of the dumped image, i.e. of the canvas tag.\n         * @param {Boolean} ignoreTexts If true, the foreignObject tag is taken out from the SVG root.\n         * This is necessary for older versions of Safari. Default: false\n         * @returns {Promise}  Promise object\n         *\n         * @example\n         * \tboard.renderer.dumpToCanvas('canvas').then(function() { console.log('done'); });\n         *\n         * @example\n         *  // IE 11 example:\n         * \tboard.renderer.dumpToCanvas('canvas');\n         * \tsetTimeout(function() { console.log('done'); }, 400);\n         */\n        dumpToCanvas: function (canvasId, w, h, ignoreTexts) {\n            var svg, tmpImg,\n                cv, ctx,\n                doc = this.container.ownerDocument;\n\n            // Prepare the canvas element\n            cv = doc.getElementById(canvasId);\n\n            // Clear the canvas\n            /* eslint-disable no-self-assign */\n            cv.width = cv.width;\n            /* eslint-enable no-self-assign */\n\n            ctx = cv.getContext(\"2d\");\n            if (w !== undefined && h !== undefined) {\n                cv.style.width = parseFloat(w) + \"px\";\n                cv.style.height = parseFloat(h) + \"px\";\n                // Scale twice the CSS size to make the image crisp\n                // cv.setAttribute('width', 2 * parseFloat(wOrg));\n                // cv.setAttribute('height', 2 * parseFloat(hOrg));\n                // ctx.scale(2 * wOrg / w, 2 * hOrg / h);\n                cv.setAttribute(\"width\", parseFloat(w));\n                cv.setAttribute(\"height\", parseFloat(h));\n            }\n\n            // Display the SVG string as data-uri in an HTML img.\n            /**\n             * @type {Image}\n             * @ignore\n             * {ignore}\n             */\n            tmpImg = new Image();\n            svg = this.dumpToDataURI(ignoreTexts);\n            tmpImg.src = svg;\n\n            // Finally, draw the HTML img in the canvas.\n            if (!(\"Promise\" in window)) {\n                /**\n                 * @function\n                 * @ignore\n                 */\n                tmpImg.onload = function () {\n                    // IE needs a pause...\n                    // Seems to be broken\n                    window.setTimeout(function () {\n                        try {\n                            ctx.drawImage(tmpImg, 0, 0, w, h);\n                        } catch (err) {\n                            console.log(\"screenshots not longer supported on IE\");\n                        }\n                    }, 200);\n                };\n                return this;\n            }\n\n            return new Promise(function (resolve, reject) {\n                try {\n                    tmpImg.onload = function () {\n                        ctx.drawImage(tmpImg, 0, 0, w, h);\n                        resolve();\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        },\n\n        /**\n         * Display SVG image in html img-tag which enables\n         * easy download for the user.\n         *\n         * Support:\n         * <ul>\n         * <li> IE: No\n         * <li> Edge: full\n         * <li> Firefox: full\n         * <li> Chrome: full\n         * <li> Safari: full (No text support in versions prior to 12).\n         * </ul>\n         *\n         * @param {JXG.Board} board Link to the board.\n         * @param {String} imgId Optional id of an img object. If given and different from the empty string,\n         * the screenshot is copied to this img object. The width and height will be set to the values of the\n         * JSXGraph container.\n         * @param {Boolean} ignoreTexts If set to true, the foreignObject is taken out of the\n         *  SVGRoot and texts are not displayed. This is mandatory for Safari. Default: false\n         * @return {Object}       the svg renderer object\n         */\n        screenshot: function (board, imgId, ignoreTexts) {\n            var node,\n                doc = this.container.ownerDocument,\n                parent = this.container.parentNode,\n                // cPos,\n                // cssTxt,\n                canvas, id, img,\n                button, buttonText,\n                w, h,\n                bas = board.attr.screenshot,\n                navbar, navbarDisplay, insert,\n                newImg = false,\n                _copyCanvasToImg,\n                isDebug = false;\n\n            if (this.type === \"no\") {\n                return this;\n            }\n\n            w = bas.scale * this.container.getBoundingClientRect().width;\n            h = bas.scale * this.container.getBoundingClientRect().height;\n\n            if (imgId === undefined || imgId === \"\") {\n                newImg = true;\n                img = new Image(); //doc.createElement('img');\n                img.style.width = w + \"px\";\n                img.style.height = h + \"px\";\n            } else {\n                newImg = false;\n                img = doc.getElementById(imgId);\n            }\n            // img.crossOrigin = 'anonymous';\n\n            // Create div which contains canvas element and close button\n            if (newImg) {\n                node = doc.createElement(\"div\");\n                node.style.cssText = bas.css;\n                node.style.width = w + \"px\";\n                node.style.height = h + \"px\";\n                node.style.zIndex = this.container.style.zIndex + 120;\n\n                // Try to position the div exactly over the JSXGraph board\n                node.style.position = \"absolute\";\n                node.style.top = this.container.offsetTop + \"px\";\n                node.style.left = this.container.offsetLeft + \"px\";\n            }\n\n            if (!isDebug) {\n                // Create canvas element and add it to the DOM\n                // It will be removed after the image has been stored.\n                canvas = doc.createElement(\"canvas\");\n                id = Math.random().toString(36).slice(2, 7);\n                canvas.setAttribute(\"id\", id);\n                canvas.setAttribute(\"width\", w);\n                canvas.setAttribute(\"height\", h);\n                canvas.style.width = w + \"px\";\n                canvas.style.height = w + \"px\";\n                canvas.style.display = \"none\";\n                parent.appendChild(canvas);\n            } else {\n                // Debug: use canvas element 'jxgbox_canvas' from jsxdev/dump.html\n                id = \"jxgbox_canvas\";\n                // canvas = document.getElementById(id);\n                canvas = doc.getElementById(id);\n            }\n\n            if (newImg) {\n                // Create close button\n                button = doc.createElement(\"span\");\n                buttonText = doc.createTextNode(\"\\u2716\");\n                button.style.cssText = bas.cssButton;\n                button.appendChild(buttonText);\n                button.onclick = function () {\n                    node.parentNode.removeChild(node);\n                };\n\n                // Add all nodes\n                node.appendChild(img);\n                node.appendChild(button);\n                parent.insertBefore(node, this.container.nextSibling);\n            }\n\n            // Hide navigation bar in board\n            navbar = doc.getElementById(this.uniqName('navigationbar'));\n            if (Type.exists(navbar)) {\n                navbarDisplay = navbar.style.display;\n                navbar.style.display = \"none\";\n                insert = this.removeToInsertLater(navbar);\n            }\n\n            _copyCanvasToImg = function () {\n                // Show image in img tag\n                img.src = canvas.toDataURL(\"image/png\");\n\n                // Remove canvas node\n                if (!isDebug) {\n                    parent.removeChild(canvas);\n                }\n            };\n\n            // Create screenshot in image element\n            if (\"Promise\" in window) {\n                this.dumpToCanvas(id, w, h, ignoreTexts).then(_copyCanvasToImg);\n            } else {\n                // IE\n                this.dumpToCanvas(id, w, h, ignoreTexts);\n                window.setTimeout(_copyCanvasToImg, 200);\n            }\n\n            // Reinsert navigation bar in board\n            if (Type.exists(navbar)) {\n                navbar.style.display = navbarDisplay;\n                insert();\n            }\n\n            return this;\n        }\n    }\n);\n\nexport default JXG.SVGRenderer;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,OAAOA,GAAG,MAAM,QAAQ;AACxB,OAAOC,OAAO,MAAM,YAAY;AAChC,OAAOC,gBAAgB,MAAM,YAAY;AACzC,OAAOC,KAAK,MAAM,mBAAmB;AACrC,OAAOC,IAAI,MAAM,eAAe;AAChC,OAAOC,KAAK,MAAM,gBAAgB;AAClC,OAAOC,MAAM,MAAM,iBAAiB;AACpC,OAAOC,QAAQ,MAAM,kBAAkB;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAP,GAAG,CAACQ,WAAW,GAAG,UAAUC,SAAS,EAAEC,GAAG,EAAE;EACxC,IAAIC,CAAC;;EAEL;EACA,IAAI,CAACC,IAAI,GAAG,KAAK;EAEjB,IAAI,CAACC,IAAI,GACLC,SAAS,CAACC,UAAU,CAACC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAIF,SAAS,CAACG,SAAS,CAACC,KAAK,CAAC,WAAW,CAAC;;EAEzF;AACJ;AACA;AACA;EACI,IAAI,CAACC,OAAO,GAAG,IAAI;;EAEnB;AACJ;AACA;AACA;AACA;AACA;EACI,IAAI,CAACC,YAAY,GAAG,4BAA4B;;EAEhD;AACJ;AACA;AACA;AACA;AACA;EACI,IAAI,CAACC,cAAc,GAAG,8BAA8B;;EAEpD;EACA;EACA,IAAI,CAACZ,SAAS,GAAGA,SAAS;;EAE1B;EACA,IAAI,CAACA,SAAS,CAACa,KAAK,CAACC,aAAa,GAAG,MAAM;EAC3C,IAAI,CAACd,SAAS,CAACa,KAAK,CAACE,UAAU,GAAG,MAAM;EAExC,IAAI,CAACf,SAAS,CAACa,KAAK,CAACG,QAAQ,GAAG,QAAQ;EACxC,IAAI,IAAI,CAAChB,SAAS,CAACa,KAAK,CAACI,QAAQ,KAAK,EAAE,EAAE;IACtC,IAAI,CAACjB,SAAS,CAACa,KAAK,CAACI,QAAQ,GAAG,UAAU;EAC9C;EAEA,IAAI,CAACP,OAAO,GAAG,IAAI,CAACV,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,KAAK,CAAC;EACrF,IAAI,CAACD,OAAO,CAACG,KAAK,CAACG,QAAQ,GAAG,QAAQ;EACtC,IAAI,CAACN,OAAO,CAACG,KAAK,CAACO,OAAO,GAAG,OAAO;EAEpC,IAAI,CAACC,MAAM,CAACpB,GAAG,CAACqB,KAAK,EAAErB,GAAG,CAACsB,MAAM,CAAC;;EAElC;;EAEA,IAAI,CAACvB,SAAS,CAACwB,WAAW,CAAC,IAAI,CAACd,OAAO,CAAC;;EAExC;AACJ;AACA;AACA;AACA;EACI,IAAI,CAACe,IAAI,GAAG,IAAI,CAACzB,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,MAAM,CAAC;EACnF,IAAI,CAACD,OAAO,CAACc,WAAW,CAAC,IAAI,CAACC,IAAI,CAAC;;EAEnC;AACJ;AACA;AACA;AACA;EACI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,IAAI,CAACC,kBAAkB,GAAG,UAAUC,EAAE,EAAEC,GAAG,EAAEC,OAAO,EAAEC,KAAK,EAAEC,IAAI,EAAEC,MAAM,EAAE;IACvE,IAAIC,MAAM,GAAG,IAAI,CAACjC,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,QAAQ,CAAC;MAClFuB,QAAQ;MAAEC,OAAO;MAAEC,cAAc;MAAEC,OAAO;MAC1CC,GAAG;IAEPL,MAAM,CAACM,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEZ,EAAE,CAAC;IACrCM,MAAM,CAACM,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC;IAC5CN,MAAM,CAACM,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,CAAC;IAC7CN,MAAM,CAACM,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,gBAAgB,CAAC;IAE5DL,QAAQ,GAAG,IAAI,CAAClC,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,UAAU,CAAC;IACtFuB,QAAQ,CAACK,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC,CAAC;IACtDL,QAAQ,CAACK,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,QAAQ,CAAC;IACjDL,QAAQ,CAACK,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEP,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9CE,QAAQ,CAACK,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEP,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9CC,MAAM,CAACT,WAAW,CAACU,QAAQ,CAAC;IAE5BC,OAAO,GAAG,IAAI,CAACnC,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,eAAe,CAAC;IAC1FwB,OAAO,CAACI,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC;IAC5CJ,OAAO,CAACI,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,UAAU,CAAC;IAClDJ,OAAO,CAACI,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC;IAC9C;IACA,IAAIX,GAAG,KAAK,MAAM,IAAI,CAACjC,IAAI,CAAC6C,OAAO,CAACZ,GAAG,CAAC,IAAIA,GAAG,CAACa,MAAM,GAAG,CAAC,EAAE;MACxDN,OAAO,CAACI,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,+CAA+C,GAAGV,OAAO,GAAG,IAAI,CAAC;IAC5G,CAAC,MAAM;MACHD,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG;MACbA,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG;MACbA,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG;MACbU,GAAG,GAAGR,KAAK,GAAG,SAAS,GAAGF,GAAG,CAAC,CAAC,CAAC,GAC5B,MAAM,GAAGE,KAAK,GAAG,OAAO,GAAGF,GAAG,CAAC,CAAC,CAAC,GACjC,QAAQ,GAAGE,KAAK,GAAG,KAAK,GAAGF,GAAG,CAAC,CAAC,CAAC,GACjC,UAAU,GAAGC,OAAO,GAAG,IAAI;MAC/BM,OAAO,CAACI,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAED,GAAG,CAAC;IAC/C;IACAL,MAAM,CAACT,WAAW,CAACW,OAAO,CAAC;IAE3BC,cAAc,GAAG,IAAI,CAACpC,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,gBAAgB,CAAC;IAClGyB,cAAc,CAACG,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,UAAU,CAAC;IACrDH,cAAc,CAACG,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC;IACxDH,cAAc,CAACG,cAAc,CAAC,IAAI,EAAE,cAAc,EAAER,IAAI,CAAC;IACzDE,MAAM,CAACT,WAAW,CAACY,cAAc,CAAC;IAElCC,OAAO,GAAG,IAAI,CAACrC,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,SAAS,CAAC;IACpF0B,OAAO,CAACE,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,eAAe,CAAC;IACnDF,OAAO,CAACE,cAAc,CAAC,IAAI,EAAE,KAAK,EAAE,SAAS,CAAC;IAC9CF,OAAO,CAACE,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC;IAC9CN,MAAM,CAACT,WAAW,CAACa,OAAO,CAAC;IAE3B,OAAOJ,MAAM;EACjB,CAAC;;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,IAAI,CAACS,QAAQ,GAAG,YAAY;IACxB,OAAO,IAAI,CAAC1C,SAAS,CAAC2B,EAAE,GAAG,GAAG,GAC1BgB,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACC,SAAS,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;EACvD,CAAC;;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,IAAI,CAACC,KAAK,GAAG,YAAW;IACpB;IACA,IAAIC,GAAG,GAAGP,KAAK,CAACC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACC,SAAS,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;IACxD;IACA,IAAIrD,IAAI,CAACwD,MAAM,CAACC,GAAG,CAAC,IAAIzD,IAAI,CAACwD,MAAM,CAACC,GAAG,CAACC,MAAM,CAAC,EAAE;MAC7CH,GAAG,GAAGE,GAAG,CAACC,MAAM,CAACH,GAAG,CAAC;IACzB;IACA,OAAOA,GAAG;EACd,CAAC;;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,IAAI,CAACI,KAAK,GAAG,YAAY;IACrB,OAAO,OAAO,GACV,IAAI,CAACL,KAAK,CAACM,KAAK,CAAC,IAAI,EAAER,SAAS,CAAC;IAAG;IACpC,GAAG;EACX,CAAC;;EAED;EACA,IAAI,CAACtB,IAAI,CAACD,WAAW,CAAC,IAAI,CAACE,kBAAkB,CAAC,IAAI,CAACgB,QAAQ,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;EAE9F;AACJ;AACA;AACA;AACA;AACA;EACI,IAAI,CAACc,KAAK,GAAG,EAAE;EACf,KAAKtD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGV,OAAO,CAACgE,KAAK,CAACC,SAAS,EAAEvD,CAAC,EAAE,EAAE;IAC1C,IAAI,CAACsD,KAAK,CAACtD,CAAC,CAAC,GAAG,IAAI,CAACF,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,GAAG,CAAC;IACpF,IAAI,CAACD,OAAO,CAACc,WAAW,CAAC,IAAI,CAACgC,KAAK,CAACtD,CAAC,CAAC,CAAC;EAC3C;EAEA,IAAI;IACA,IAAI,CAACwD,eAAe,GAAG,IAAI,CAAC1D,SAAS,CAACkB,aAAa,CAACC,eAAe,CAC/D,IAAI,CAACR,YAAY,EACjB,eACJ,CAAC;IACD,IAAI,CAAC+C,eAAe,CAACC,YAAY,CAAC,SAAS,EAAE,MAAM,CAAC;IACpD,IAAI,CAACD,eAAe,CAACC,YAAY,CAAC,GAAG,EAAE,CAAC,CAAC;IACzC,IAAI,CAACD,eAAe,CAACC,YAAY,CAAC,GAAG,EAAE,CAAC,CAAC;IACzC,IAAI,CAACD,eAAe,CAACC,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC;IAClD,IAAI,CAACD,eAAe,CAACC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC;IACnD,IAAI,CAACD,eAAe,CAACC,YAAY,CAAC,IAAI,EAAE,IAAI,CAACjB,QAAQ,CAAC,YAAY,CAAC,CAAC;IACpE,IAAI,CAAChC,OAAO,CAACc,WAAW,CAAC,IAAI,CAACkC,eAAe,CAAC;IAC9C,IAAI,CAACE,qBAAqB,GAAG,IAAI;EACrC,CAAC,CAAC,OAAOC,CAAC,EAAE;IACR,IAAI,CAACD,qBAAqB,GAAG,KAAK;EACtC;AACJ,CAAC;AAEDrE,GAAG,CAACQ,WAAW,CAAC6C,SAAS,GAAG,IAAInD,gBAAgB,CAAC,CAAC;AAElDF,GAAG,CAACuE,MAAM,CACNvE,GAAG,CAACQ,WAAW,CAAC6C,SAAS,EACzB,uCAAwC;EACpC;AACR;AACA;AACA;AACA;AACA;AACA;EACQmB,gBAAgB,EAAE,SAAAA,CAAUC,EAAE,EAAEC,UAAU,EAAE9D,IAAI,EAAE;IAC9C,IAAI+D,KAAK;MACLC,KAAK;MACLxC,EAAE,GAAGqC,EAAE,CAACrC,EAAE,GAAG,UAAU;MACvB;MACAyC,CAAC;MACDC,CAAC;IAEL,IAAI1E,IAAI,CAACwD,MAAM,CAACc,UAAU,CAAC,EAAE;MACzBtC,EAAE,IAAIsC,UAAU;IACpB;IACA,IAAItE,IAAI,CAACwD,MAAM,CAAChD,IAAI,CAAC,EAAE;MACnBwB,EAAE,IAAIxB,IAAI;IACd;IACA+D,KAAK,GAAG,IAAI,CAACI,UAAU,CAAC,QAAQ,EAAE3C,EAAE,CAAC;IAErCuC,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACC,WAAW,CAAC,CAAC;IAC3EP,KAAK,CAAC3B,cAAc,CAChB,IAAI,EACJ,gBAAgB,EAChB5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACE,aAAa,CAC1C,CAAC;IACDR,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACC,WAAW,CAAC,CAAC;IACzEP,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACE,aAAa,CAAC,CAAC;IACnFR,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE,CAAC,CAAC,CAAC,CAAC;IAC/C;;IAEA2B,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,CAAC;IAC5C2B,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC,CAAC;;IAE1D;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IAOY4B,KAAK,GAAG,IAAI,CAACnE,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAE,MAAM,CAAC;IAC/E0D,CAAC,GAAG,CAAC;IACL,IAAIJ,UAAU,KAAK,OAAO,EAAE;MACxB;MACA;MACA;MACA;MACA;;MAEAG,CAAC,GAAG,CAAC;MACL,IAAIjE,IAAI,KAAK,CAAC,EAAE;QACZgE,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,8BAA8B,CAAC;MACnE,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnBgE,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,mCAAmC,CAAC;MACxE,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,GAAG;QACPF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,4FACJ,CAAC;MACL,CAAC,MAAM;QACH;QACA4B,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,wBAAwB,CAAC;MAC7D;MACA;MACI;MACAyB,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACkF,iBAAiB,EAC7C;QACE,IAAIzE,IAAI,KAAK,CAAC,EAAE;UACZiE,CAAC,GAAG,GAAG;QACX,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,EAAE;UACnBiE,CAAC,GAAG,GAAG;QACX,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,IAAIA,IAAI,KAAK,CAAC,IAAIA,IAAI,KAAK,CAAC,EAAE;UAC/CiE,CAAC,GAAG,IAAI;QACZ,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,EAAE;UACnBiE,CAAC,GAAG,GAAG;QACX,CAAC,MAAM;UACHA,CAAC,GAAG,IAAI;QACZ;MACJ;IACJ,CAAC,MAAM;MACH;MACA;MACA;MACA;MACA;;MAEAA,CAAC,GAAG,IAAI;MACR,IAAIjE,IAAI,KAAK,CAAC,EAAE;QACZgE,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,6BAA6B,CAAC;MAClE,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnBiE,CAAC,GAAG,GAAG;QACPD,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,mCAAmC,CAAC;MACxE,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,IAAI;QACRF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,+IACJ,CAAC;MACL,CAAC,MAAM,IAAIpC,IAAI,KAAK,CAAC,EAAE;QACnB;QACAkE,CAAC,GAAG,GAAG;QACPF,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,GAAG,EACH,4FACJ,CAAC;MACL,CAAC,MAAM;QACH;QACA4B,KAAK,CAAC5B,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,uBAAuB,CAAC;MAC5D;MACA;MACI;MACAyB,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACkF,iBAAiB,EAC7C;QACE,IAAIzE,IAAI,KAAK,CAAC,EAAE;UACZiE,CAAC,GAAG,GAAG;QACX,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,EAAE;UACnBiE,CAAC,GAAG,IAAI;QACZ,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,IAAIA,IAAI,KAAK,CAAC,IAAIA,IAAI,KAAK,CAAC,EAAE;UAC/CiE,CAAC,GAAG,IAAI;QACZ,CAAC,MAAM,IAAIjE,IAAI,KAAK,CAAC,EAAE;UACnBiE,CAAC,GAAG,IAAI;QACZ,CAAC,MAAM;UACHA,CAAC,GAAG,IAAI;QACZ;MACJ;IACJ;IACA,IAAIjE,IAAI,KAAK,CAAC,EAAE;MACZ+D,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC;MAC1C2B,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE,CAAC,CAAC,CAAC,CAAC;IACnD;IACA2B,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE8B,CAAC,CAAC;IACrCH,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE6B,CAAC,CAAC;IAErCF,KAAK,CAAC1C,WAAW,CAAC2C,KAAK,CAAC;IACxB,OAAOD,KAAK;EAChB,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;EACQW,cAAc,EAAE,SAAAA,CAAUC,IAAI,EAAEC,KAAK,EAAElD,OAAO,EAAEmC,EAAE,EAAE7D,IAAI,EAAE;IACtD,IAAI2E,IAAI,EAAE;MACN,IAAInF,IAAI,CAACqF,QAAQ,CAACD,KAAK,CAAC,EAAE;QACtB,IAAI5E,IAAI,KAAK,CAAC,EAAE;UACZ,IAAI,CAAC8E,aAAa,CAAC,YAAY;YAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAEwC,KAAK,CAAC;YAC1CD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAEwC,KAAK,CAAC;YACxCD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAEV,OAAO,CAAC;YACpDiD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAEV,OAAO,CAAC;UACtD,CAAC,EAAEmC,EAAE,CAACkB,UAAU,CAACC,SAAS,CAAC;QAC/B,CAAC,MAAM;UACH,IAAI,CAACF,aAAa,CAAC,YAAY;YAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC;YACzCuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAEwC,KAAK,CAAC;YAC1CD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAEV,OAAO,CAAC;UACxD,CAAC,EAAEmC,EAAE,CAACkB,UAAU,CAACC,SAAS,CAAC;QAC/B;MACJ;MAEA,IAAI,IAAI,CAAC/E,IAAI,EAAE;QACX4D,EAAE,CAACoB,QAAQ,CAACC,UAAU,CAACC,YAAY,CAACtB,EAAE,CAACoB,QAAQ,EAAEpB,EAAE,CAACoB,QAAQ,CAAC;MACjE;IACJ;EACJ,CAAC;EAED;EACAG,cAAc,EAAE,SAAAA,CAAUT,IAAI,EAAExD,KAAK,EAAE+D,UAAU,EAAEG,IAAI,EAAE;IACrD,IAAIC,CAAC,EAAEC,CAAC;IAER,IAAIZ,IAAI,EAAE;MACN;MACA;MACA;MACA;MACAW,CAAC,GAAGnE,KAAK;MACToE,CAAC,GAAGD,CAAC,GAAGD,IAAI;MACZV,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,GAAGkD,CAAC,GAAG,EAAE,GAAG,GAAG,GAAGA,CAAC,GAAG,EAAE,CAAC;MAC/EX,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAEmD,CAAC,CAAC;MAC5CZ,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,aAAa,EAAEmD,CAAC,CAAC;MAC3CZ,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,CAAC;MAC/C;;MAEA,IAAI,IAAI,CAACnC,IAAI,EAAE;QACXiF,UAAU,CAACA,UAAU,CAACC,YAAY,CAACD,UAAU,EAAEA,UAAU,CAAC;MAC9D;IACJ;EACJ,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;;EAEQ;AACR;AACA;;EAEQ;EACAM,WAAW,EAAE,SAAAA,CAAUC,KAAK,EAAE;IAC1B,IAAI1F,CAAC;MACD2F,CAAC;MACDC,CAAC;MACDhB,IAAI;MACJiB,CAAC;MACDC,CAAC;MACDC,OAAO,GAAG,EAAE;MACZC,GAAG,GAAGN,KAAK,CAACA,KAAK,CAACnD,MAAM;MACxB0D,IAAI;MACJjD,GAAG;MACHkD,MAAM,GAAG,IAAI;IAEjB,KAAKlG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;MACtB4F,CAAC,GAAGF,KAAK,CAACA,KAAK,CAAC1F,CAAC,CAAC;MAClB6F,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC;MACRE,CAAC,GAAGF,CAAC,CAAC,CAAC,CAAC;MAERK,IAAI,GAAGJ,CAAC,CAACtD,MAAM;MACfS,GAAG,GAAG,KAAK,GAAG6C,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGC,CAAC,CAAC,CAAC,CAAC;MAC/B,IAAI,CAACrG,IAAI,CAAC0G,QAAQ,CAACN,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;QACtBK,MAAM,GAAG,KAAK;MAClB;MACA,KAAKP,CAAC,GAAG,CAAC,EAAEO,MAAM,IAAIP,CAAC,GAAGM,IAAI,EAAE,EAAEN,CAAC,EAAE;QACjC,IAAIlG,IAAI,CAAC0G,QAAQ,CAACN,CAAC,CAACF,CAAC,CAAC,CAAC,EAAE;UACrB3C,GAAG,IAAI,KAAK,GAAG6C,CAAC,CAACF,CAAC,CAAC,GAAG,GAAG,GAAGG,CAAC,CAACH,CAAC,CAAC;QACpC,CAAC,MAAM;UACHO,MAAM,GAAG,KAAK;QAClB;MACJ;MACA,IAAIA,MAAM,EAAE;QACRH,OAAO,IAAI/C,GAAG;MAClB;IACJ;IAEA4B,IAAI,GAAGc,KAAK,CAACR,QAAQ;IAErB,IAAI,CAACzF,IAAI,CAACwD,MAAM,CAAC2B,IAAI,CAAC,EAAE;MACpBA,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,MAAM,EAAEsB,KAAK,CAACjE,EAAE,CAAC;MACxC,IAAI,CAAC2E,eAAe,CAACxB,IAAI,EAAEnF,IAAI,CAAC4E,QAAQ,CAACqB,KAAK,CAACpB,OAAO,CAAChB,KAAK,CAAC,CAAC;MAC9DoC,KAAK,CAACR,QAAQ,GAAGN,IAAI;IACzB;IAEAA,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE5C,IAAI,CAAC4E,QAAQ,CAACqB,KAAK,CAACpB,OAAO,CAACC,WAAW,CAAC,CAAC;IAC7EK,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC;IACzC;IACA;IACAuC,IAAI,CAACvC,cAAc,CACf,IAAI,EACJ,gBAAgB,EAChB5C,IAAI,CAAC4E,QAAQ,CAACqB,KAAK,CAACpB,OAAO,CAACE,aAAa,CAC7C,CAAC;IACDI,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE5C,IAAI,CAAC4E,QAAQ,CAACqB,KAAK,CAACpB,OAAO,CAAC+B,WAAW,CAAC,CAAC;IACnF,IAAI,CAACC,cAAc,CAAC1B,IAAI,EAAEmB,OAAO,EAAEL,KAAK,CAACa,KAAK,CAAC;IAC/C,IAAI,CAACC,iBAAiB,CAACd,KAAK,CAAC;EACjC,CAAC;EAED;AACR;AACA;;EAEQ;EACAe,gBAAgB,EAAE,SAAAA,CAAUzD,GAAG,EAAE0D,QAAQ,EAAE;IACvC,IAAI9B,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,MAAM,EAAE,aAAa,CAAC;MAC7CuC,CAAC;IACL/B,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,MAAM,CAAC;IACtCuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,GAAGqE,QAAQ,GAAG,IAAI,CAAC;IACnD9B,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE,oDAAoD,GACnFqE,QAAQ,GAAG,iCAAiC,CAAC;IACjDC,CAAC,GAAG,IAAI,CAAC7G,SAAS,CAACkB,aAAa,CAAC4F,cAAc,CAAC5D,GAAG,CAAC;IACpD4B,IAAI,CAACtD,WAAW,CAACqF,CAAC,CAAC;IACnB,IAAI,CAACP,eAAe,CAACxB,IAAI,EAAE,CAAC,CAAC;EACjC,CAAC;EAED;EACAiC,gBAAgB,EAAE,SAAAA,CAAU/C,EAAE,EAAE;IAC5B,IAAIc,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,MAAM,EAAEN,EAAE,CAACrC,EAAE,CAAC;;IAEzC;IACA;IACA;IACAmD,IAAI,CAACjE,KAAK,CAACmG,UAAU,GAAG,QAAQ;IAEhChD,EAAE,CAACiD,YAAY,GAAG,IAAI,CAACjH,SAAS,CAACkB,aAAa,CAAC4F,cAAc,CAAC,EAAE,CAAC;IACjEhC,IAAI,CAACtD,WAAW,CAACwC,EAAE,CAACiD,YAAY,CAAC;IACjC,IAAI,CAACX,eAAe,CAACxB,IAAI,EAAEnF,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAChB,KAAK,CAAC,CAAC;IAE3D,OAAOsB,IAAI;EACf,CAAC;EAED;EACAoC,kBAAkB,EAAE,SAAAA,CAAUlD,EAAE,EAAE;IAC9B,IAAImD,OAAO,GAAGnD,EAAE,CAACoD,SAAS;MACtBhD,CAAC;MACDiD,KAAK,GAAGrD,EAAE,CAACsD,UAAU,CAAC,CAAC;MACvBC,KAAK,GAAGvD,EAAE,CAACwD,UAAU,CAAC,CAAC;IAE3B,IAAIxD,EAAE,CAACoB,QAAQ,CAACqC,cAAc,CAAC,IAAI,EAAE,OAAO,CAAC,KAAKzD,EAAE,CAACQ,OAAO,CAACkD,QAAQ,EAAE;MACnE1D,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACkD,QAAQ,CAAC,CAAC;MAC7E1D,EAAE,CAAC2D,eAAe,GAAG,IAAI;IAC7B;IAEA,IAAI,CAACC,KAAK,CAAC5D,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,GAAG9D,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE;MACzD;MACA1D,CAAC,GAAGJ,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC;MAC1B,IAAI9D,EAAE,CAACkB,UAAU,CAAC6C,IAAI,KAAKV,KAAK,GAAGjD,CAAC,EAAE;QAClCJ,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE6B,CAAC,GAAG,IAAI,CAAC;QAE/C,IAAIiD,KAAK,KAAK,MAAM,EAAE;UAClBrD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,OAAO,CAAC;QAC5D,CAAC,MAAM,IAAI8E,KAAK,KAAK,OAAO,EAAE;UAC1BrD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,KAAK,CAAC;QAC1D,CAAC,MAAM,IAAI8E,KAAK,KAAK,QAAQ,EAAE;UAC3BrD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,QAAQ,CAAC;QAC7D;QACAyB,EAAE,CAACkB,UAAU,CAAC6C,IAAI,GAAGV,KAAK,GAAGjD,CAAC;MAClC;;MAEA;MACAA,CAAC,GAAGJ,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC;MAC1B,IAAI9D,EAAE,CAACkB,UAAU,CAAC8C,GAAG,KAAKT,KAAK,GAAGnD,CAAC,EAAE;QACjCJ,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE6B,CAAC,GAAG,IAAI,CAAC6D,WAAW,GAAG,GAAG,GAAG,IAAI,CAAC;QAExE,IAAIV,KAAK,KAAK,QAAQ,EAAE;UACpBvD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CACtB,IAAI,EACJ,mBAAmB,EACnB,iBACJ,CAAC;QACL,CAAC,MAAM,IAAIgF,KAAK,KAAK,KAAK,EAAE;UACxBvD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,CAAC;UAC/C;QACJ,CAAC,MAAM,IAAIgF,KAAK,KAAK,QAAQ,EAAE;UAC3B;UACAvD,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,CAAC;QACnD;QACAyB,EAAE,CAACkB,UAAU,CAAC8C,GAAG,GAAGT,KAAK,GAAGnD,CAAC;MACjC;IACJ;IACA,IAAIJ,EAAE,CAACkE,OAAO,KAAKf,OAAO,EAAE;MACxBnD,EAAE,CAACiD,YAAY,CAACkB,IAAI,GAAGhB,OAAO;MAC9BnD,EAAE,CAACkE,OAAO,GAAGf,OAAO;IACxB;IACA,IAAI,CAACiB,cAAc,CAACpE,EAAE,EAAEA,EAAE,CAACqE,eAAe,CAAC;EAC/C,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;EACQC,uBAAuB,EAAE,SAAAA,CAAUtE,EAAE,EAAEuE,WAAW,EAAEC,aAAa,EAAEC,QAAQ,EAAE;IACzE,IAAI,CAAC/B,iBAAiB,CAAC1C,EAAE,CAAC;IAC1B,IAAI,CAAC0E,kBAAkB,CAAC1E,EAAE,EAAEuE,WAAW,EAAEC,aAAa,CAAC;EAC3D,CAAC;EAED;AACR;AACA;;EAEQ;EACAG,SAAS,EAAE,SAAAA,CAAU3E,EAAE,EAAE;IACrB,IAAIc,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,OAAO,EAAEN,EAAE,CAACrC,EAAE,CAAC;IAE1CmD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,qBAAqB,EAAE,MAAM,CAAC;IACxD,IAAI,CAAC+D,eAAe,CAACxB,IAAI,EAAEnF,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAChB,KAAK,CAAC,CAAC;IAC3DQ,EAAE,CAACoB,QAAQ,GAAGN,IAAI;IAElB,IAAI,CAAC8D,WAAW,CAAC5E,EAAE,CAAC;EACxB,CAAC;EAED;EACAoE,cAAc,EAAE,SAAAA,CAAUpE,EAAE,EAAE6C,CAAC,EAAE;IAC7B,IAAIpB,CAAC;MAAEoD,CAAC;MACJ/D,IAAI,GAAGd,EAAE,CAACoB,QAAQ;MAClBlC,GAAG,GAAG,EAAE;MACR4F,EAAE;MAAEC,EAAE;MACN7C,GAAG,GAAGW,CAAC,CAACpE,MAAM;IAElB,IAAIyD,GAAG,GAAG,CAAC,EAAE;MACT2C,CAAC,GAAG,IAAI,CAACG,cAAc,CAAChF,EAAE,EAAE6C,CAAC,CAAC;MAC9BpB,CAAC,GAAG,CAACoD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC7F,IAAI,CAAC,GAAG,CAAC;MACpE,IAAIyC,CAAC,CAAClF,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;QACzB2C,GAAG,IAAI,UAAU,GAAGuC,CAAC,GAAG,IAAI;QAC5B,IAAIzB,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACuJ,iBAAiB,IAAIjF,EAAE,CAACQ,OAAO,CAACpD,OAAO,KAAK,MAAM,EAAE;UAC9E0D,IAAI,CAACjE,KAAK,CAACqI,SAAS,GAAGhG,GAAG;UAC1B4F,EAAE,GAAG,CAAC9E,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC;UAC5BiB,EAAE,GAAG,CAAC/E,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC;UAC5B,QAAQnI,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC2E,OAAO,CAAC;YACrC,KAAK,OAAO;cAAEL,EAAE,IAAI9E,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC;cAAE;YAChC,KAAK,QAAQ;cAAEsD,EAAE,IAAI9E,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG;cAAE;UAC3C;UACA,QAAQ7F,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC4E,OAAO,CAAC;YACrC,KAAK,QAAQ;cAAEL,EAAE,IAAI/E,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC;cAAE;YACjC,KAAK,QAAQ;cAAEuD,EAAE,IAAI/E,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG;cAAE;UAC3C;UACAV,IAAI,CAACjE,KAAK,CAAC,kBAAkB,CAAC,GAAIiI,EAAE,GAAI,KAAK,GAAIC,EAAG,GAAG,IAAI;QAC/D,CAAC,MAAM;UACH;UACAjE,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,WAAW,EAAEW,GAAG,CAAC;QAC/C;MACJ;IACJ;EACJ,CAAC;EAED;EACAmG,cAAc,EAAE,SAAAA,CAAUrF,EAAE,EAAE;IAC1B,IAAIsF,GAAG,GAAG3J,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACsF,GAAG,CAAC;IAE/B,IAAItF,EAAE,CAACuF,IAAI,KAAKD,GAAG,EAAE;MACjBtF,EAAE,CAACwF,WAAW,GAAG,KAAK;MACtBxF,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,CAAC3B,cAAc,EAAE,YAAY,EAAE0I,GAAG,CAAC;MAClEtF,EAAE,CAACuF,IAAI,GAAGD,GAAG;MAEb,OAAO,IAAI;IACf;IAEA,OAAO,KAAK;EAChB,CAAC;EAED;EACAG,gBAAgB,EAAE,SAAAA,CAAUzF,EAAE,EAAE0F,WAAW,EAAE;IACzC,IAAIC,GAAG,GAAGhK,IAAI,CAAC4E,QAAQ,CACnBmF,WAAW,GAAG1F,EAAE,CAACQ,OAAO,CAACoF,iBAAiB,GAAG5F,EAAE,CAACQ,OAAO,CAACkD,QAC5D,CAAC;IAED1D,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,OAAO,EAAEoH,GAAG,CAAC;EAClD,CAAC;EAED;EACAE,iBAAiB,EAAE,SAAAA,CAAU7F,EAAE,EAAE;IAC7BA,EAAE,CAACoB,QAAQ,GAAG,IAAI,CAACkB,eAAe,CAC9B,IAAI,CAAChC,UAAU,CAAC,eAAe,EAAEN,EAAE,CAACrC,EAAE,CAAC,EACvChC,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAChB,KAAK,CAClC,CAAC;IAED,IAAI,CAACsG,oBAAoB,CAAC9F,EAAE,EAAE,eAAe,CAAC;IAC9C,IAAI,CAAC+F,mBAAmB,CAAC/F,EAAE,CAAC;EAChC,CAAC;EAED;EACA+F,mBAAmB,EAAE,SAAAA,CAAU/F,EAAE,EAAE;IAC/B,IAAIA,EAAE,CAACgG,YAAY,EAAE;MACjBhG,EAAE,CAACoB,QAAQ,CAACvE,KAAK,CAACG,QAAQ,GAAG,QAAQ;IACzC,CAAC,MAAM;MACHgD,EAAE,CAACoB,QAAQ,CAACvE,KAAK,CAACG,QAAQ,GAAG,SAAS;IAC1C;IAEA,IAAI,CAACiJ,cAAc,CACfjG,EAAE,CAACoB,QAAQ,EACXpB,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,EACtB9D,EAAE,CAAC6D,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,GAAG9D,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC,EACnCxB,EAAE,CAACwB,IAAI,CAAC,CAAC,CAAC,EACVxB,EAAE,CAACwB,IAAI,CAAC,CAAC,CACb,CAAC;IAEDxB,EAAE,CAACoB,QAAQ,CAAC8E,SAAS,GAAGlG,EAAE,CAACmD,OAAO;IAClC,IAAI,CAACgD,aAAa,CAACnG,EAAE,EAAE;MAAEoG,MAAM,EAAE,IAAI;MAAEC,IAAI,EAAE;IAAK,CAAC,EAAE,IAAI,CAAC;EAC9D,CAAC;EAED;AACR;AACA;;EAEQ;EACA/D,eAAe,EAAE,SAAAA,CAAUxB,IAAI,EAAEwF,KAAK,EAAE;IACpC,IAAI,CAAC3K,IAAI,CAACwD,MAAM,CAACmH,KAAK,CAAC,EAAE;MACrB;MACAA,KAAK,GAAG,CAAC;IACb,CAAC,MAAM,IAAIA,KAAK,IAAI9K,OAAO,CAACgE,KAAK,CAACC,SAAS,EAAE;MACzC6G,KAAK,GAAG9K,OAAO,CAACgE,KAAK,CAACC,SAAS,GAAG,CAAC;IACvC;IAEA,IAAI,CAACD,KAAK,CAAC8G,KAAK,CAAC,CAAC9I,WAAW,CAACsD,IAAI,CAAC;IAEnC,OAAOA,IAAI;EACf,CAAC;EAED;EACAR,UAAU,EAAE,SAAAA,CAAUnE,IAAI,EAAEwB,EAAE,EAAE;IAC5B,IAAImD,IAAI,GAAG,IAAI,CAAC9E,SAAS,CAACkB,aAAa,CAACC,eAAe,CAAC,IAAI,CAACR,YAAY,EAAER,IAAI,CAAC;IAChF2E,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAACG,QAAQ,CAACf,EAAE,CAAC,CAAC;IAClDmD,IAAI,CAACjE,KAAK,CAACI,QAAQ,GAAG,UAAU;IAChC,IAAId,IAAI,KAAK,MAAM,EAAE;MACjB2E,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,OAAO,CAAC;MACpDuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,iBAAiB,EAAE,OAAO,CAAC;MACrDuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,WAAW,EAAE,SAAS,CAAC;IACrD;IACA,OAAOuC,IAAI;EACf,CAAC;EAED;EACAyF,MAAM,EAAE,SAAAA,CAAUC,KAAK,EAAE;IACrB,IAAI7K,IAAI,CAACwD,MAAM,CAACqH,KAAK,CAAC,IAAI7K,IAAI,CAACwD,MAAM,CAACqH,KAAK,CAACnF,UAAU,CAAC,EAAE;MACrDmF,KAAK,CAACnF,UAAU,CAACoF,WAAW,CAACD,KAAK,CAAC;IACvC;EACJ,CAAC;EAED;EACAE,QAAQ,EAAE,SAAAA,CAAU1G,EAAE,EAAEsG,KAAK,EAAE;IAC3B,IAAI,CAAC3K,IAAI,CAACwD,MAAM,CAACmH,KAAK,CAAC,EAAE;MACrBA,KAAK,GAAG,CAAC;IACb,CAAC,MAAM,IAAIA,KAAK,IAAI9K,OAAO,CAACgE,KAAK,CAACC,SAAS,EAAE;MACzC6G,KAAK,GAAG9K,OAAO,CAACgE,KAAK,CAACC,SAAS,GAAG,CAAC;IACvC;IAEA,IAAI,CAACD,KAAK,CAAC8G,KAAK,CAAC,CAAC9I,WAAW,CAACwC,EAAE,CAACoB,QAAQ,CAAC;EAC9C,CAAC;EAED;EACAuF,UAAU,EAAE,SAAAA,CAAU3G,EAAE,EAAE4G,CAAC,EAAE;IACzB,IAAI1G,KAAK;MAAEhB,GAAG;MACV2H,KAAK,GAAGD,CAAC,CAACE,OAAO;MACjBC,KAAK,GAAGH,CAAC,CAACI,MAAM;IAEpB,IAAI,IAAI,CAAC5K,IAAI,IAAI4D,EAAE,CAACiH,WAAW,CAACC,OAAO,KAAKL,KAAK,IAAIE,KAAK,CAAC,EAAE;MACzD/G,EAAE,CAACoB,QAAQ,CAACC,UAAU,CAACC,YAAY,CAACtB,EAAE,CAACoB,QAAQ,EAAEpB,EAAE,CAACoB,QAAQ,CAAC;MAC7D;IACJ;;IAEA;IACA;IACA;IACA;IACAlB,KAAK,GAAGF,EAAE,CAACmH,qBAAqB;IAChC,IAAIN,KAAK,EAAE;MACP3H,GAAG,GAAG,IAAI,CAACD,KAAK,CAAC,IAAI,CAACjD,SAAS,CAAC2B,EAAE,EAAE,GAAG,EAAEqC,EAAE,CAACrC,EAAE,EAAE,eAAe,EAAEiJ,CAAC,CAACQ,SAAS,CAAC;MAC7E,IAAI,CAACzL,IAAI,CAACwD,MAAM,CAACe,KAAK,CAAC,IAAIA,KAAK,CAACvC,EAAE,KAAKuB,GAAG,EAAE;QACzCgB,KAAK,GAAG,IAAI,CAAClE,SAAS,CAACkB,aAAa,CAACmK,cAAc,CAACnI,GAAG,CAAC;QACxD;QACA;QACA,IAAIgB,KAAK,KAAK,IAAI,EAAE;UAChBA,KAAK,GAAG,IAAI,CAACH,gBAAgB,CAACC,EAAE,EAAE,OAAO,EAAE4G,CAAC,CAACQ,SAAS,CAAC;UACvD,IAAI,CAAC3J,IAAI,CAACD,WAAW,CAAC0C,KAAK,CAAC;QAChC;QACAF,EAAE,CAACmH,qBAAqB,GAAGjH,KAAK;QAChCF,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE,IAAI,CAACe,KAAK,CAACJ,GAAG,CAAC,CAAC;MACrE;IACJ,CAAC,MAAM,IAAIvD,IAAI,CAACwD,MAAM,CAACe,KAAK,CAAC,EAAE;MAC3B,IAAI,CAACqG,MAAM,CAACrG,KAAK,CAAC;IACtB;IAEAA,KAAK,GAAGF,EAAE,CAACsH,mBAAmB;IAC9B,IAAIP,KAAK,EAAE;MACP7H,GAAG,GAAG,IAAI,CAACD,KAAK,CAAC,IAAI,CAACjD,SAAS,CAAC2B,EAAE,EAAE,GAAG,EAAEqC,EAAE,CAACrC,EAAE,EAAE,aAAa,EAAEiJ,CAAC,CAACW,QAAQ,CAAC;MAC1E,IAAI,CAAC5L,IAAI,CAACwD,MAAM,CAACe,KAAK,CAAC,IAAIA,KAAK,CAACvC,EAAE,KAAKuB,GAAG,EAAE;QACzCgB,KAAK,GAAG,IAAI,CAAClE,SAAS,CAACkB,aAAa,CAACmK,cAAc,CAACnI,GAAG,CAAC;QACxD;QACA;QACA,IAAIgB,KAAK,KAAK,IAAI,EAAE;UAChBA,KAAK,GAAG,IAAI,CAACH,gBAAgB,CAACC,EAAE,EAAE,KAAK,EAAE4G,CAAC,CAACW,QAAQ,CAAC;UACpD,IAAI,CAAC9J,IAAI,CAACD,WAAW,CAAC0C,KAAK,CAAC;QAChC;QACAF,EAAE,CAACsH,mBAAmB,GAAGpH,KAAK;QAC9BF,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,YAAY,EAAE,IAAI,CAACe,KAAK,CAACJ,GAAG,CAAC,CAAC;MACnE;IACJ,CAAC,MAAM,IAAIvD,IAAI,CAACwD,MAAM,CAACe,KAAK,CAAC,EAAE;MAC3B,IAAI,CAACqG,MAAM,CAACrG,KAAK,CAAC;IACtB;EACJ,CAAC;EAED;EACAsH,iBAAiB,EAAE,SAAAA,CAAU1G,IAAI,EAAEiB,CAAC,EAAEC,CAAC,EAAEyF,EAAE,EAAEC,EAAE,EAAE;IAC7C,IAAIC,IAAI,GAAG,OAAO;IAElBA,IAAI,GAAG,MAAM,CAAC,CAAC;IACf;IACA;IACA5F,CAAC,GAAG6F,IAAI,CAACC,GAAG,CAAC9F,CAAC,CAAC,GAAG4F,IAAI,GAAG5F,CAAC,GAAI4F,IAAI,GAAG5F,CAAC,GAAI6F,IAAI,CAACC,GAAG,CAAC9F,CAAC,CAAC;IACrDC,CAAC,GAAG4F,IAAI,CAACC,GAAG,CAAC7F,CAAC,CAAC,GAAG2F,IAAI,GAAG3F,CAAC,GAAI2F,IAAI,GAAG3F,CAAC,GAAI4F,IAAI,CAACC,GAAG,CAAC7F,CAAC,CAAC;IACrDyF,EAAE,GAAGG,IAAI,CAACC,GAAG,CAACJ,EAAE,CAAC,GAAGE,IAAI,GAAGF,EAAE,GAAIE,IAAI,GAAGF,EAAE,GAAIG,IAAI,CAACC,GAAG,CAACJ,EAAE,CAAC;IAC1DC,EAAE,GAAGE,IAAI,CAACC,GAAG,CAACH,EAAE,CAAC,GAAGC,IAAI,GAAGD,EAAE,GAAIC,IAAI,GAAGD,EAAE,GAAIE,IAAI,CAACC,GAAG,CAACH,EAAE,CAAC;IAE1D5G,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEwD,CAAC,CAAC;IAClCjB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEyD,CAAC,CAAC;IAClClB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEqJ,IAAI,CAACC,GAAG,CAACJ,EAAE,CAAC,CAAC;IAC7C3G,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEqJ,IAAI,CAACC,GAAG,CAACH,EAAE,CAAC,CAAC;EACjD,CAAC;EAED;EACAI,cAAc,EAAE,SAAAA,CAAUhH,IAAI,EAAEiH,GAAG,EAAEC,GAAG,EAAEC,GAAG,EAAEC,GAAG,EAAE;IAChD,IAAIP,IAAI,GAAG,OAAO;IAElBA,IAAI,GAAG,MAAM,CAAC,CAAC;IACf,IAAI,CAAC/D,KAAK,CAACmE,GAAG,GAAGC,GAAG,GAAGC,GAAG,GAAGC,GAAG,CAAC,EAAE;MAC/B;MACA;MACAH,GAAG,GAAGH,IAAI,CAACC,GAAG,CAACE,GAAG,CAAC,GAAGJ,IAAI,GAAGI,GAAG,GAAIJ,IAAI,GAAGI,GAAG,GAAIH,IAAI,CAACC,GAAG,CAACE,GAAG,CAAC;MAC/DC,GAAG,GAAGJ,IAAI,CAACC,GAAG,CAACG,GAAG,CAAC,GAAGL,IAAI,GAAGK,GAAG,GAAIL,IAAI,GAAGK,GAAG,GAAIJ,IAAI,CAACC,GAAG,CAACG,GAAG,CAAC;MAC/DC,GAAG,GAAGL,IAAI,CAACC,GAAG,CAACI,GAAG,CAAC,GAAGN,IAAI,GAAGM,GAAG,GAAIN,IAAI,GAAGM,GAAG,GAAIL,IAAI,CAACC,GAAG,CAACI,GAAG,CAAC;MAC/DC,GAAG,GAAGN,IAAI,CAACC,GAAG,CAACK,GAAG,CAAC,GAAGP,IAAI,GAAGO,GAAG,GAAIP,IAAI,GAAGO,GAAG,GAAIN,IAAI,CAACC,GAAG,CAACK,GAAG,CAAC;MAE/DpH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEwJ,GAAG,CAAC;MACpCjH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEyJ,GAAG,CAAC;MACpClH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE0J,GAAG,CAAC;MACpCnH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE2J,GAAG,CAAC;IACxC;EACJ,CAAC;EAED;EACA1F,cAAc,EAAE,SAAAA,CAAU1B,IAAI,EAAEqH,WAAW,EAAE;IACzC,IAAIA,WAAW,KAAK,EAAE,EAAE;MACpBA,WAAW,GAAG,OAAO;IACzB;IACArH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE4J,WAAW,CAAC;EAC/C,CAAC;EAED;EACAC,qBAAqB,EAAE,SAAAA,CAAUpI,EAAE,EAAEwB,IAAI,EAAErF,IAAI,EAAE;IAC7C,IAAIsF,CAAC,GAAG,EAAE;MACN4G,GAAG,GAAGrI,EAAE,CAAC6D,MAAM,CAACC,SAAS;MACzBwE,MAAM,GAAG9G,IAAI,GAAGoG,IAAI,CAACW,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG;MAClCC,GAAG,GAAGhH,IAAI,GAAG,GAAG;IAEpB,IAAIrF,IAAI,KAAK,GAAG,EAAE;MACdsF,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,IACF6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,IACF6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,IACF6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,IACF6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC;IACvB,CAAC,MAAM,IAAIrF,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,IACJA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,GACLA,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,GACL6G,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC;IACvB,CAAC,MAAM,IAAIrF,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,GACL4G,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,GACL6G,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC;IACvB,CAAC,MAAM,IAAIrF,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,IACJA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC;IACd,CAAC,MAAM,IAAIlM,IAAI,KAAK,IAAI,IAAIA,IAAI,KAAK,MAAM,EAAE;MACzC,IAAIA,IAAI,KAAK,MAAM,EAAE;QACjBqF,IAAI,IAAI,IAAI;MAChB;MACAC,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,GACLA,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,GACLA,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK;IACT,CAAC,MAAM,IAAIrF,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACD,KAAK,GACL4G,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,GAAG,IACFD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,KAAK,IACJH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,GAAG,IACFD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,KAAK,CAAC,CAAC;IACf,CAAC,MAAM,IAAIrM,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,GACL4G,GAAG,CAAC,CAAC,CAAC,GACN,GAAG,IACFA,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,KAAK,IACJ6G,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,GAAG,IACFD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,KAAK,IACJH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,GAAG,IACFD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,KAAK;IACb,CAAC,MAAM,IAAIrM,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,IACJA,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,GAAG,IACFH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,KAAK,IACJD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,GAAG,IACFH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,KAAK;IACb,CAAC,MAAM,IAAInM,IAAI,KAAK,GAAG,EAAE;MACrBsF,CAAC,GACG,KAAK,IACJ4G,GAAG,CAAC,CAAC,CAAC,GAAG7G,IAAI,CAAC,GACf,GAAG,GACH6G,GAAG,CAAC,CAAC,CAAC,GACN,KAAK,IACJA,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,GAAG,IACFH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,KAAK,IACJD,GAAG,CAAC,CAAC,CAAC,GAAGG,GAAG,CAAC,GACd,GAAG,IACFH,GAAG,CAAC,CAAC,CAAC,GAAGC,MAAM,CAAC,GACjB,KAAK;IACb;IACA,OAAO7G,CAAC;EACZ,CAAC;EAED;EACAgH,oBAAoB,EAAE,SAAAA,CAAUzI,EAAE,EAAE;IAChC,IAAI9D,CAAC;MACDmM,GAAG;MACHnG,GAAG;MACHwG,KAAK,GAAG,KAAK;MACbC,KAAK,GAAG,KAAK;MACbC,KAAK,GAAG,KAAK;MACbC,QAAQ,GAAGH,KAAK;MAChBI,OAAO,GAAG,MAAM;MAChBC,IAAI,GAAG,EAAE;IAEb,IAAI/I,EAAE,CAACgJ,YAAY,IAAI,CAAC,EAAE;MACtB,OAAO,EAAE;IACb;IAEA9G,GAAG,GAAG0F,IAAI,CAACqB,GAAG,CAACjJ,EAAE,CAACkJ,MAAM,CAACzK,MAAM,EAAEuB,EAAE,CAACgJ,YAAY,CAAC;IAEjD,IAAIhJ,EAAE,CAACmJ,YAAY,KAAK,CAAC,EAAE;MACvB,KAAKjN,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;QACtBmM,GAAG,GAAGrI,EAAE,CAACkJ,MAAM,CAAChN,CAAC,CAAC,CAAC4H,SAAS;QAC5B,IAAIF,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIzE,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;UAChC;UACAQ,QAAQ,GAAGH,KAAK;QACpB,CAAC,MAAM;UACH;UACAL,GAAG,CAAC,CAAC,CAAC,GAAGT,IAAI,CAACwB,GAAG,CAACxB,IAAI,CAACqB,GAAG,CAACZ,GAAG,CAAC,CAAC,CAAC,EAAES,OAAO,CAAC,EAAE,CAACA,OAAO,CAAC;UACtDT,GAAG,CAAC,CAAC,CAAC,GAAGT,IAAI,CAACwB,GAAG,CAACxB,IAAI,CAACqB,GAAG,CAACZ,GAAG,CAAC,CAAC,CAAC,EAAES,OAAO,CAAC,EAAE,CAACA,OAAO,CAAC;;UAEtD;UACA;UACAC,IAAI,IAAIF,QAAQ,GAAGR,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;UAC1CQ,QAAQ,GAAGF,KAAK;QACpB;MACJ;IACJ,CAAC,MAAM,IAAI3I,EAAE,CAACmJ,YAAY,KAAK,CAAC,EAAE;MAC9BjN,CAAC,GAAG,CAAC;MACL,OAAOA,CAAC,GAAGgG,GAAG,EAAE;QACZmG,GAAG,GAAGrI,EAAE,CAACkJ,MAAM,CAAChN,CAAC,CAAC,CAAC4H,SAAS;QAC5B,IAAIF,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIzE,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;UAChC;UACAQ,QAAQ,GAAGH,KAAK;QACpB,CAAC,MAAM;UACHK,IAAI,IAAIF,QAAQ,GAAGR,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,GAAG,CAAC,CAAC,CAAC;UACxC,IAAIQ,QAAQ,KAAKD,KAAK,EAAE;YACpB1M,CAAC,IAAI,CAAC;YACNmM,GAAG,GAAGrI,EAAE,CAACkJ,MAAM,CAAChN,CAAC,CAAC,CAAC4H,SAAS;YAC5BiF,IAAI,IAAI,GAAG,GAAGV,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,GAAG,CAAC,CAAC,CAAC;YACnCnM,CAAC,IAAI,CAAC;YACNmM,GAAG,GAAGrI,EAAE,CAACkJ,MAAM,CAAChN,CAAC,CAAC,CAAC4H,SAAS;YAC5BiF,IAAI,IAAI,GAAG,GAAGV,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,GAAG,CAAC,CAAC,CAAC;UACvC;UACAQ,QAAQ,GAAGD,KAAK;QACpB;QACA1M,CAAC,IAAI,CAAC;MACV;IACJ;IACA,OAAO6M,IAAI;EACf,CAAC;EAED;EACAM,0BAA0B,EAAE,SAAAA,CAAUrJ,EAAE,EAAE;IACtC,IAAI9D,CAAC;MACD2F,CAAC;MACDyH,CAAC;MACDjB,GAAG;MACHkB,EAAE;MACFC,EAAE;MACFtH,GAAG;MACHwG,KAAK,GAAG,KAAK;MACbC,KAAK,GAAG,KAAK;MACbE,QAAQ,GAAGH,KAAK;MAChBI,OAAO,GAAG,MAAM;MAChBC,IAAI,GAAG,EAAE;MACTU,CAAC,GAAG9N,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC+B,WAAW,CAAC;MACzCmH,QAAQ,GAAG/N,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACmJ,SAAS,CAAC,KAAK,MAAM;IAE7D,IAAI3J,EAAE,CAACgJ,YAAY,IAAI,CAAC,EAAE;MACtB,OAAO,EAAE;IACb;IAEA,IAAIU,QAAQ,IAAI1J,EAAE,CAACyC,KAAK,CAACmH,OAAO,CAACC,KAAK,CAACC,YAAY,EAAE;MACjD9J,EAAE,CAACkJ,MAAM,GAAGpN,QAAQ,CAACiO,mBAAmB,CAAC/J,EAAE,CAACkJ,MAAM,EAAE,GAAG,CAAC;IAC5D;IAEAhH,GAAG,GAAG0F,IAAI,CAACqB,GAAG,CAACjJ,EAAE,CAACkJ,MAAM,CAACzK,MAAM,EAAEuB,EAAE,CAACgJ,YAAY,CAAC;IACjD,KAAKnH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;MACpBgH,QAAQ,GAAGH,KAAK;MAChB,KAAKxM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;QACtBmM,GAAG,GAAGrI,EAAE,CAACkJ,MAAM,CAAChN,CAAC,CAAC,CAAC4H,SAAS;QAE5B,IAAIF,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIzE,KAAK,CAACyE,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;UAChC;UACAQ,QAAQ,GAAGH,KAAK;QACpB,CAAC,MAAM;UACH;UACAL,GAAG,CAAC,CAAC,CAAC,GAAGT,IAAI,CAACwB,GAAG,CAACxB,IAAI,CAACqB,GAAG,CAACZ,GAAG,CAAC,CAAC,CAAC,EAAES,OAAO,CAAC,EAAE,CAACA,OAAO,CAAC;UACtDT,GAAG,CAAC,CAAC,CAAC,GAAGT,IAAI,CAACwB,GAAG,CAACxB,IAAI,CAACqB,GAAG,CAACZ,GAAG,CAAC,CAAC,CAAC,EAAES,OAAO,CAAC,EAAE,CAACA,OAAO,CAAC;;UAEtD;UACA,IAAID,QAAQ,KAAKH,KAAK,EAAE;YACpB;YACAK,IAAI,IAAIF,QAAQ,GAAGR,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;UAC9C,CAAC,MAAM;YACHiB,CAAC,GAAG,CAAC,GAAGzH,CAAC;YACTkH,IAAI,IAAI,CACJF,QAAQ,EACRU,EAAE,GAAG,CAAClB,GAAG,CAAC,CAAC,CAAC,GAAGkB,EAAE,IAAI,KAAK,GAAGE,CAAC,IAAIH,CAAC,GAAG1B,IAAI,CAACoC,MAAM,CAAC,CAAC,GAAGnI,CAAC,CAAC,EACxD,GAAG,EACH2H,EAAE,GAAG,CAACnB,GAAG,CAAC,CAAC,CAAC,GAAGmB,EAAE,IAAI,KAAK,GAAGC,CAAC,IAAIH,CAAC,GAAG1B,IAAI,CAACoC,MAAM,CAAC,CAAC,GAAGnI,CAAC,CAAC,EACxD,GAAG,EACH0H,EAAE,GAAG,CAAClB,GAAG,CAAC,CAAC,CAAC,GAAGkB,EAAE,IAAI,KAAK,GAAGE,CAAC,IAAIH,CAAC,GAAG1B,IAAI,CAACoC,MAAM,CAAC,CAAC,GAAGnI,CAAC,CAAC,EACxD,GAAG,EACH2H,EAAE,GAAG,CAACnB,GAAG,CAAC,CAAC,CAAC,GAAGmB,EAAE,IAAI,KAAK,GAAGC,CAAC,IAAIH,CAAC,GAAG1B,IAAI,CAACoC,MAAM,CAAC,CAAC,GAAGnI,CAAC,CAAC,EACxD,GAAG,EACHwG,GAAG,CAAC,CAAC,CAAC,EACN,GAAG,EACHA,GAAG,CAAC,CAAC,CAAC,CACT,CAACrJ,IAAI,CAAC,EAAE,CAAC;UACd;UAEA6J,QAAQ,GAAGF,KAAK;UAChBY,EAAE,GAAGlB,GAAG,CAAC,CAAC,CAAC;UACXmB,EAAE,GAAGnB,GAAG,CAAC,CAAC,CAAC;QACf;MACJ;IACJ;IACA,OAAOU,IAAI;EACf,CAAC;EAED;EACAkB,iBAAiB,EAAE,SAAAA,CAAUnJ,IAAI,EAAEd,EAAE,EAAE;IACnC,IAAI9D,CAAC;MACD6M,IAAI,GAAG,EAAE;MACTjF,SAAS;MACT5B,GAAG,GAAGlC,EAAE,CAACkK,QAAQ,CAACzL,MAAM;IAE5BqC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,CAAC;IAC3CuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,WAAW,EAAE,SAAS,CAAC;IACjD,IAAIyB,EAAE,CAACmK,MAAM,KAAK,gBAAgB,EAAE;MAChCjI,GAAG,EAAE;IACT;IAEA,KAAKhG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,GAAG,CAAC,EAAEhG,CAAC,EAAE,EAAE;MAC1B,IAAI8D,EAAE,CAACkK,QAAQ,CAAChO,CAAC,CAAC,CAACkG,MAAM,EAAE;QACvB0B,SAAS,GAAG9D,EAAE,CAACkK,QAAQ,CAAChO,CAAC,CAAC,CAAC2H,MAAM,CAACC,SAAS;QAC3CiF,IAAI,GAAGA,IAAI,GAAGjF,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,SAAS,CAAC,CAAC,CAAC;MACnD,CAAC,MAAM;QACHhD,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,EAAE,CAAC;QACvC;MACJ;MAEA,IAAIrC,CAAC,GAAGgG,GAAG,GAAG,CAAC,EAAE;QACb6G,IAAI,IAAI,GAAG;MACf;IACJ;IACA,IAAIA,IAAI,CAACxM,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;MAC5BuE,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAEwK,IAAI,CAAC;IAC7C;EACJ,CAAC;EAED;EACA9C,cAAc,EAAE,SAAAA,CAAUnF,IAAI,EAAEiB,CAAC,EAAEC,CAAC,EAAEoI,CAAC,EAAE/J,CAAC,EAAE;IACxCS,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAEwD,CAAC,CAAC;IACjCjB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAEyD,CAAC,CAAC;IACjClB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE6L,CAAC,CAAC;IACrCtJ,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE8B,CAAC,CAAC;EAC1C,CAAC;EAED;AACR;AACA;;EAEQ;EACAgK,eAAe,EAAE,SAAAA,CAAUvJ,IAAI,EAAEwJ,GAAG,EAAEC,GAAG,EAAE;IACvC,IAAID,GAAG,KAAK,SAAS,EAAE;MACnB;IACJ;IACAxJ,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE+L,GAAG,EAAEC,GAAG,CAAC;EACvC,CAAC;EAEDnN,OAAO,EAAE,SAAAA,CAAU4C,EAAE,EAAEuK,GAAG,EAAE;IACxB,IAAIzJ,IAAI;IAER,IAAId,EAAE,IAAIA,EAAE,CAACoB,QAAQ,EAAE;MACnBpB,EAAE,CAACkB,UAAU,CAACgG,OAAO,GAAGqD,GAAG;MAC3BzJ,IAAI,GAAGd,EAAE,CAACoB,QAAQ;MAClB,IAAImJ,GAAG,EAAE;QACLzJ,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC;QAC9CuC,IAAI,CAACjE,KAAK,CAAC2N,UAAU,GAAG,SAAS;MACrC,CAAC,MAAM;QACH1J,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;QAC5CuC,IAAI,CAACjE,KAAK,CAAC2N,UAAU,GAAG,QAAQ;MACpC;IACJ;EACJ,CAAC;EAED;EACAC,IAAI,EAAE,SAAAA,CAAUzK,EAAE,EAAE;IAChBzE,GAAG,CAACmP,UAAU,CAAC,uBAAuB,EAAE,0BAA0B,CAAC;IACnE,IAAI,CAACtN,OAAO,CAAC4C,EAAE,EAAE,IAAI,CAAC;IACtB;IACA;IACA;IACA;IACA;IACA;IACA;EACJ,CAAC;EAED;EACA2K,IAAI,EAAE,SAAAA,CAAU3K,EAAE,EAAE;IAChBzE,GAAG,CAACmP,UAAU,CAAC,uBAAuB,EAAE,0BAA0B,CAAC;IACnE,IAAI,CAACtN,OAAO,CAAC4C,EAAE,EAAE,KAAK,CAAC;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;EACJ,CAAC;EAED;EACA4K,YAAY,EAAE,SAAAA,CAAU5K,EAAE,EAAE7D,IAAI,EAAE;IAC9B6D,EAAE,CAACoB,QAAQ,CAACzB,YAAY,CAAC,oBAAoB,EAAExD,IAAI,CAAC;EACxD,CAAC;EAED;EACA0O,YAAY,EAAE,SAAAA,CAAU7K,EAAE,EAAE;IACxB,IAAI8K,SAAS,GAAGnP,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC6F,IAAI,CAAC;MAC1C0E,EAAE,GAAGpP,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACwK,SAAS,CAAC;MACxCC,EAAE,GAAGF,EAAE,GAAG,GAAG,GAAGpP,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC+B,WAAW,CAAC,GAAG,CAAC;MACzDzB,IAAI,GAAGd,EAAE,CAACoB,QAAQ;IAEtB,IAAI0J,SAAS,GAAG,CAAC,EAAE;MACfhK,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,kBAAkB;MACxC;MACA;MACA,IAAI,CAAC2M,SAAS,CAACJ,SAAS,GAAG,CAAC,CAAC,CAACK,GAAG,CAAC,UAAUpJ,CAAC,EAAE;QAAE,OAAOA,CAAC,GAAGkJ,EAAE;MAAE,CAAC,CAAC,CAACjM,IAAI,CAAC,GAAG,CAC/E,CAAC;IACL,CAAC,MAAM;MACH,IAAI8B,IAAI,CAACsK,cAAc,CAAC,IAAI,EAAE,kBAAkB,CAAC,EAAE;QAC/CtK,IAAI,CAACuK,iBAAiB,CAAC,IAAI,EAAE,kBAAkB,CAAC;MACpD;IACJ;EACJ,CAAC;EAED;EACAC,WAAW,EAAE,SAAAA,CAAUtL,EAAE,EAAE;IACvB,IAAIuL,QAAQ,GAAGvL,EAAE,CAACoB,QAAQ;MACtBN,IAAI;MAAEZ,KAAK;MAAEC,KAAK;MAClBqL,IAAI,GAAG7P,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACiL,QAAQ,CAAC;IAE7C,IAAID,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,QAAQ,EAAE;MACxC1K,IAAI,GAAG,IAAI,CAACR,UAAU,CAACkL,IAAI,GAAG,UAAU,EAAExL,EAAE,CAACrC,EAAE,GAAG,WAAW,CAAC;MAC9DuC,KAAK,GAAG,IAAI,CAACI,UAAU,CAAC,MAAM,EAAEN,EAAE,CAACrC,EAAE,GAAG,YAAY,CAAC;MACrDwC,KAAK,GAAG,IAAI,CAACG,UAAU,CAAC,MAAM,EAAEN,EAAE,CAACrC,EAAE,GAAG,YAAY,CAAC;MACrDmD,IAAI,CAACtD,WAAW,CAAC0C,KAAK,CAAC;MACvBY,IAAI,CAACtD,WAAW,CAAC2C,KAAK,CAAC;MACvB,IAAI,CAAC1C,IAAI,CAACD,WAAW,CAACsD,IAAI,CAAC;MAC3ByK,QAAQ,CAAChN,cAAc,CACnB,IAAI,EACJ,OAAO;MACP;MACA,OAAO,GAAG,IAAI,CAACe,KAAK,CAAC,IAAI,CAACtD,SAAS,CAAC2B,EAAE,GAAG,GAAG,GAAGqC,EAAE,CAACrC,EAAE,GAAG,WAAW,CACtE,CAAC;MACDqC,EAAE,CAAC0L,SAAS,GAAGxL,KAAK;MACpBF,EAAE,CAAC2L,SAAS,GAAGxL,KAAK;MACpBH,EAAE,CAAC4L,QAAQ,GAAG9K,IAAI;IACtB,CAAC,MAAM;MACHyK,QAAQ,CAACF,iBAAiB,CAAC,IAAI,EAAE,OAAO,CAAC;IAC7C;EACJ,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;EACQQ,mBAAmB,EAAE,SAAAA,CAAU/K,IAAI,EAAEgL,OAAO,EAAE;IAC1C;IACA;IACA;IACA;IACA;IACA,IAAIrC,CAAC,GAAG,GAAG;MACPsC,EAAE,GAAGnE,IAAI,CAACoE,GAAG,CAACF,OAAO,CAAC;MACtBG,EAAE,GAAGrE,IAAI,CAACsE,GAAG,CAACJ,OAAO,CAAC;IAE1B,IAAIlE,IAAI,CAACC,GAAG,CAACkE,EAAE,CAAC,GAAGnE,IAAI,CAACC,GAAG,CAACoE,EAAE,CAAC,EAAE;MAC7BxC,CAAC,IAAI7B,IAAI,CAACC,GAAG,CAACkE,EAAE,CAAC;IACrB,CAAC,MAAM;MACHtC,CAAC,IAAI7B,IAAI,CAACC,GAAG,CAACoE,EAAE,CAAC;IACrB;IAEA,IAAIF,EAAE,IAAI,CAAC,EAAE;MACTjL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;MAClCuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEwN,EAAE,GAAGtC,CAAC,CAAC;IAC3C,CAAC,MAAM;MACH3I,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAACwN,EAAE,GAAGtC,CAAC,CAAC;MACxC3I,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;IACtC;IACA,IAAI0N,EAAE,IAAI,CAAC,EAAE;MACTnL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;MAClCuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE0N,EAAE,GAAGxC,CAAC,CAAC;IAC3C,CAAC,MAAM;MACH3I,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC0N,EAAE,GAAGxC,CAAC,CAAC;MACxC3I,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;IACtC;EACJ,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQ4N,oBAAoB,EAAE,SAAAA,CAAUrL,IAAI,EAAEgE,EAAE,EAAEC,EAAE,EAAEqH,CAAC,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE;IACzDzL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEuG,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC;IACjDhE,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEwG,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC;IAC/CjE,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE6N,CAAC,GAAG,GAAG,GAAG,GAAG,CAAC;IAC7CtL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE8N,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC;IACjDvL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE+N,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC;IAC/CxL,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,IAAI,EAAEgO,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC;EACnD,CAAC;EAED;EACAC,cAAc,EAAE,SAAAA,CAAUxM,EAAE,EAAE;IAC1B,IAAIyM,GAAG;MACHC,EAAE;MACFxM,KAAK,GAAGF,EAAE,CAAC0L,SAAS;MACpBvL,KAAK,GAAGH,EAAE,CAAC2L,SAAS;MACpBH,IAAI,GAAG7P,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACiL,QAAQ,CAAC;IAE7C,IAAI,CAAC9P,IAAI,CAACwD,MAAM,CAACe,KAAK,CAAC,IAAI,CAACvE,IAAI,CAACwD,MAAM,CAACgB,KAAK,CAAC,EAAE;MAC5C;IACJ;IAEAuM,EAAE,GAAG/Q,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACmM,WAAW,CAAC;IAC1CD,EAAE,GAAGA,EAAE,GAAG,CAAC,GAAGA,EAAE,GAAG,CAAC;IACpBD,GAAG,GAAG9Q,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACW,SAAS,CAAC;IAEzCjB,KAAK,CAAC3B,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE,aAAa,GAAGkO,GAAG,GAAG,gBAAgB,GAAGC,EAAE,CAAC;IAChFvM,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,OAAO,EACP,aAAa,GACb5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACoM,mBAAmB,CAAC,GAC7C,gBAAgB,GAChBjR,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACqM,qBAAqB,CAClD,CAAC;IACD3M,KAAK,CAAC3B,cAAc,CAChB,IAAI,EACJ,QAAQ,EACR5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACsM,mBAAmB,CAAC,GAAG,GAAG,GAAG,GAC1D,CAAC;IACD3M,KAAK,CAAC5B,cAAc,CAChB,IAAI,EACJ,QAAQ,EACR5C,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACuM,iBAAiB,CAAC,GAAG,GAAG,GAAG,GACxD,CAAC;IACD,IAAIvB,IAAI,KAAK,QAAQ,EAAE;MACnB,IAAI,CAACK,mBAAmB,CAAC7L,EAAE,CAAC4L,QAAQ,EAAEjQ,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACwM,aAAa,CAAC,CAAC;IAClF,CAAC,MAAM,IAAIxB,IAAI,KAAK,QAAQ,EAAE;MAC1B,IAAI,CAACW,oBAAoB,CACrBnM,EAAE,CAAC4L,QAAQ,EACXjQ,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACyM,UAAU,CAAC,EACpCtR,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC0M,UAAU,CAAC,EACpCvR,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC2M,SAAS,CAAC,EACnCxR,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC4M,UAAU,CAAC,EACpCzR,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC6M,UAAU,CAAC,EACpC1R,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC8M,UAAU,CACvC,CAAC;IACL;EACJ,CAAC;EAED;EACAC,mBAAmB,EAAE,SAAAA,CAAUvN,EAAE,EAAEyE,QAAQ,EAAE;IACzC,IAAI3D,IAAI;MAAE0M,KAAK;MACXC,aAAa,GAAG,EAAE;MAClBC,aAAa;MACbxR,CAAC;MACDgG,GAAG,GAAG,CAAC;MACPyL,KAAK,GAAG,CAAC,UAAU,EAAE,uBAAuB,EAAE,qBAAqB,CAAC;IAExE,IAAIlJ,QAAQ,KAAKmJ,SAAS,EAAE;MACxBnJ,QAAQ,GAAG9I,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACqN,kBAAkB,CAAC;IAC3D;IAEAL,KAAK,GAAG7R,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACsN,oBAAoB,CAAC;IACtD,IAAIrJ,QAAQ,KAAKzE,EAAE,CAACkB,UAAU,CAAC2M,kBAAkB,IAC7CL,KAAK,KAAKxN,EAAE,CAACkB,UAAU,CAAC4M,oBAAoB,EAAE;MAC9C;IACJ;;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA,IAAInS,IAAI,CAACwD,MAAM,CAACqO,KAAK,CAAC,EAAE;MACpBtL,GAAG,GAAGsL,KAAK,CAAC/O,MAAM;IACtB;IACA,KAAKvC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;MACtBuR,aAAa,CAACM,IAAI,CAACP,KAAK,CAACtR,CAAC,CAAC,GAAG,GAAG,GAAGuI,QAAQ,GAAG,IAAI,CAAC;IACxD;IACAiJ,aAAa,GAAGD,aAAa,CAACzO,IAAI,CAAC,IAAI,CAAC;IAExCkD,GAAG,GAAGyL,KAAK,CAAClP,MAAM;IAClB,KAAKvC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAE,EAAEhG,CAAC,EAAE;MACtB,IAAI8D,EAAE,CAAC2N,KAAK,CAACzR,CAAC,CAAC,CAAC,EAAE;QACd4E,IAAI,GAAGd,EAAE,CAAC2N,KAAK,CAACzR,CAAC,CAAC,CAAC;QACnB4E,IAAI,CAACjE,KAAK,CAACmR,UAAU,GAAGN,aAAa;MACzC;IACJ;IAEA1N,EAAE,CAACkB,UAAU,CAAC2M,kBAAkB,GAAGpJ,QAAQ;IAC3CzE,EAAE,CAACkB,UAAU,CAAC4M,oBAAoB,GAAGN,KAAK;EAC9C,CAAC;EAED;EACA9K,iBAAiB,EAAE,SAAAA,CAAS1C,EAAE,EAAEiO,MAAM,EAAE;IACpC,IAAI1D,GAAG,GAAG5O,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC0N,QAAQ,CAAC;MACxCC,EAAE;MAAEjS,CAAC;MACLgG,GAAG,GAAG,CAAC;MACPkM,EAAE;MAAEC,GAAG;MAAEC,CAAC;MAAEzL,CAAC;MAAEuJ,CAAC;MAAEmC,CAAC;MACnBZ,KAAK,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;;IAE1B;IACA,IAAIpD,GAAG,KAAK,SAAS,EAAE;MACnBA,GAAG,GAAG5O,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACyC,KAAK,CAAC+L,IAAI,CAACN,QAAQ,CAAC;IAC/C;;IAEA;IACA,IAAID,MAAM,EAAE;MACRG,EAAE,GAAGpO,EAAE,CAACoB,QAAQ,CAACqN,qBAAqB,CAAC,CAAC;MACxCJ,GAAG,GAAG,IAAI,CAACrS,SAAS,CAACyS,qBAAqB,CAAC,CAAC;MAC5C5L,CAAC,GAAG6L,UAAU,CAACnE,GAAG,CAAC,CAAC,CAAC,CAAC;MACtB6B,CAAC,GAAGsC,UAAU,CAACnE,GAAG,CAAC,CAAC,CAAC,CAAC;MACtBgE,CAAC,GAAGG,UAAU,CAACnE,GAAG,CAAC,CAAC,CAAC,CAAC;MACtB+D,CAAC,GAAGI,UAAU,CAACnE,GAAG,CAAC,CAAC,CAAC,CAAC;MAEtB,IAAI5O,IAAI,CAACqF,QAAQ,CAACuJ,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIA,GAAG,CAAC,CAAC,CAAC,CAAChO,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;QAClDsG,CAAC,GAAIwL,GAAG,CAAC9Q,MAAM,GAAIsF,CAAC,GAAG,GAAG;MAC9B;MACA,IAAIlH,IAAI,CAACqF,QAAQ,CAACuJ,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIA,GAAG,CAAC,CAAC,CAAC,CAAChO,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;QAClD6P,CAAC,GAAIiC,GAAG,CAAC/Q,KAAK,GAAI8O,CAAC,GAAG,GAAG;MAC7B;MACA,IAAIzQ,IAAI,CAACqF,QAAQ,CAACuJ,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIA,GAAG,CAAC,CAAC,CAAC,CAAChO,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;QAClDgS,CAAC,GAAIF,GAAG,CAAC9Q,MAAM,GAAIgR,CAAC,GAAG,GAAG;MAC9B;MACA,IAAI5S,IAAI,CAACqF,QAAQ,CAACuJ,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIA,GAAG,CAAC,CAAC,CAAC,CAAChO,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;QAClD+R,CAAC,GAAID,GAAG,CAAC/Q,KAAK,GAAIgR,CAAC,GAAG,GAAG;MAC7B;MAEAzL,CAAC,GAAG6L,UAAU,CAACL,GAAG,CAACrK,GAAG,CAAC,GAAG0K,UAAU,CAACN,EAAE,CAACpK,GAAG,CAAC,GAAGnB,CAAC;MAChDuJ,CAAC,GAAGsC,UAAU,CAACN,EAAE,CAACO,KAAK,CAAC,GAAGD,UAAU,CAACL,GAAG,CAACM,KAAK,CAAC,GAAGvC,CAAC;MACpDmC,CAAC,GAAGG,UAAU,CAACN,EAAE,CAACQ,MAAM,CAAC,GAAGF,UAAU,CAACL,GAAG,CAACO,MAAM,CAAC,GAAGL,CAAC;MACtDD,CAAC,GAAGI,UAAU,CAACL,GAAG,CAACtK,IAAI,CAAC,GAAG2K,UAAU,CAACN,EAAE,CAACrK,IAAI,CAAC,GAAGuK,CAAC;MAClD/D,GAAG,GAAG,CAAC+D,CAAC,EAAEzL,CAAC,EAAEuJ,CAAC,EAAEmC,CAAC,CAAC;IACtB;IAEAJ,EAAE,GAAG,CACA,OAAO5D,GAAG,CAAC,CAAC,CAAC,KAAK,QAAQ,GAAIA,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,GAAGA,GAAG,CAAC,CAAC,CAAC,EACpD,OAAOA,GAAG,CAAC,CAAC,CAAC,KAAK,QAAQ,GAAIA,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,GAAGA,GAAG,CAAC,CAAC,CAAC,EACpD,OAAOA,GAAG,CAAC,CAAC,CAAC,KAAK,QAAQ,GAAIA,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,GAAGA,GAAG,CAAC,CAAC,CAAC,EACpD,OAAOA,GAAG,CAAC,CAAC,CAAC,KAAK,QAAQ,GAAIA,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,GAAGA,GAAG,CAAC,CAAC,CAAC,CACxD,CAACvL,IAAI,CAAC,GAAG,CAAC;IAEXkD,GAAG,GAAGyL,KAAK,CAAClP,MAAM;IAClB,KAAKvC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAE,EAAEhG,CAAC,EAAE;MACtB,IAAI8D,EAAE,CAAC2N,KAAK,CAACzR,CAAC,CAAC,CAAC,EAAE;QACd,IAAI+R,MAAM,EAAE;UACRjO,EAAE,CAAC2N,KAAK,CAACzR,CAAC,CAAC,CAAC,CAACW,KAAK,CAACgS,QAAQ,GAAG,QAAQ,GAAGV,EAAE,GAAG,GAAG;QACrD,CAAC,MAAM;UACHnO,EAAE,CAAC2N,KAAK,CAACzR,CAAC,CAAC,CAAC,CAACqC,cAAc,CAAC,IAAI,EAAE,WAAW,EAAE,iBAAiB,GAAG4P,EAAE,GAAG,GAAG,CAAC;QAChF;MACJ;IACJ;EACJ,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQlN,aAAa,EAAE,SAAAA,CAAU6N,OAAO,EAAEC,aAAa,EAAE;IAC7C,IAAIA,aAAa,KAAK,EAAE,EAAE;MACtBD,OAAO,CAAC,CAAC;IACb,CAAC,MAAM;MACHE,MAAM,CAACC,UAAU,CAACH,OAAO,EAAE,CAAC,CAAC;IACjC;EACJ,CAAC;EAED;EACApK,kBAAkB,EAAE,SAAAA,CAAU1E,EAAE,EAAEe,KAAK,EAAElD,OAAO,EAAEuD,QAAQ,EAAE;IACxD,IAAIN,IAAI;MAAEgB,CAAC;MAAEoN,IAAI;MAAEC,EAAE;MACjBC,IAAI,GAAGzT,IAAI,CAAC4E,QAAQ,CAACQ,KAAK,CAAC;MAC3BsO,CAAC,GAAG1T,IAAI,CAAC4E,QAAQ,CAAC1C,OAAO,CAAC;MAC1ByR,IAAI,GAAG3T,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACiL,QAAQ,CAAC;IAE7C4D,CAAC,GAAGA,CAAC,GAAG,CAAC,GAAGA,CAAC,GAAG,CAAC;;IAEjB;IACA,IACIrP,EAAE,CAACkB,UAAU,CAACC,SAAS,KAAKiO,IAAI,IAChCpP,EAAE,CAACkB,UAAU,CAACyL,WAAW,KAAK0C,CAAC,IAC/BC,IAAI,KAAK,IAAI,EACf;MACE;IACJ;IAEA,IAAI3T,IAAI,CAACwD,MAAM,CAACiQ,IAAI,CAAC,IAAIA,IAAI,KAAK,KAAK,EAAE;MACrC,IAAIA,IAAI,CAAC3Q,MAAM,KAAK,CAAC,EAAE;QACnB;QACAqD,CAAC,GAAGsN,IAAI;QACRD,EAAE,GAAGE,CAAC;MACV,CAAC,MAAM;QACH;QACAH,IAAI,GAAGtT,KAAK,CAAC2T,SAAS,CAACH,IAAI,CAAC;QAC5BtN,CAAC,GAAGoN,IAAI,CAAC,CAAC,CAAC;QACXC,EAAE,GAAGE,CAAC,GAAGH,IAAI,CAAC,CAAC,CAAC;MACpB;MAEA,IAAI9N,QAAQ,KAAKwM,SAAS,EAAE;QACxB9M,IAAI,GAAGd,EAAE,CAACoB,QAAQ;MACtB,CAAC,MAAM;QACHN,IAAI,GAAGM,QAAQ;MACnB;MAEA,IAAIU,CAAC,KAAK,MAAM,EAAE;QACd,IAAI,CAACb,aAAa,CAAC,YAAY;UAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAEuD,CAAC,CAAC;QACxC,CAAC,EAAE9B,EAAE,CAACkB,UAAU,CAACC,SAAS,CAAC;MAC/B;MAEA,IAAInB,EAAE,CAAC7D,IAAI,KAAKZ,GAAG,CAACiU,iBAAiB,EAAE;QACnC,IAAI,CAACvO,aAAa,CAAC,YAAY;UAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE4Q,EAAE,CAAC;QAC5C,CAAC,EAAEnP,EAAE,CAACkB,UAAU,CAACyL,WAAW,CAAC;QAC7B;MACJ,CAAC,MAAM;QACH,IAAI7K,CAAC,KAAK,MAAM,EAAE;UACd;UACA;UACAqN,EAAE,GAAG,CAAC;UACN;UACArO,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,eAAe,CAAC;QAChE,CAAC,MAAM;UACH;UACAuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,gBAAgB,CAAC;QACjE;QACA,IAAI,CAAC0C,aAAa,CAAC,YAAY;UAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE4Q,EAAE,CAAC;QACjD,CAAC,EAAEnP,EAAE,CAACkB,UAAU,CAACyL,WAAW,CAAC;MACjC;MAEA,IAAI2C,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,QAAQ,EAAE;QACxC,IAAI,CAAC9C,cAAc,CAACxM,EAAE,CAAC;MAC3B;IACJ;IACAA,EAAE,CAACkB,UAAU,CAACC,SAAS,GAAGiO,IAAI;IAC9BpP,EAAE,CAACkB,UAAU,CAACyL,WAAW,GAAG0C,CAAC;EACjC,CAAC;EAED;EACAI,oBAAoB,EAAE,SAAAA,CAAUzP,EAAE,EAAEe,KAAK,EAAElD,OAAO,EAAE;IAChD,IAAIuR,IAAI,GAAGzT,IAAI,CAAC4E,QAAQ,CAACQ,KAAK,CAAC;MAC3Be,CAAC;MAAEoN,IAAI;MACPG,CAAC,GAAG1T,IAAI,CAAC4E,QAAQ,CAAC1C,OAAO,CAAC;MAC1BsR,EAAE;MAAErO,IAAI;IAEZuO,CAAC,GAAGA,CAAC,GAAG,CAAC,GAAGA,CAAC,GAAG,CAAC;IAEjB,IAAIrP,EAAE,CAACkB,UAAU,CAACT,WAAW,KAAK2O,IAAI,IAAIpP,EAAE,CAACkB,UAAU,CAACR,aAAa,KAAK2O,CAAC,EAAE;MACzE;IACJ;IAEA,IAAI1T,IAAI,CAACwD,MAAM,CAACiQ,IAAI,CAAC,IAAIA,IAAI,KAAK,KAAK,EAAE;MACrC,IAAIA,IAAI,CAAC3Q,MAAM,KAAK,CAAC,EAAE;QACnB;QACAqD,CAAC,GAAGsN,IAAI;QACRD,EAAE,GAAGE,CAAC;MACV,CAAC,MAAM;QACH;QACAH,IAAI,GAAGtT,KAAK,CAAC2T,SAAS,CAACH,IAAI,CAAC;QAC5BtN,CAAC,GAAGoN,IAAI,CAAC,CAAC,CAAC;QACXC,EAAE,GAAGE,CAAC,GAAGH,IAAI,CAAC,CAAC,CAAC;MACpB;MAEApO,IAAI,GAAGd,EAAE,CAACoB,QAAQ;MAElB,IAAIpB,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACuJ,iBAAiB,EAAE;QAC7C,IAAItJ,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACpD,OAAO,CAAC,KAAK,MAAM,EAAE;UAC9C,IAAI,CAAC6D,aAAa,CAAC,YAAY;YAC3BH,IAAI,CAACjE,KAAK,CAACkE,KAAK,GAAGe,CAAC;YACpBhB,IAAI,CAACjE,KAAK,CAACgB,OAAO,GAAGsR,EAAE;UAC3B,CAAC,EAAEnP,EAAE,CAACkB,UAAU,CAACT,WAAW,CAAC;QACjC,CAAC,MAAM;UACH,IAAI,CAACQ,aAAa,CAAC,YAAY;YAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE,OAAO,GAAGuD,CAAC,CAAC;YAC/ChB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE,eAAe,GAAG4Q,EAAE,CAAC;UAC5D,CAAC,EAAEnP,EAAE,CAACkB,UAAU,CAACT,WAAW,CAAC;QACjC;MACJ,CAAC,MAAM;QACH,IAAI,CAACQ,aAAa,CAAC,YAAY;UAC3BH,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAEuD,CAAC,CAAC;UACtChB,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE4Q,EAAE,CAAC;QACnD,CAAC,EAAEnP,EAAE,CAACkB,UAAU,CAACT,WAAW,CAAC;MACjC;MAEA,IACIT,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACgU,kBAAkB,IAC5C1P,EAAE,CAACW,YAAY,KAAKjF,KAAK,CAACkF,iBAAiB,EAC7C;QACE,IAAIjF,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACmP,UAAU,CAAC,EAAE;UACtC,IAAI,CAAC9O,cAAc,CACfb,EAAE,CAACmH,qBAAqB,EACxBrF,CAAC,EAAEqN,EAAE,EAAEnP,EAAE,EACTA,EAAE,CAACiH,WAAW,CAACG,SACnB,CAAC;QACL;QAEA,IAAIzL,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACoP,SAAS,CAAC,EAAE;UACrC,IAAI,CAAC/O,cAAc,CACfb,EAAE,CAACsH,mBAAmB,EACtBxF,CAAC,EAAEqN,EAAE,EAAEnP,EAAE,EACTA,EAAE,CAACiH,WAAW,CAACM,QACnB,CAAC;QACL;MACJ;IACJ;IAEAvH,EAAE,CAACkB,UAAU,CAACT,WAAW,GAAG2O,IAAI;IAChCpP,EAAE,CAACkB,UAAU,CAACR,aAAa,GAAG2O,CAAC;EACnC,CAAC;EAED;EACAQ,oBAAoB,EAAE,SAAAA,CAAU7P,EAAE,EAAE1C,KAAK,EAAE;IACvC,IAAIwD,IAAI;MACJsJ,CAAC,GAAGzO,IAAI,CAAC4E,QAAQ,CAACjD,KAAK,CAAC;IAE5B,IAAIsG,KAAK,CAACwG,CAAC,CAAC,IAAIpK,EAAE,CAACkB,UAAU,CAACqB,WAAW,KAAK6H,CAAC,EAAE;MAC7C;IACJ;IAEAtJ,IAAI,GAAGd,EAAE,CAACoB,QAAQ;IAClB,IAAI,CAACiJ,eAAe,CAACvJ,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;IAC7C,IAAInF,IAAI,CAACwD,MAAM,CAACiL,CAAC,CAAC,EAAE;MAChB,IAAI,CAACC,eAAe,CAACvJ,IAAI,EAAE,cAAc,EAAEsJ,CAAC,GAAG,IAAI,CAAC;;MAEpD;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACJ;IACApK,EAAE,CAACkB,UAAU,CAACqB,WAAW,GAAG6H,CAAC;EACjC,CAAC;EAED;EACA0F,UAAU,EAAE,SAAAA,CAAU9P,EAAE,EAAE;IACtB,IAAI+P,QAAQ,GAAGpU,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAACwP,OAAO,CAAC;IAEhD,IACID,QAAQ,KAAKnC,SAAS,IACtBmC,QAAQ,KAAK,EAAE,IACf/P,EAAE,CAACkB,UAAU,CAAC8O,OAAO,KAAKD,QAAQ,IAClC,CAACpU,IAAI,CAACwD,MAAM,CAACa,EAAE,CAACoB,QAAQ,CAAC,EAC3B;MACE;IACJ;IAEA,IAAI,CAACiJ,eAAe,CAACrK,EAAE,CAACoB,QAAQ,EAAE,gBAAgB,EAAE2O,QAAQ,CAAC;IAC7D/P,EAAE,CAACkB,UAAU,CAAC8O,OAAO,GAAGD,QAAQ;EACpC,CAAC;EAED;EACAE,SAAS,EAAE,SAAAA,CAAUjQ,EAAE,EAAE;IACrB,IAAIkQ,IAAI,GAAGvU,IAAI,CAAC4E,QAAQ,CAACP,EAAE,CAACQ,OAAO,CAAC2P,MAAM,CAAC;MACvCC,SAAS;MAAEtO,CAAC;MAAEyM,CAAC;MAAE8B,EAAE;MAAEhB,CAAC;MAAE3C,EAAE;MAAE/O,EAAE;MAAEmD,IAAI;MACpCwP,gBAAgB,GAAG,IAAI;MACvB7F,IAAI,GAAG,KAAK;IAEhB2F,SAAS,GAAGG,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC;IAChC,IAAIE,SAAS,KAAKpQ,EAAE,CAACkB,UAAU,CAACiP,MAAM,EAAE;MACpC;IACJ;IAEA,IAAI,OAAOD,IAAI,KAAK,SAAS,EAAE;MAC3BI,gBAAgB,GAAG,IAAI;MACvB7F,IAAI,GAAGyF,IAAI;MACXpO,CAAC,GAAG,MAAM;MACVyM,CAAC,GAAG,CAAC;MACL8B,EAAE,GAAG,GAAG;MACRhB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;MACV3C,EAAE,GAAG,CAAC;IACV,CAAC,MAAM;MACH,IAAI/Q,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAACO,OAAO,CAAC,EAAE;QAC7BH,gBAAgB,GAAG,KAAK;QACxB7F,IAAI,GAAG,IAAI;QACX3I,CAAC,GAAGvG,GAAG,CAACmV,SAAS,CAAC/U,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAACnP,KAAK,CAAC,CAAC;QAC5CwN,CAAC,GAAG5S,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAACnS,IAAI,CAAC;QAC5BsS,EAAE,GAAG1U,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAACpS,KAAK,CAAC;QAC9BuR,CAAC,GAAG1T,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAAClS,MAAM,CAAC;QAC9B0O,EAAE,GAAG/Q,IAAI,CAAC4E,QAAQ,CAAC2P,IAAI,CAACrS,OAAO,CAAC;MACpC,CAAC,MAAM;QACH4M,IAAI,GAAG,KAAK;MAChB;IACJ;IAEA,IAAI9O,IAAI,CAACwD,MAAM,CAACa,EAAE,CAACoB,QAAQ,CAAC,EAAE;MAC1B,IAAIqJ,IAAI,EAAE;QACN,IAAI6F,gBAAgB,EAAE;UAClBtQ,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAACe,KAAK,CAAC,IAAI,CAACtD,SAAS,CAAC2B,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,CAAC;UACtF;QACJ,CAAC,MAAM;UACHmD,IAAI,GAAG,IAAI,CAAC9E,SAAS,CAACkB,aAAa,CAACmK,cAAc,CAAC1J,EAAE,CAAC;UACtD,IAAImD,IAAI,EAAE;YACN,IAAI,CAACrD,IAAI,CAACgJ,WAAW,CAAC3F,IAAI,CAAC;UAC/B;UACAnD,EAAE,GAAGqC,EAAE,CAACoB,QAAQ,CAACzD,EAAE,GAAG,GAAG,GAAG,IAAI;UAChC,IAAI,CAACF,IAAI,CAACD,WAAW,CAAC,IAAI,CAACE,kBAAkB,CAACC,EAAE,EAAEmE,CAAC,EAAE4K,EAAE,EAAE2D,EAAE,EAAE9B,CAAC,EAAEc,CAAC,CAAC,CAAC;UACnErP,EAAE,CAACoB,QAAQ,CAAC7C,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAACe,KAAK,CAAC3B,EAAE,CAAC,CAAC;UAC1D;QACJ;MACJ,CAAC,MAAM;QACHqC,EAAE,CAACoB,QAAQ,CAACiK,iBAAiB,CAAC,IAAI,EAAE,QAAQ,CAAC;MACjD;IACJ;IAEArL,EAAE,CAACkB,UAAU,CAACiP,MAAM,GAAGC,SAAS;EACpC,CAAC;EAED;AACR;AACA;;EAEQ;EACAO,aAAa,EAAE,SAAAA,CAAA,EAAY;IACvB;IACA,IAAI,CAACC,aAAa,GAAG,IAAI,CAAClU,OAAO,CAACiU,aAAa,CAAC,KAAK,CAAC;EAC1D,CAAC;EAED;EACAE,eAAe,EAAE,SAAAA,CAAA,EAAY;IACzB,IAAI,CAACnU,OAAO,CAACmU,eAAe,CAAC,IAAI,CAACD,aAAa,CAAC;IAChD;IACA;EACJ,CAAC;EAED;EACAvT,MAAM,EAAE,SAAAA,CAAU+M,CAAC,EAAE/J,CAAC,EAAE;IACpB,IAAI,CAAC3D,OAAO,CAACiD,YAAY,CAAC,OAAO,EAAE+O,UAAU,CAACtE,CAAC,CAAC,CAAC;IACjD,IAAI,CAAC1N,OAAO,CAACiD,YAAY,CAAC,QAAQ,EAAE+O,UAAU,CAACrO,CAAC,CAAC,CAAC;EACtD,CAAC;EAED;EACAyQ,iBAAiB,EAAE,SAAAA,CAAUC,CAAC,EAAE;IAC5B,IAAI7U,CAAC,EAAE8U,GAAG,EAAEC,GAAG,EAAEnQ,IAAI;IACrB,IAAI,CAACoQ,WAAW,GAAG,EAAE;IACrB,KAAKhV,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG6U,CAAC,EAAE7U,CAAC,EAAE,EAAE;MACpB8U,GAAG,GAAG,cAAc,GAAG9U,CAAC;MACxB4E,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,MAAM,EAAE0Q,GAAG,CAAC;MACnC,IAAI,CAAC1O,eAAe,CAACxB,IAAI,EAAE,EAAE,CAAC;MAC9BA,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,CAAC;MACvC,IAAI,CAAC2S,WAAW,CAACnD,IAAI,CAACjN,IAAI,CAAC;MAE3B,IAAI,CAACuJ,eAAe,CAACvJ,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;MAC7C,IAAI,CAACuJ,eAAe,CAACvJ,IAAI,EAAE,cAAc,EAAE,KAAK,CAAC;MACjDA,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC;MAC9CuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,GAAG,CAAC;MAChDuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;MAE5C0S,GAAG,GAAG,cAAc,GAAG/U,CAAC;MACxB4E,IAAI,GAAG,IAAI,CAACR,UAAU,CAAC,SAAS,EAAE2Q,GAAG,CAAC;MACtC,IAAI,CAAC3O,eAAe,CAACxB,IAAI,EAAE,EAAE,CAAC;MAC9B,IAAI,CAAC0G,iBAAiB,CAAC1G,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;MACxC,IAAI,CAACoQ,WAAW,CAACnD,IAAI,CAACjN,IAAI,CAAC;MAE3B,IAAI,CAACuJ,eAAe,CAACvJ,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;MAC7C,IAAI,CAACuJ,eAAe,CAACvJ,IAAI,EAAE,cAAc,EAAE,KAAK,CAAC;MACjDA,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC;MAC9CuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,GAAG,CAAC;MAChDuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE,SAAS,CAAC;MAC5CuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE,GAAG,CAAC;MAE9CuC,IAAI,CAACvC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;IAChD;EACJ,CAAC;EAED;EACA4S,cAAc,EAAE,SAAAA,CAAUjV,CAAC,EAAE;IACzB,IAAI,IAAI,CAACgV,WAAW,IAAIhV,CAAC,IAAI,CAAC,IAAI,CAAC,GAAGA,CAAC,GAAG,IAAI,CAACgV,WAAW,CAACzS,MAAM,EAAE;MAC/D,IAAI,CAACyS,WAAW,CAAC,CAAC,GAAGhV,CAAC,CAAC,CAACqC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC;MACjE,IAAI,CAAC2S,WAAW,CAAC,CAAC,GAAGhV,CAAC,GAAG,CAAC,CAAC,CAACqC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC;IACzE;EACJ,CAAC;EAED;EACA6S,cAAc,EAAE,SAAAA,CAAUlV,CAAC,EAAE;IACzB,IAAI,IAAI,CAACgV,WAAW,IAAIhV,CAAC,IAAI,CAAC,IAAI,CAAC,GAAGA,CAAC,GAAG,IAAI,CAACgV,WAAW,CAACzS,MAAM,EAAE;MAC/D,IAAI,CAACyS,WAAW,CAAC,CAAC,GAAGhV,CAAC,CAAC,CAACqC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;MAC/D,IAAI,CAAC2S,WAAW,CAAC,CAAC,GAAGhV,CAAC,GAAG,CAAC,CAAC,CAACqC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM,CAAC;IACvE;EACJ,CAAC;EAED;EACA8S,gBAAgB,EAAE,SAAAA,CAAUnV,CAAC,EAAEoV,GAAG,EAAE;IAChC,IAAIvP,CAAC;MACDC,CAAC;MACDN,CAAC,GAAG,EAAE;IAEV,IAAI,IAAI,CAACwP,WAAW,IAAIhV,CAAC,IAAI,CAAC,IAAI,CAAC,GAAGA,CAAC,GAAG,IAAI,CAACgV,WAAW,CAACzS,MAAM,EAAE;MAC/DsD,CAAC,GAAGuP,GAAG,CAAC,CAAC,CAAC;MACVtP,CAAC,GAAGsP,GAAG,CAAC,CAAC,CAAC;MAEV,IAAI,CAACJ,WAAW,CAAC,CAAC,GAAGhV,CAAC,CAAC,CAACqC,cAAc,CAClC,IAAI,EACJ,GAAG,EACH,IAAI,IACHwD,CAAC,GAAGL,CAAC,CAAC,GACP,GAAG,GACHM,CAAC,GACD,GAAG,GACH,IAAI,IACHD,CAAC,GAAGL,CAAC,CAAC,GACP,GAAG,GACHM,CAAC,GACD,GAAG,GACH,IAAI,GACJD,CAAC,GACD,GAAG,IACFC,CAAC,GAAGN,CAAC,CAAC,GACP,GAAG,GACH,IAAI,GACJK,CAAC,GACD,GAAG,IACFC,CAAC,GAAGN,CAAC,CACV,CAAC;MACD,IAAI,CAAC8F,iBAAiB,CAAC,IAAI,CAAC0J,WAAW,CAAC,CAAC,GAAGhV,CAAC,GAAG,CAAC,CAAC,EAAEoV,GAAG,CAAC,CAAC,CAAC,EAAEA,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC;IAC/E;EACJ,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;EACQC,uBAAuB,EAAE,SAAAA,CAAUzQ,IAAI,EAAE;IACrC,IAAI0Q,MAAM,GAAG,EAAE;IACf,IAAI1Q,IAAI,CAAC2Q,QAAQ,KAAK,CAAC,EAAE;MACrB3Q,IAAI,GAAGA,IAAI,CAAC4Q,UAAU;MACtB,OAAO5Q,IAAI,EAAE;QACT,IAAIA,IAAI,CAACnD,EAAE,KAAKiQ,SAAS,IAAI9M,IAAI,CAAC6Q,KAAK,KAAK/D,SAAS,EAAE;UACnD4D,MAAM,CAACzD,IAAI,CAAC,CAACjN,IAAI,CAACnD,EAAE,EAAEmD,IAAI,CAAC6Q,KAAK,CAAC,CAAC;QACtC;QACAH,MAAM,GAAGA,MAAM,CAACI,MAAM,CAAC,IAAI,CAACL,uBAAuB,CAACzQ,IAAI,CAAC,CAAC;QAC1DA,IAAI,GAAGA,IAAI,CAAC+Q,WAAW;MAC3B;IACJ;IACA,OAAOL,MAAM;EACjB,CAAC;EAEDM,WAAW,EAAE,SAAAA,CAAUxM,GAAG,EAAEyM,QAAQ,EAAE;IAClC,IAAIC,KAAK,GAAG,IAAIC,KAAK,CAAC,CAAC;IAEvBD,KAAK,CAACE,MAAM,GAAG,YAAY;MACvB,IAAIC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;MAC7CF,MAAM,CAAC7U,KAAK,GAAG,IAAI,CAACgV,YAAY,CAAC,CAAC;MAClCH,MAAM,CAAC5U,MAAM,GAAG,IAAI,CAACgV,aAAa,CAAC,CAAC;;MAEpCJ,MAAM,CAACK,UAAU,CAAC,IAAI,CAAC,CAAC7N,SAAS,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;MAE7CoN,QAAQ,CAACI,MAAM,CAACM,SAAS,CAAC,WAAW,CAAC,CAAC;MACvCN,MAAM,CAAC5L,MAAM,CAAC,CAAC;IACnB,CAAC;IAEDyL,KAAK,CAACU,GAAG,GAAGpN,GAAG;EACnB,CAAC;EAEDqN,cAAc,EAAE,SAAAA,CAAUjW,OAAO,EAAE;IAC/B,IAAIkW,MAAM,EAAE1Q,GAAG,EAAEiQ,MAAM,EAAEU,GAAG,EAAEC,EAAE,EAAE5W,CAAC;IAEnC0W,MAAM,GAAGlW,OAAO,CAACqW,oBAAoB,CAAC,OAAO,CAAC;IAC9C7Q,GAAG,GAAG0Q,MAAM,CAACnU,MAAM;IACnB,IAAIyD,GAAG,GAAG,CAAC,EAAE;MACTiQ,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;MACzC;MACA,KAAKnW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;QACtB0W,MAAM,CAAC1W,CAAC,CAAC,CAACyD,YAAY,CAAC,aAAa,EAAE,WAAW,CAAC;QAClD;QACA;QACA;QACAkT,GAAG,GAAGV,MAAM,CAACK,UAAU,CAAC,IAAI,CAAC;QAC7BL,MAAM,CAAC7U,KAAK,GAAGsV,MAAM,CAAC1W,CAAC,CAAC,CAAC8W,YAAY,CAAC,OAAO,CAAC;QAC9Cb,MAAM,CAAC5U,MAAM,GAAGqV,MAAM,CAAC1W,CAAC,CAAC,CAAC8W,YAAY,CAAC,QAAQ,CAAC;QAChD,IAAI;UACAH,GAAG,CAAClO,SAAS,CAACiO,MAAM,CAAC1W,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAEiW,MAAM,CAAC7U,KAAK,EAAE6U,MAAM,CAAC5U,MAAM,CAAC;;UAE3D;UACAuV,EAAE,GAAGX,MAAM,CAACM,SAAS,CAAC,CAAC;UACvBG,MAAM,CAAC1W,CAAC,CAAC,CAACyD,YAAY,CAAC,YAAY,EAAEmT,EAAE,CAAC;QAC5C,CAAC,CAAC,OAAOG,GAAG,EAAE;UACVC,OAAO,CAACC,GAAG,CAAC,qCAAqC,EAAEF,GAAG,CAAC;QAC3D;MACJ;MACA;IACJ;IACA,OAAO,IAAI;EACf,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQG,aAAa,EAAE,SAAAA,CAAUC,WAAW,EAAE;IAClC,IAAI3W,OAAO,GAAG,IAAI,CAACA,OAAO;MACtB4W,IAAI,GAAGtE,MAAM,CAACsE,IAAI,IAAIzX,MAAM,CAAC0X,MAAM;MACnCC,GAAG;MAAEtX,CAAC;MAAEgG,GAAG;MACXsP,MAAM,GAAG,EAAE;;IAEf;IACA;IACA;IACA;IACA;IACA,IAAI,IAAI,CAACxV,SAAS,CAACyX,aAAa,CAAC,CAAC,IAAI9X,IAAI,CAACwD,MAAM,CAAC,IAAI,CAACO,eAAe,CAAC,EAAE;MACrE,IAAI,CAAC2T,WAAW,EAAE;QACd,IAAI,CAAC3T,eAAe,CAACC,YAAY,CAAC,SAAS,EAAE,QAAQ,CAAC;QACtD,OAAOjD,OAAO,CAACmV,WAAW,EAAE;UACxB;UACAL,MAAM,GAAGA,MAAM,CAACI,MAAM,CAAC,IAAI,CAACL,uBAAuB,CAAC7U,OAAO,CAACmV,WAAW,CAAC,CAAC;UACzE,IAAI,CAACnS,eAAe,CAAClC,WAAW,CAACd,OAAO,CAACmV,WAAW,CAAC;QACzD;MACJ;IACJ;IAEA,IAAI,CAACc,cAAc,CAACjW,OAAO,CAAC;;IAE5B;IACAA,OAAO,CAACiD,YAAY,CAAC,OAAO,EAAE,4BAA4B,CAAC;IAC3D6T,GAAG,GAAG,IAAIE,aAAa,CAAC,CAAC,CAACC,iBAAiB,CAACjX,OAAO,CAAC;IAEpD,IAAI2W,WAAW,KAAK,IAAI,EAAE;MACtB;MACA;MACAnR,GAAG,GAAGsP,MAAM,CAAC/S,MAAM;MACnB,KAAKvC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgG,GAAG,EAAEhG,CAAC,EAAE,EAAE;QACtBsX,GAAG,GAAGA,GAAG,CAACI,OAAO,CACb,MAAM,GAAGpC,MAAM,CAACtV,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,EAC3B,MAAM,GAAGsV,MAAM,CAACtV,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,GAAGsV,MAAM,CAACtV,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GACzD,CAAC;MACL;IACJ;;IAEA;IACA;IACA;IACA;;IAEA;IACA,IAAI,CAACsX,GAAG,CAAC/W,KAAK,CAAC,yCAAyC,CAAC,IAAI,EAAE,EAAEgC,MAAM,GAAG,CAAC,EAAE;MACzE+U,GAAG,GAAGA,GAAG,CAACI,OAAO,CAAC,yCAAyC,EAAE,EAAE,CAAC;IACpE;;IAEA;IACA;IACAJ,GAAG,GAAGA,GAAG,CAACI,OAAO,CAAC,SAAS,EAAE,GAAG,CAAC;IACjCJ,GAAG,GAAGA,GAAG,CAACI,OAAO,CAAC,0BAA0B,EAAE,SAAS,CAAC;;IAExD;IACA;IACA,IAAIjY,IAAI,CAACwD,MAAM,CAAC,IAAI,CAACO,eAAe,CAAC,IAAI,IAAI,CAACA,eAAe,CAAC+T,aAAa,CAAC,CAAC,EAAE;MAC3E;MACA,OAAO,IAAI,CAAC/T,eAAe,CAACgS,UAAU,EAAE;QACpC,IAAI,CAAC1V,SAAS,CAACwB,WAAW,CAAC,IAAI,CAACkC,eAAe,CAACgS,UAAU,CAAC;MAC/D;MACA,IAAI,CAAChS,eAAe,CAACC,YAAY,CAAC,SAAS,EAAE,MAAM,CAAC;IACxD;IAEA,OAAO,4BAA4B,GAAG2T,IAAI,CAACO,QAAQ,CAACC,kBAAkB,CAACN,GAAG,CAAC,CAAC,CAAC;EACjF,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQO,YAAY,EAAE,SAAAA,CAAUC,QAAQ,EAAE5J,CAAC,EAAE/J,CAAC,EAAEgT,WAAW,EAAE;IACjD,IAAIG,GAAG;MAAES,MAAM;MACXC,EAAE;MAAErB,GAAG;MACPsB,GAAG,GAAG,IAAI,CAACnY,SAAS,CAACkB,aAAa;;IAEtC;IACAgX,EAAE,GAAGC,GAAG,CAAC9M,cAAc,CAAC2M,QAAQ,CAAC;;IAEjC;IACA;IACAE,EAAE,CAAC5W,KAAK,GAAG4W,EAAE,CAAC5W,KAAK;IACnB;;IAEAuV,GAAG,GAAGqB,EAAE,CAAC1B,UAAU,CAAC,IAAI,CAAC;IACzB,IAAIpI,CAAC,KAAKwD,SAAS,IAAIvN,CAAC,KAAKuN,SAAS,EAAE;MACpCsG,EAAE,CAACrX,KAAK,CAACS,KAAK,GAAGoR,UAAU,CAACtE,CAAC,CAAC,GAAG,IAAI;MACrC8J,EAAE,CAACrX,KAAK,CAACU,MAAM,GAAGmR,UAAU,CAACrO,CAAC,CAAC,GAAG,IAAI;MACtC;MACA;MACA;MACA;MACA6T,EAAE,CAACvU,YAAY,CAAC,OAAO,EAAE+O,UAAU,CAACtE,CAAC,CAAC,CAAC;MACvC8J,EAAE,CAACvU,YAAY,CAAC,QAAQ,EAAE+O,UAAU,CAACrO,CAAC,CAAC,CAAC;IAC5C;;IAEA;IACA;AACZ;AACA;AACA;AACA;IACY4T,MAAM,GAAG,IAAIhC,KAAK,CAAC,CAAC;IACpBuB,GAAG,GAAG,IAAI,CAACJ,aAAa,CAACC,WAAW,CAAC;IACrCY,MAAM,CAACvB,GAAG,GAAGc,GAAG;;IAEhB;IACA,IAAI,EAAE,SAAS,IAAIxE,MAAM,CAAC,EAAE;MACxB;AAChB;AACA;AACA;MACgBiF,MAAM,CAAC/B,MAAM,GAAG,YAAY;QACxB;QACA;QACAlD,MAAM,CAACC,UAAU,CAAC,YAAY;UAC1B,IAAI;YACA4D,GAAG,CAAClO,SAAS,CAACsP,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE7J,CAAC,EAAE/J,CAAC,CAAC;UACrC,CAAC,CAAC,OAAO4S,GAAG,EAAE;YACVC,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;UACzD;QACJ,CAAC,EAAE,GAAG,CAAC;MACX,CAAC;MACD,OAAO,IAAI;IACf;IAEA,OAAO,IAAIiB,OAAO,CAAC,UAAUC,OAAO,EAAEC,MAAM,EAAE;MAC1C,IAAI;QACAL,MAAM,CAAC/B,MAAM,GAAG,YAAY;UACxBW,GAAG,CAAClO,SAAS,CAACsP,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE7J,CAAC,EAAE/J,CAAC,CAAC;UACjCgU,OAAO,CAAC,CAAC;QACb,CAAC;MACL,CAAC,CAAC,OAAOxU,CAAC,EAAE;QACRyU,MAAM,CAACzU,CAAC,CAAC;MACb;IACJ,CAAC,CAAC;EACN,CAAC;EAED;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQ0U,UAAU,EAAE,SAAAA,CAAU9R,KAAK,EAAE+R,KAAK,EAAEnB,WAAW,EAAE;IAC7C,IAAIvS,IAAI;MACJqT,GAAG,GAAG,IAAI,CAACnY,SAAS,CAACkB,aAAa;MAClCuX,MAAM,GAAG,IAAI,CAACzY,SAAS,CAACqF,UAAU;MAClC;MACA;MACA8Q,MAAM;MAAExU,EAAE;MAAE+W,GAAG;MACfC,MAAM;MAAEC,UAAU;MAClBxK,CAAC;MAAE/J,CAAC;MACJwU,GAAG,GAAGpS,KAAK,CAAC+L,IAAI,CAAC+F,UAAU;MAC3BO,MAAM;MAAEC,aAAa;MAAEC,MAAM;MAC7BC,MAAM,GAAG,KAAK;MACdC,gBAAgB;MAChBC,OAAO,GAAG,KAAK;IAEnB,IAAI,IAAI,CAAChZ,IAAI,KAAK,IAAI,EAAE;MACpB,OAAO,IAAI;IACf;IAEAiO,CAAC,GAAGyK,GAAG,CAACO,KAAK,GAAG,IAAI,CAACpZ,SAAS,CAACyS,qBAAqB,CAAC,CAAC,CAACnR,KAAK;IAC5D+C,CAAC,GAAGwU,GAAG,CAACO,KAAK,GAAG,IAAI,CAACpZ,SAAS,CAACyS,qBAAqB,CAAC,CAAC,CAAClR,MAAM;IAE7D,IAAIiX,KAAK,KAAK5G,SAAS,IAAI4G,KAAK,KAAK,EAAE,EAAE;MACrCS,MAAM,GAAG,IAAI;MACbP,GAAG,GAAG,IAAIzC,KAAK,CAAC,CAAC,CAAC,CAAC;MACnByC,GAAG,CAAC7X,KAAK,CAACS,KAAK,GAAG8M,CAAC,GAAG,IAAI;MAC1BsK,GAAG,CAAC7X,KAAK,CAACU,MAAM,GAAG8C,CAAC,GAAG,IAAI;IAC/B,CAAC,MAAM;MACH4U,MAAM,GAAG,KAAK;MACdP,GAAG,GAAGP,GAAG,CAAC9M,cAAc,CAACmN,KAAK,CAAC;IACnC;IACA;;IAEA;IACA,IAAIS,MAAM,EAAE;MACRnU,IAAI,GAAGqT,GAAG,CAAC9B,aAAa,CAAC,KAAK,CAAC;MAC/BvR,IAAI,CAACjE,KAAK,CAACwY,OAAO,GAAGR,GAAG,CAAClP,GAAG;MAC5B7E,IAAI,CAACjE,KAAK,CAACS,KAAK,GAAG8M,CAAC,GAAG,IAAI;MAC3BtJ,IAAI,CAACjE,KAAK,CAACU,MAAM,GAAG8C,CAAC,GAAG,IAAI;MAC5BS,IAAI,CAACjE,KAAK,CAACyY,MAAM,GAAG,IAAI,CAACtZ,SAAS,CAACa,KAAK,CAACyY,MAAM,GAAG,GAAG;;MAErD;MACAxU,IAAI,CAACjE,KAAK,CAACI,QAAQ,GAAG,UAAU;MAChC6D,IAAI,CAACjE,KAAK,CAACmH,GAAG,GAAG,IAAI,CAAChI,SAAS,CAACuZ,SAAS,GAAG,IAAI;MAChDzU,IAAI,CAACjE,KAAK,CAACkH,IAAI,GAAG,IAAI,CAAC/H,SAAS,CAACwZ,UAAU,GAAG,IAAI;IACtD;IAEA,IAAI,CAACL,OAAO,EAAE;MACV;MACA;MACAhD,MAAM,GAAGgC,GAAG,CAAC9B,aAAa,CAAC,QAAQ,CAAC;MACpC1U,EAAE,GAAGiK,IAAI,CAACoC,MAAM,CAAC,CAAC,CAACyL,QAAQ,CAAC,EAAE,CAAC,CAAC5W,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;MAC3CsT,MAAM,CAACxS,YAAY,CAAC,IAAI,EAAEhC,EAAE,CAAC;MAC7BwU,MAAM,CAACxS,YAAY,CAAC,OAAO,EAAEyK,CAAC,CAAC;MAC/B+H,MAAM,CAACxS,YAAY,CAAC,QAAQ,EAAEU,CAAC,CAAC;MAChC8R,MAAM,CAACtV,KAAK,CAACS,KAAK,GAAG8M,CAAC,GAAG,IAAI;MAC7B+H,MAAM,CAACtV,KAAK,CAACU,MAAM,GAAG6M,CAAC,GAAG,IAAI;MAC9B+H,MAAM,CAACtV,KAAK,CAACO,OAAO,GAAG,MAAM;MAC7BqX,MAAM,CAACjX,WAAW,CAAC2U,MAAM,CAAC;IAC9B,CAAC,MAAM;MACH;MACAxU,EAAE,GAAG,eAAe;MACpB;MACAwU,MAAM,GAAGgC,GAAG,CAAC9M,cAAc,CAAC1J,EAAE,CAAC;IACnC;IAEA,IAAIsX,MAAM,EAAE;MACR;MACAN,MAAM,GAAGR,GAAG,CAAC9B,aAAa,CAAC,MAAM,CAAC;MAClCuC,UAAU,GAAGT,GAAG,CAACrR,cAAc,CAAC,QAAQ,CAAC;MACzC6R,MAAM,CAAC9X,KAAK,CAACwY,OAAO,GAAGR,GAAG,CAACa,SAAS;MACpCf,MAAM,CAACnX,WAAW,CAACoX,UAAU,CAAC;MAC9BD,MAAM,CAACgB,OAAO,GAAG,YAAY;QACzB7U,IAAI,CAACO,UAAU,CAACoF,WAAW,CAAC3F,IAAI,CAAC;MACrC,CAAC;;MAED;MACAA,IAAI,CAACtD,WAAW,CAACkX,GAAG,CAAC;MACrB5T,IAAI,CAACtD,WAAW,CAACmX,MAAM,CAAC;MACxBF,MAAM,CAACnT,YAAY,CAACR,IAAI,EAAE,IAAI,CAAC9E,SAAS,CAAC6V,WAAW,CAAC;IACzD;;IAEA;IACAiD,MAAM,GAAGX,GAAG,CAAC9M,cAAc,CAAC,IAAI,CAAC3I,QAAQ,CAAC,eAAe,CAAC,CAAC;IAC3D,IAAI/C,IAAI,CAACwD,MAAM,CAAC2V,MAAM,CAAC,EAAE;MACrBC,aAAa,GAAGD,MAAM,CAACjY,KAAK,CAACO,OAAO;MACpC0X,MAAM,CAACjY,KAAK,CAACO,OAAO,GAAG,MAAM;MAC7B4X,MAAM,GAAG,IAAI,CAACY,mBAAmB,CAACd,MAAM,CAAC;IAC7C;IAEAI,gBAAgB,GAAG,SAAAA,CAAA,EAAY;MAC3B;MACAR,GAAG,CAAChC,GAAG,GAAGP,MAAM,CAACM,SAAS,CAAC,WAAW,CAAC;;MAEvC;MACA,IAAI,CAAC0C,OAAO,EAAE;QACVV,MAAM,CAAChO,WAAW,CAAC0L,MAAM,CAAC;MAC9B;IACJ,CAAC;;IAED;IACA,IAAI,SAAS,IAAInD,MAAM,EAAE;MACrB,IAAI,CAAC+E,YAAY,CAACpW,EAAE,EAAEyM,CAAC,EAAE/J,CAAC,EAAEgT,WAAW,CAAC,CAACwC,IAAI,CAACX,gBAAgB,CAAC;IACnE,CAAC,MAAM;MACH;MACA,IAAI,CAACnB,YAAY,CAACpW,EAAE,EAAEyM,CAAC,EAAE/J,CAAC,EAAEgT,WAAW,CAAC;MACxCrE,MAAM,CAACC,UAAU,CAACiG,gBAAgB,EAAE,GAAG,CAAC;IAC5C;;IAEA;IACA,IAAIvZ,IAAI,CAACwD,MAAM,CAAC2V,MAAM,CAAC,EAAE;MACrBA,MAAM,CAACjY,KAAK,CAACO,OAAO,GAAG2X,aAAa;MACpCC,MAAM,CAAC,CAAC;IACZ;IAEA,OAAO,IAAI;EACf;AACJ,CACJ,CAAC;AAED,eAAezZ,GAAG,CAACQ,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}